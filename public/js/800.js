/*! For license information please see 800.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[800,928,485],{9928:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Accessor:()=>W,Animation:()=>J,AnimationChannel:()=>Z,AnimationSampler:()=>Q,Buffer:()=>ee,BufferUtils:()=>I,COPY_IDENTITY:()=>Y,Camera:()=>te,ColorUtils:()=>S,DenoIO:()=>Ce,Document:()=>Te,ExtensibleProperty:()=>K,Extension:()=>xe,ExtensionProperty:()=>re,FileUtils:()=>v,Format:()=>b,GLB_BUFFER:()=>y,Graph:()=>o,GraphEdge:()=>n,ImageUtils:()=>M,Logger:()=>U,Material:()=>ue,MathUtils:()=>F,Mesh:()=>ce,Node:()=>le,NodeIO:()=>Me,PlatformIO:()=>Ne,Primitive:()=>he,PrimitiveTarget:()=>fe,Property:()=>X,PropertyType:()=>T,ReaderContext:()=>Ee,Root:()=>ye,Scene:()=>ge,Skin:()=>de,Texture:()=>me,TextureChannel:()=>A,TextureInfo:()=>se,VERSION:()=>m,VertexLayout:()=>x,WebIO:()=>Oe,WriterContext:()=>we,bounds:()=>R,uuid:()=>q});class s{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const r=t.slice(0);for(let t=0,s=r.length;t<s;t++)r[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class n extends s{constructor(e,t,r,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=s,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class o extends s{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map((e=>e.getParent()))}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map((e=>e.getChild()))}disconnectParents(e,t){let r=this.listParentEdges(e);return t&&(r=r.filter((e=>t(e.getParent())))),r.forEach((e=>e.dispose())),this}createEdge(e,t,r,s){return this._registerEdge(new n(e,t,r,s))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const r=e.getChild();return this._childEdges.has(r)||this._childEdges.set(r,new Set),this._childEdges.get(r).add(e),e.addEventListener("dispose",(()=>this._removeEdge(e))),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},i.apply(this,arguments)}function a(e){return e instanceof n}function u(e){return Array.isArray(e)&&e[0]instanceof n}function c(e){return!!(e&&"object"==typeof e&&Object.values(e)[0]instanceof n)}const l=Symbol("attributes"),h=Symbol("immutableKeys");class f extends s{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[l]=void 0,this[h]=void 0,this.graph=e,this[h]=new Set,this[l]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const s=e[r];if(s instanceof f){const e=this.graph.createEdge(r,this,s);e.addEventListener("dispose",(()=>s.dispose())),this[h].add(r),t[r]=e}else t[r]=s}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[l]){const s=this[l][r];if(a(s)){const n=s;n.getChild()===e&&this.setRef(r,t,n.getAttributes())}else if(u(s)){const n=s.find((t=>t.getChild()===e));if(n){const s=n.getAttributes();this.removeRef(r,e).addRef(r,t,s)}}else if(c(s)){const n=s;for(const s in n){const o=n[s];o.getChild()===e&&this.setRefMap(r,s,t,o.getAttributes())}}}return this}get(e){return this[l][e]}set(e,t){return this[l][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[l][e];return t?t.getChild():null}setRef(e,t,r){if(this[h].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[l][e];if(s&&s.dispose(),!t)return this;const n=this.graph.createEdge(e,this,t,r);return n.addEventListener("dispose",(()=>{delete this[l][e],this.dispatchEvent({type:"change",attribute:e})})),this[l][e]=n,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[l][e].map((e=>e.getChild()))}addRef(e,t,r){const s=this.graph.createEdge(e,this,t,r),n=this[l][e];return n.push(s),s.addEventListener("dispose",(()=>{const t=n.filter((e=>e!==s));n.length=0;for(const e of t)n.push(e);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[l][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[l][e])}listRefMapValues(e){return Object.values(this[l][e]).map((e=>e.getChild()))}getRefMap(e,t){const r=this[l][e];return r[t]?r[t].getChild():null}setRefMap(e,t,r,s){const n=this[l][e],o=n[t];if(o&&o.dispose(),!r)return this;s=Object.assign(s||{},{key:t});const a=this.graph.createEdge(e,this,r,i({},s,{key:t}));return a.addEventListener("dispose",(()=>{delete n[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),n[t]=a,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(i({},e,{target:this})),this.graph.dispatchEvent(i({},e,{target:this,type:`node:${e.type}`})),this}}var p=r(7160),g=r(5975),d=r(8764).Buffer;const m="v2.0.5",y="@glb.bin";var T,x,E,A,b;function R(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=e.propertyType===T.NODE?[e]:e.listChildren();for(const e of r)e.traverse((e=>{const r=e.getMesh();if(!r)return;const s=_(r,e.getWorldMatrix());w(s.min,t),w(s.max,t)}));return t}function _(e,t){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of e.listPrimitives()){const e=s.getAttribute("POSITION");if(!e)continue;let n=[0,0,0],o=[0,0,0];for(let s=0;s<e.getCount();s++)n=e.getElement(s,n),o=(0,p.fF)(o,n,t),w(o,r)}return r}function w(e,t){for(let r=0;r<3;r++)t.min[r]=Math.min(e[r],t.min[r]),t.max[r]=Math.max(e[r],t.max[r])}!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(T||(T={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(x||(x={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER"}(E||(E={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(A||(A={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(b||(b={}));class I{static createBufferFromDataURI(e){if(void 0===d){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return d.from(t,r?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):d.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):d.from(e).toString("utf8")}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let s=0;for(const t of e)r.set(t,s),s+=t.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const s=new Uint8Array(r);if(s.set(e),0!==t)for(let n=e.byteLength;n<r;n++)s[n]=t;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class S{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,s,n]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*s<<8^255*n<<0}static convertSRGBToLinear(e,t){const r=e,s=t;for(let e=0;e<3;e++)s[e]=r[e]<.04045?.0773993808*r[e]:Math.pow(.9478672986*r[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,s=t;for(let e=0;e<3;e++)s[e]=r[e]<.0031308?12.92*r[e]:1.055*Math.pow(r[e],.41666)-.055;return t}}class v{static basename(e){const t=(e=new URL(e,"https://null.example").pathname).split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){return 0!==e.indexOf("data:")?(e=new URL(e,"https://null.example").pathname).split(/[\\/]/).pop().split(/[.]/).pop():0===e.indexOf("data:image/png")?"png":0===e.indexOf("data:image/jpeg")?"jpeg":"bin"}}class N{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return I.decodeText(e.slice(12,16))===N.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}N.PNG_FRIED_CHUNK_NAME="CgBI";class M{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let r=0;const s=this.getSize(e,t);if(!s)return null;for(;s[0]>1||s[1]>1;)r+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":`image/${e}`}}function C(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}function O(e){return"[object Object]"===Object.prototype.toString.call(e)}function P(e){if(!1===O(e))return!1;const t=e.constructor;if(void 0===t)return!0;const r=t.prototype;return!1!==O(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}M.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,r,s=new DataView(e.buffer,e.byteOffset+4);for(;s.byteLength;){if(t=s.getUint16(0,!1),C(s,t),r=s.getUint8(t+1),192===r||193===r||194===r)return[s.getUint16(t+7,!1),s.getUint16(t+5,!1)];s=new DataView(e.buffer,s.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new N};class U{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=U.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=U.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=U.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=U.Verbosity.ERROR&&console.error(e)}}U.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},U.DEFAULT_INSTANCE=new U(U.Verbosity.INFO);class F{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,r,s){let n=(0,p.kE)([e[0],e[1],e[2]]);const o=(0,p.kE)([e[4],e[5],e[6]]),i=(0,p.kE)([e[8],e[9],e[10]]);(0,g.GH)(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];const a=e.slice(),u=1/n,c=1/o,l=1/i;a[0]*=u,a[1]*=u,a[2]*=u,a[4]*=c,a[5]*=c,a[6]*=c,a[8]*=l,a[9]*=l,a[10]*=l,(0,g.j6)(r,a),s[0]=n,s[1]=o,s[2]=i}static compose(e,t,r,s){const n=s,o=t[0],i=t[1],a=t[2],u=t[3],c=o+o,l=i+i,h=a+a,f=o*c,p=o*l,g=o*h,d=i*l,m=i*h,y=a*h,T=u*c,x=u*l,E=u*h,A=r[0],b=r[1],R=r[2];return n[0]=(1-(d+y))*A,n[1]=(p+E)*A,n[2]=(g-x)*A,n[3]=0,n[4]=(p-E)*b,n[5]=(1-(f+y))*b,n[6]=(m+T)*b,n[7]=0,n[8]=(g+x)*R,n[9]=(m-T)*R,n[10]=(1-(f+d))*R,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}}function B(e,t){if(!!e!=!!t)return!1;const r=e.getChild(),s=t.getChild();return r===s||r.equals(s)}function D(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const s=e[r],n=t[r];if(s.getChild()!==n.getChild()&&!s.getChild().equals(n.getChild()))return!1}return!0}function L(e,t){if(!!e!=!!t)return!1;const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const r in e){const s=e[r],n=t[r];if(!!s!=!!n)return!1;const o=s.getChild(),i=n.getChild();if(o!==i&&!o.equals(i))return!1}return!0}function j(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function V(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!P(e)||!P(t))return e===t;const r=e,s=t;let n,o=0,i=0;for(n in r)o++;for(n in s)i++;if(o!==i)return!1;for(n in r){const e=r[n],t=s[n];if(k(e)&&k(t)){if(!j(e,t))return!1}else if(P(e)&&P(t)){if(!V(e,t))return!1}else if(e!==t)return!1}return!0}function k(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const G="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",z=new Set,H=function(){let e="";for(let t=0;t<6;t++)e+=G.charAt(Math.floor(Math.random()*G.length));return e},q=function(){for(let e=0;e<999;e++){const e=H();if(!z.has(e))return z.add(e),e}return""};class ${static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),s=t.split("/");r.pop();for(let e=0;e<s.length;e++)"."!==s[e]&&(".."===s[e]?r.pop():r.push(s[e]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}$.DEFAULT_INIT={},$.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Y=e=>e;class X extends f{constructor(e,t=""){super(e),this[l].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,Y)}copy(e,t=Y){for(const e in this[l]){const t=this[l][e];if(t instanceof n)this[h].has(e)||t.dispose();else if(Array.isArray(t)&&t[0]instanceof n)for(const e of t)e.dispose();else if(P(t)&&Object.values(t)[0]instanceof n)for(const e in t)t[e].dispose()}for(const r in e[l]){const s=this[l][r],o=e[l][r];if(o instanceof n)this[h].has(r)?s.getChild().copy(t(o.getChild()),t):this.setRef(r,t(o.getChild()),o.getAttributes());else if(Array.isArray(o)&&o[0]instanceof n)for(const e of o)this.addRef(r,t(e.getChild()),e.getAttributes());else if(P(o)&&Object.values(o)[0]instanceof n)for(const e in o){const s=o[e];this.setRefMap(r,e,t(s.getChild()),s.getAttributes())}else this[l][r]=P(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const t in this[l]){const r=this[l][t],s=e[l][t];if(a(r)||a(s)){if(!B(r,s))return!1}else if(u(r)||u(s)){if(!D(r,s))return!1}else if(c(r)||c(s)){if(!L(r,s))return!1}else if(P(r)||P(s)){if(!V(r,s))return!1}else if(k(r)||k(s)){if(!j(r,s))return!1}else if(r!==s)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class K extends X{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class W extends K{constructor(...e){super(...e),this.i=F.identity,this.o=F.identity}init(){this.propertyType=T.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:W.Type.SCALAR,componentType:W.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=Y){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case W.Type.SCALAR:return 1;case W.Type.VEC2:return 2;case W.Type.VEC3:return 3;case W.Type.VEC4:case W.Type.MAT2:return 4;case W.Type.MAT3:return 9;case W.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case W.ComponentType.BYTE:case W.ComponentType.UNSIGNED_BYTE:return 1;case W.ComponentType.SHORT:case W.ComponentType.UNSIGNED_SHORT:return 2;case W.ComponentType.UNSIGNED_INT:case W.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMin(e){const t=this.get("array"),r=this.getCount(),s=this.getElementSize();for(let t=0;t<s;t++)e[t]=1/0;for(let n=0;n<r*s;n+=s)for(let r=0;r<s;r++){const s=t[n+r];Number.isFinite(s)&&(e[r]=Math.min(e[r],s))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMax(e){const t=this.get("array"),r=this.getCount(),s=this.getElementSize();for(let t=0;t<s;t++)e[t]=-1/0;for(let n=0;n<r*s;n+=s)for(let r=0;r<s;r++){const s=t[n+r];Number.isFinite(s)&&(e[r]=Math.max(e[r],s))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return W.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>F.denormalize(e,this.get("componentType")),this.i=e=>F.normalize(e,this.get("componentType"))):(this.o=F.identity,this.i=F.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const r=this.getElementSize(),s=this.get("array");for(let n=0;n<r;n++)t[n]=this.o(s[e*r+n]);return t}setElement(e,t){const r=this.getElementSize(),s=this.get("array");for(let n=0;n<r;n++)s[e*r+n]=this.i(t[n]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return W.ComponentType.FLOAT;case Uint32Array:return W.ComponentType.UNSIGNED_INT;case Uint16Array:return W.ComponentType.UNSIGNED_SHORT;case Uint8Array:return W.ComponentType.UNSIGNED_BYTE;case Int16Array:return W.ComponentType.SHORT;case Int8Array:return W.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):W.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}W.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},W.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class J extends K{init(){this.propertyType=T.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Z extends K{init(){this.propertyType=T.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Z.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Q extends K{init(){this.propertyType=T.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Q.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:E.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:E.OTHER})}}Q.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class ee extends K{init(){this.propertyType=T.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class te extends K{init(){this.propertyType=T.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:te.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}te.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class re extends X{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}re.EXTENSION_NAME=void 0;class se extends K{init(){this.propertyType=T.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:se.WrapMode.REPEAT,wrapT:se.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}se.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},se.MagFilter={NEAREST:9728,LINEAR:9729},se.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ne,G:oe,B:ie,A:ae}=A;class ue extends K{init(){this.propertyType=T.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:ue.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new se(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new se(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new se(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new se(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new se(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return S.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",S.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ne|oe|ie|ae})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return S.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",S.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ne|oe|ie})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ne|oe|ie})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ne})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:oe|ie})}}ue.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class ce extends K{init(){this.propertyType=T.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class le extends K{constructor(...e){super(...e),this.u=null}init(){this.propertyType=T.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Y){if(t===Y)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return F.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),s=this.get("scale").slice();return F.decompose(e,t,r,s),this.set("translation",t).set("rotation",r).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return F.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return F.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return F.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;t instanceof le;t=t.u)e.push(t);let t;const r=e.pop().getMatrix();for(;t=e.pop();)(0,g.Jp)(r,r,t.getMatrix());return r}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[l].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class he extends K{init(){this.propertyType=T.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:he.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:E.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:E.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}he.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class fe extends X{init(){this.propertyType=T.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:E.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}class ge extends K{init(){this.propertyType=T.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Y){if(t===Y)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[l].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class de extends K{init(){this.propertyType=T.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:E.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class me extends K{init(){this.propertyType=T.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||M.extensionToMimeType(v.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",M.extensionToMimeType(v.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",I.assertView(e))}getSize(){const e=this.get("image");return e?M.getSize(e,this.getMimeType()):null}}class ye extends K{init(){this.propertyType=T.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.0.5",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Y){if(t===Y)throw new Error("Root cannot be copied.");this.set("asset",pe({},e.get("asset"))),this.setName(e.getName()),this.setExtras(pe({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const s=e.getExtension(r);this.setExtension(r,t(s))}return this}l(e){return e instanceof ge?this.addRef("scenes",e):e instanceof le?this.addRef("nodes",e):e instanceof te?this.addRef("cameras",e):e instanceof de?this.addRef("skins",e):e instanceof ce?this.addRef("meshes",e):e instanceof ue?this.addRef("materials",e):e instanceof me?this.addRef("textures",e):e instanceof J?this.addRef("animations",e):e instanceof W?this.addRef("accessors",e):e instanceof ee&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Te{constructor(){this.m=new o,this.T=new ye(this.m),this.v=U.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return(new Te).setLogger(this.v).merge(this)}merge(e){for(const t of e.getRoot().listExtensionsUsed()){const e=this.createExtension(t.constructor);t.isRequired()&&e.setRequired(!0)}const t=new Set,r=new Map;t.add(e.T),r.set(e.T,this.T);for(const s of e.m.listEdges())for(const e of[s.getParent(),s.getChild()]){if(t.has(e))continue;let s;s=e.propertyType===T.TEXTURE_INFO?e:new(0,e.constructor)(this.m),r.set(e,s),t.add(e)}const s=e=>{const t=r.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const e of t){const t=r.get(e);if(!t)throw new Error("Could resolve property.");t.copy(e,s)}return this}async transform(...e){const t=e.map((e=>e.name));for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new ge(this.m,e)}createNode(e=""){return new le(this.m,e)}createCamera(e=""){return new te(this.m,e)}createSkin(e=""){return new de(this.m,e)}createMesh(e=""){return new ce(this.m,e)}createPrimitive(){return new he(this.m)}createPrimitiveTarget(e=""){return new fe(this.m,e)}createMaterial(e=""){return new ue(this.m,e)}createTexture(e=""){return new me(this.m,e)}createAnimation(e=""){return new J(this.m,e)}createAnimationChannel(e=""){return new Z(this.m,e)}createAnimationSampler(e=""){return new Q(this.m,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new W(this.m,e).setBuffer(t)}createBuffer(e=""){return new ee(this.m,e)}}class xe{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=e=>{const t=e,r=t.target;r instanceof re&&r.extensionName===this.extensionName&&("node:create"===t.type&&this.M(r),"node:dispose"===t.type&&this.I(r))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}xe.EXTENSION_NAME=void 0;class Ee{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord);const r=this.jsonDoc.json.textures[t.index];if(void 0===r.sampler)return;const s=this.jsonDoc.json.samplers[r.sampler];void 0!==s.magFilter&&e.setMagFilter(s.magFilter),void 0!==s.minFilter&&e.setMinFilter(s.minFilter),void 0!==s.wrapS&&e.setWrapS(s.wrapS),void 0!==s.wrapT&&e.setWrapT(s.wrapT)}}const Ae={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},be={logger:U.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function Re(e,t){const r=t.bufferViews[e.bufferView],s=t.jsonDoc.json.bufferViews[e.bufferView],n=Ae[e.componentType],o=W.getElementSize(e.type),i=n.BYTES_PER_ELEMENT;if(void 0!==s.byteStride&&s.byteStride!==o*i)return function(e,t){const r=t.bufferViews[e.bufferView],s=t.jsonDoc.json.bufferViews[e.bufferView],n=Ae[e.componentType],o=W.getElementSize(e.type),i=n.BYTES_PER_ELEMENT,a=e.byteOffset||0,u=new n(e.count*o),c=new DataView(r.buffer,r.byteOffset,r.byteLength),l=s.byteStride;for(let t=0;t<e.count;t++)for(let r=0;r<o;r++){const s=a+t*l+r*i;let n;switch(e.componentType){case W.ComponentType.FLOAT:n=c.getFloat32(s,!0);break;case W.ComponentType.UNSIGNED_INT:n=c.getUint32(s,!0);break;case W.ComponentType.UNSIGNED_SHORT:n=c.getUint16(s,!0);break;case W.ComponentType.UNSIGNED_BYTE:n=c.getUint8(s);break;case W.ComponentType.SHORT:n=c.getInt16(s,!0);break;case W.ComponentType.BYTE:n=c.getInt8(s);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}u[t*o+r]=n}return u}(e,t);const a=r.byteOffset+(e.byteOffset||0);return new n(r.buffer.slice(a,a+e.count*o*i))}var _e;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(_e||(_e={}));class we{constructor(e,t,r){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=r;const s=e.getRoot(),n=s.listBuffers().length,o=s.listTextures().length;this.bufferURIGenerator=new Ie(n>1,r.basename),this.imageURIGenerator=new Ie(o>1,r.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},s=JSON.stringify(r);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const n={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},o=JSON.stringify(n);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(n));const i={index:this.textureDefIndexMap.get(o)};return 0!==t.getTexCoord()&&(i.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,i),i}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===b.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const s=M.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,s),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const t of this.N.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==T.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return we.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const r=this.O.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,r]of Array.from(this.O.entries()))e[r]=e[r]||[],e[r].push(t);return e}}we.BufferViewTarget=_e,we.BufferViewUsage=E,we.USAGE_TO_TARGET={[E.ARRAY_BUFFER]:_e.ARRAY_BUFFER,[E.ELEMENT_ARRAY_BUFFER]:_e.ELEMENT_ARRAY_BUFFER};class Ie{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}const{BufferViewUsage:Se}=we;var ve;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(ve||(ve={}));class Ne{constructor(){this.v=U.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=x.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||"glb"===v.extension(e)?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(e,t=be){const r=pe({},be,t),{json:s}=e,n=new Te;this.validate(e,r);const o=new Ee(e),i=s.asset,a=n.getRoot().getAsset();i.copyright&&(a.copyright=i.copyright),i.extras&&(a.extras=i.extras),void 0!==s.extras&&n.getRoot().setExtras(pe({},s.extras));const u=s.extensionsUsed||[],c=s.extensionsRequired||[];for(const e of r.extensions)if(u.includes(e.EXTENSION_NAME)){const t=n.createExtension(e).setRequired(c.includes(e.EXTENSION_NAME));for(const e of t.readDependencies)t.install(e,r.dependencies[e])}const l=s.buffers||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(T.BUFFER))).forEach((e=>e.preread(o,T.BUFFER))),o.buffers=l.map((e=>{const t=n.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),o.bufferViewBuffers=(s.bufferViews||[]).map(((t,r)=>{if(!o.bufferViews[r]){const s=e.json.buffers[t.buffer];o.bufferViews[r]=I.toView(s.uri?e.resources[s.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength)}return o.buffers[t.buffer]})),o.accessors=(s.accessors||[]).map((e=>{const t=n.createAccessor(e.name,o.bufferViewBuffers[e.bufferView]).setType(e.type);if(e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView&&!e.sparse)return t;let r;return r=void 0!==e.sparse?function(e,t){const r=Ae[e.componentType],s=W.getElementSize(e.type);let n;n=void 0!==e.bufferView?Re(e,t):new r(e.count*s);const o=e.sparse,i=o.count,a=pe({},e,o.indices,{count:i,type:"SCALAR"}),u=pe({},e,o.values,{count:i}),c=Re(a,t),l=Re(u,t);for(let e=0;e<a.count;e++)for(let t=0;t<s;t++)n[c[e]*s+t]=l[e*s+t];return n}(e,o):Re(e,o),t.setArray(r),t}));const h=s.images||[],f=s.textures||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(T.TEXTURE))).forEach((e=>e.preread(o,T.TEXTURE))),o.textures=h.map((t=>{const r=n.createTexture(t.name);if(t.extras&&r.setExtras(t.extras),void 0!==t.bufferView){const n=s.bufferViews[t.bufferView],o=e.json.buffers[n.buffer],i=n.byteOffset||0,a=(o.uri?e.resources[o.uri]:e.resources["@glb.bin"]).slice(i,i+n.byteLength);r.setImage(a)}else void 0!==t.uri&&(r.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&r.setURI(t.uri));if(void 0!==t.mimeType)r.setMimeType(t.mimeType);else if(t.uri){const e=v.extension(t.uri);r.setMimeType(M.extensionToMimeType(e))}return r})),o.materials=(s.materials||[]).map((e=>{const t=n.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const r=e.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&t.setBaseColorFactor(r.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==r.metallicFactor&&t.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&t.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){const e=r.baseColorTexture;t.setBaseColorTexture(o.textures[f[e.index].source]),o.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const r=e.emissiveTexture;t.setEmissiveTexture(o.textures[f[r.index].source]),o.setTextureInfo(t.getEmissiveTextureInfo(),r)}if(void 0!==e.normalTexture){const r=e.normalTexture;t.setNormalTexture(o.textures[f[r.index].source]),o.setTextureInfo(t.getNormalTextureInfo(),r),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const r=e.occlusionTexture;t.setOcclusionTexture(o.textures[f[r.index].source]),o.setTextureInfo(t.getOcclusionTextureInfo(),r),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){const e=r.metallicRoughnessTexture;t.setMetallicRoughnessTexture(o.textures[f[e.index].source]),o.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t}));const p=s.meshes||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(T.PRIMITIVE))).forEach((e=>e.preread(o,T.PRIMITIVE))),o.meshes=p.map((e=>{const t=n.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((r=>{const s=n.createPrimitive();r.extras&&s.setExtras(r.extras),void 0!==r.material&&s.setMaterial(o.materials[r.material]),void 0!==r.mode&&s.setMode(r.mode);for(const[e,t]of Object.entries(r.attributes||{}))s.setAttribute(e,o.accessors[t]);void 0!==r.indices&&s.setIndices(o.accessors[r.indices]);const i=e.extras&&e.extras.targetNames||[];(r.targets||[]).forEach(((e,t)=>{const r=i[t]||t.toString(),a=n.createPrimitiveTarget(r);for(const[t,r]of Object.entries(e))a.setAttribute(t,o.accessors[r]);s.addTarget(a)})),t.addPrimitive(s)})),t})),o.cameras=(s.cameras||[]).map((e=>{const t=n.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===te.Type.PERSPECTIVE){const r=e.perspective;t.setYFov(r.yfov),t.setZNear(r.znear),void 0!==r.zfar&&t.setZFar(r.zfar),void 0!==r.aspectRatio&&t.setAspectRatio(r.aspectRatio)}else{const r=e.orthographic;t.setZNear(r.znear).setZFar(r.zfar).setXMag(r.xmag).setYMag(r.ymag)}return t}));const g=s.nodes||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(T.NODE))).forEach((e=>e.preread(o,T.NODE))),o.nodes=g.map((e=>{const t=n.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const r=[0,0,0],s=[0,0,0,1],n=[1,1,1];F.decompose(e.matrix,r,s,n),t.setTranslation(r),t.setRotation(s),t.setScale(n)}return void 0!==e.weights&&t.setWeights(e.weights),t})),o.skins=(s.skins||[]).map((e=>{const t=n.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(o.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(o.nodes[e.skeleton]);for(const r of e.joints)t.addJoint(o.nodes[r]);return t})),g.map(((e,t)=>{const r=o.nodes[t];(e.children||[]).forEach((e=>r.addChild(o.nodes[e]))),void 0!==e.mesh&&r.setMesh(o.meshes[e.mesh]),void 0!==e.camera&&r.setCamera(o.cameras[e.camera]),void 0!==e.skin&&r.setSkin(o.skins[e.skin])})),o.animations=(s.animations||[]).map((e=>{const t=n.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const r=(e.samplers||[]).map((e=>{const r=n.createAnimationSampler().setInput(o.accessors[e.input]).setOutput(o.accessors[e.output]).setInterpolation(e.interpolation||Q.Interpolation.LINEAR);return e.extras&&r.setExtras(e.extras),t.addSampler(r),r}));return(e.channels||[]).forEach((e=>{const s=n.createAnimationChannel().setSampler(r[e.sampler]).setTargetNode(o.nodes[e.target.node]).setTargetPath(e.target.path);e.extras&&s.setExtras(e.extras),t.addChannel(s)})),t}));const d=s.scenes||[];return n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(T.SCENE))).forEach((e=>e.preread(o,T.SCENE))),o.scenes=d.map((e=>{const t=n.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>o.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==s.scene&&n.getRoot().setDefaultScene(o.scenes[s.scene]),n.getRoot().listExtensionsUsed().forEach((e=>e.read(o))),n}static validate(e,t){const r=e.json;if("2.0"!==r.asset.version)throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired)for(const e of r.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(r.extensionsUsed)for(const e of r.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const t=this._(I.assertView(e));this.L(t);const r=t.json;if(r.buffers&&r.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(I.assertView(e)))}async writeJSON(e,t={}){if(t.format===b.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return class{static write(e,t){const r=e.getRoot(),s={asset:pe({generator:"glTF-Transform v2.0.5"},r.getAsset()),extras:pe({},r.getExtras())},n={json:s,resources:{}},o=new we(e,n,t),i=t.logger||U.DEFAULT_INSTANCE,a=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),u=e.getRoot().listExtensionsUsed().filter((e=>a.has(e.extensionName))),c=e.getRoot().listExtensionsRequired().filter((e=>a.has(e.extensionName)));u.length<e.getRoot().listExtensionsUsed().length&&i.debug("Some extensions were not registered for I/O, and will not be written.");for(const e of u)for(const r of e.writeDependencies)e.install(r,t.dependencies[r]);function l(e,t,r,n){const i=[];let a=0;for(const t of e){const e=o.createAccessorDef(t);e.bufferView=s.bufferViews.length;const r=t.getArray(),n=I.pad(I.toView(r));e.byteOffset=a,a+=n.byteLength,i.push(n),o.accessorIndexMap.set(t,s.accessors.length),s.accessors.push(e)}const u={buffer:t,byteOffset:r,byteLength:I.concat(i).byteLength};return n&&(u.target=n),s.bufferViews.push(u),{buffers:i,byteLength:a}}function h(e,t,r){const n=e[0].getCount();let i=0;for(const t of e){const e=o.createAccessorDef(t);e.bufferView=s.bufferViews.length,e.byteOffset=i;const r=t.getElementSize(),n=t.getComponentSize();i+=I.padNumber(r*n),o.accessorIndexMap.set(t,s.accessors.length),s.accessors.push(e)}const a=n*i,u=new ArrayBuffer(a),c=new DataView(u);for(let t=0;t<n;t++){let r=0;for(const s of e){const e=s.getElementSize(),n=s.getComponentSize(),o=s.getComponentType(),a=s.getArray();for(let s=0;s<e;s++){const u=t*i+r+s*n,l=a[t*e+s];switch(o){case W.ComponentType.FLOAT:c.setFloat32(u,l,!0);break;case W.ComponentType.BYTE:c.setInt8(u,l);break;case W.ComponentType.SHORT:c.setInt16(u,l,!0);break;case W.ComponentType.UNSIGNED_BYTE:c.setUint8(u,l);break;case W.ComponentType.UNSIGNED_SHORT:c.setUint16(u,l,!0);break;case W.ComponentType.UNSIGNED_INT:c.setUint32(u,l,!0);break;default:throw new Error("Unexpected component type: "+o)}}r+=I.padNumber(e*n)}}return s.bufferViews.push({buffer:t,byteOffset:r,byteLength:a,byteStride:i,target:we.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(u)]}}const f=new Map;for(const t of e.getGraph().listEdges()){if(t.getParent()===r)continue;const e=t.getChild();if(e instanceof W){const r=f.get(e)||[];r.push(t),f.set(e,r)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=r.listTextures().map(((e,t)=>{const r=o.createPropertyDef(e);e.getMimeType()&&(r.mimeType=e.getMimeType());const s=e.getImage();return s&&o.createImageData(r,s,e),o.imageIndexMap.set(e,t),r})),u.filter((e=>e.prewriteTypes.includes(T.ACCESSOR))).forEach((e=>e.prewrite(o,T.ACCESSOR))),r.listAccessors().forEach((e=>{const t=o.accessorUsageGroupedByParent,r=o.accessorParents;if(o.accessorIndexMap.has(e))return;const s=f.get(e)||[],n=o.getAccessorUsage(e);if(o.addAccessorToUsageGroup(e,n),t.has(n)){const t=s[0].getParent(),n=r.get(t)||new Set;n.add(e),r.set(t,n)}})),u.filter((e=>e.prewriteTypes.includes(T.BUFFER))).forEach((e=>e.prewrite(o,T.BUFFER))),(r.listAccessors().length>0||r.listTextures().length>0||o.otherBufferViews.size>0)&&0===r.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],r.listBuffers().forEach(((e,r)=>{const i=o.createPropertyDef(e),a=o.accessorUsageGroupedByParent,u=o.accessorParents,c=e.listParents().filter((e=>e instanceof W)),f=new Set(c),p=[],g=s.buffers.length;let d=0;const m=o.listAccessorUsageGroups();for(const e in m)if(a.has(e))for(const r of Array.from(u.values())){const s=Array.from(r).filter((e=>f.has(e))).filter((t=>o.getAccessorUsage(t)===e));if(s.length)if(e!==Se.ARRAY_BUFFER||t.vertexLayout===x.INTERLEAVED){const t=e===Se.ARRAY_BUFFER?h(s,g,d):l(s,g,d);d+=t.byteLength,p.push(...t.buffers)}else for(const e of s){const t=h([e],g,d);d+=t.byteLength,p.push(...t.buffers)}}else{const t=m[e].filter((e=>f.has(e)));if(!t.length)continue;const r=l(t,g,d,e===Se.ELEMENT_ARRAY_BUFFER?we.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);d+=r.byteLength,p.push(...r.buffers)}if(o.imageBufferViews.length&&0===r)for(let e=0;e<o.imageBufferViews.length;e++)if(s.bufferViews[s.images[e].bufferView].byteOffset=d,d+=o.imageBufferViews[e].byteLength,p.push(o.imageBufferViews[e]),d%8){const e=8-d%8;d+=e,p.push(new Uint8Array(e))}if(o.otherBufferViews.has(e))for(const t of o.otherBufferViews.get(e))s.bufferViews.push({buffer:g,byteOffset:d,byteLength:t.byteLength}),o.otherBufferViewsIndexMap.set(t,s.bufferViews.length-1),d+=t.byteLength,p.push(t);if(d){let r;t.format===b.GLB?r="@glb.bin":(r=o.bufferURIGenerator.createURI(e,"bin"),i.uri=r),i.byteLength=d,n.resources[r]=I.concat(p)}s.buffers.push(i),o.bufferIndexMap.set(e,r)})),r.listAccessors().find((e=>!e.getBuffer()))&&i.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=r.listMaterials().map(((e,t)=>{const r=o.createPropertyDef(e);if(e.getAlphaMode()!==ue.AlphaMode.OPAQUE&&(r.alphaMode=e.getAlphaMode()),e.getAlphaMode()===ue.AlphaMode.MASK&&(r.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(r.doubleSided=!0),r.pbrMetallicRoughness={},F.eq(e.getBaseColorFactor(),[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),F.eq(e.getEmissiveFactor(),[0,0,0])||(r.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(r.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(r.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),s=e.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(t,s)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),s=e.getEmissiveTextureInfo();r.emissiveTexture=o.createTextureInfoDef(t,s)}if(e.getNormalTexture()){const t=e.getNormalTexture(),s=e.getNormalTextureInfo(),n=o.createTextureInfoDef(t,s);1!==e.getNormalScale()&&(n.scale=e.getNormalScale()),r.normalTexture=n}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),s=e.getOcclusionTextureInfo(),n=o.createTextureInfoDef(t,s);1!==e.getOcclusionStrength()&&(n.strength=e.getOcclusionStrength()),r.occlusionTexture=n}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),s=e.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(t,s)}return o.materialIndexMap.set(e,t),r})),s.meshes=r.listMeshes().map(((e,t)=>{const r=o.createPropertyDef(e);let s=null;return r.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const r=e.getMaterial();r&&(t.material=o.materialIndexMap.get(r)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const n=e.getIndices();n&&(t.indices=o.accessorIndexMap.get(n));for(const r of e.listSemantics())t.attributes[r]=o.accessorIndexMap.get(e.getAttribute(r));for(const r of e.listTargets()){const e={};for(const t of r.listSemantics())e[t]=o.accessorIndexMap.get(r.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!s&&(s=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(r.weights=e.getWeights()),s&&(r.extras=r.extras||{},r.extras.targetNames=s),o.meshIndexMap.set(e,t),r})),s.cameras=r.listCameras().map(((e,t)=>{const r=o.createPropertyDef(e);if(r.type=e.getType(),r.type===te.Type.PERSPECTIVE){r.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(r.perspective.aspectRatio=t)}else r.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return o.cameraIndexMap.set(e,t),r})),s.nodes=r.listNodes().map(((e,t)=>{const r=o.createPropertyDef(e);return F.eq(e.getTranslation(),[0,0,0])||(r.translation=e.getTranslation()),F.eq(e.getRotation(),[0,0,0,1])||(r.rotation=e.getRotation()),F.eq(e.getScale(),[1,1,1])||(r.scale=e.getScale()),e.getWeights().length&&(r.weights=e.getWeights()),o.nodeIndexMap.set(e,t),r})),s.skins=r.listSkins().map(((e,t)=>{const r=o.createPropertyDef(e),s=e.getInverseBindMatrices();s&&(r.inverseBindMatrices=o.accessorIndexMap.get(s));const n=e.getSkeleton();return n&&(r.skeleton=o.nodeIndexMap.get(n)),r.joints=e.listJoints().map((e=>o.nodeIndexMap.get(e))),o.skinIndexMap.set(e,t),r})),r.listNodes().forEach(((e,t)=>{const r=s.nodes[t],n=e.getMesh();n&&(r.mesh=o.meshIndexMap.get(n));const i=e.getCamera();i&&(r.camera=o.cameraIndexMap.get(i));const a=e.getSkin();a&&(r.skin=o.skinIndexMap.get(a)),e.listChildren().length>0&&(r.children=e.listChildren().map((e=>o.nodeIndexMap.get(e))))})),s.animations=r.listAnimations().map(((e,t)=>{const r=o.createPropertyDef(e),s=new Map;return r.samplers=e.listSamplers().map(((e,t)=>{const r=o.createPropertyDef(e);return r.input=o.accessorIndexMap.get(e.getInput()),r.output=o.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),s.set(e,t),r})),r.channels=e.listChannels().map((e=>{const t=o.createPropertyDef(e);return t.sampler=s.get(e.getSampler()),t.target={node:o.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),o.animationIndexMap.set(e,t),r})),s.scenes=r.listScenes().map(((e,t)=>{const r=o.createPropertyDef(e);return r.nodes=e.listChildren().map((e=>o.nodeIndexMap.get(e))),o.sceneIndexMap.set(e,t),r}));const p=r.getDefaultScene();return p&&(s.scene=r.listScenes().indexOf(p)),s.extensionsUsed=u.map((e=>e.extensionName)),s.extensionsRequired=c.map((e=>e.extensionName)),u.forEach((e=>e.write(o))),function(e){const t=[];for(const r in e){const s=e[r];(Array.isArray(s)&&0===s.length||null===s||""===s||s&&"object"==typeof s&&0===Object.keys(s).length)&&t.push(r)}for(const r of t)delete e[r]}(s),n}}.write(e,{format:t.format||b.GLTF,basename:t.basename||"",logger:this.v,vertexLayout:this.F,dependencies:pe({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:b.GLB}),s=new Uint32Array([1179937895,2,12]),n=JSON.stringify(t),o=I.pad(I.encodeText(n),32),i=I.toView(new Uint32Array([o.byteLength,1313821514])),a=I.concat([i,o]);s[s.length-1]+=a.byteLength;const u=Object.values(r)[0];if(!u||!u.byteLength)return I.concat([I.toView(s),a]);const c=I.pad(u,0),l=I.toView(new Uint32Array([c.byteLength,5130562])),h=I.concat([l,c]);return s[s.length-1]+=h.byteLength,I.concat([I.toView(s),a,h])}async P(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const r={json:JSON.parse(t),resources:{}};return await this.D(r,this.dirname(e)),this.L(r),r}async U(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=this._(t);return await this.D(r,this.dirname(e)),this.L(r),r}async D(e,t){var r=this;const s=[...e.json.images||[],...e.json.buffers||[]].map((async function(s){const n=s.uri;if(!n||n.match(/data:/))return Promise.resolve();e.resources[n]=await r.readURI(r.resolve(t,n),"view"),r.lastReadBytes+=e.resources[n].byteLength}));await Promise.all(s)}L(e){function t(t){if(t.uri)if(t.uri in e.resources)I.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const r=`__${q()}.${v.extension(t.uri)}`;e.resources[r]=I.createBufferFromDataURI(t.uri),t.uri=r}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:r}=e.json;return e={json:pe({},e.json),resources:pe({},e.resources)},t&&(e.json.images=t.map((e=>pe({},e)))),r&&(e.json.buffers=r.map((e=>pe({},e)))),e}_(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==ve.JSON)throw new Error("Missing required GLB JSON chunk.");const s=r[0],n=I.decodeText(I.toView(e,20,s)),o=JSON.parse(n),i=20+s;if(e.byteLength<=i)return{json:o,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+i,2);if(a[1]!==ve.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:o,resources:{"@glb.bin":I.toView(e,i+8,a[0])}}}}class Me extends Ne{constructor(e=null,t=$.DEFAULT_INIT){super(),this.k=void 0,this.J=void 0,this.$=void 0,this.V=void 0,this.q=!1,this.k=r(87).promises,this.J=r(7263),this.$=e,this.V=t}setAllowHTTP(e){if(e&&!this.$)throw new Error("NodeIO requires a Fetch API implementation for HTTP requests.");return this.q=e,this}async readURI(e,t){if($.isAbsoluteURL(e)){if(!this.q||!this.$)throw new Error("Network request blocked. Allow HTTP requests explicitly, if needed.");const r=await this.$(e,this.V);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}else switch(t){case"view":return this.k.readFile(e);case"text":return this.k.readFile(e,"utf8")}}resolve(e,t){return $.isAbsoluteURL(e)||$.isAbsoluteURL(t)?$.resolve(e,t):this.J.resolve(e,t)}dirname(e){return $.isAbsoluteURL(e)?$.dirname(e):this.J.dirname(e)}async write(e,t){const r=!!e.match(/\.glb$/);await(r?this.W(e,t):this.H(e,t))}async H(e,t){var r=this;this.lastWriteBytes=0;const{json:s,resources:n}=await this.writeJSON(t,{format:b.GLTF,basename:v.basename(e)}),{k:o,J:i}=this,a=i.dirname(e),u=JSON.stringify(s,null,2);this.lastWriteBytes+=u.length,await o.writeFile(e,u);const c=Object.keys(n).map((async function(e){if($.isAbsoluteURL(e)){if("bin"===v.extension(e))throw new Error(`Cannot write buffer to path "${e}".`);return}const t=d.from(n[e]);await o.writeFile(i.join(a,e),t),r.lastWriteBytes+=t.byteLength}));await Promise.all(c)}async W(e,t){const r=d.from(await this.writeBinary(t));await this.k.writeFile(e,r),this.lastWriteBytes=r.byteLength}}class Ce extends Ne{constructor(e){super(),this.J=void 0,this.J=e}async readURI(e,t){switch(t){case"view":return Deno.readFile(e);case"text":return Deno.readTextFile(e)}}resolve(e,t){return this.J.resolve(e,t)}dirname(e){return this.J.dirname(e)}}class Oe extends Ne{constructor(e=$.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,t){const r=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return $.resolve(e,t)}dirname(e){return $.dirname(e)}}},7485:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ALL_EXTENSIONS:()=>yt,Clearcoat:()=>he,DracoMeshCompression:()=>se,EmissiveStrength:()=>ge,INSTANCE_ATTRIBUTE:()=>T,IOR:()=>ye,InstancedMesh:()=>x,KHRONOS_EXTENSIONS:()=>mt,Light:()=>oe,LightsPunctual:()=>ae,Mapping:()=>Xe,MappingList:()=>Ke,MaterialsClearcoat:()=>pe,MaterialsEmissiveStrength:()=>me,MaterialsIOR:()=>xe,MaterialsPBRSpecularGlossiness:()=>Ie,MaterialsSheen:()=>Pe,MaterialsSpecular:()=>Ve,MaterialsTransmission:()=>He,MaterialsUnlit:()=>Ye,MaterialsVariants:()=>Ze,MaterialsVolume:()=>rt,MeshGPUInstancing:()=>A,MeshQuantization:()=>nt,MeshoptCompression:()=>D,PBRSpecularGlossiness:()=>_e,Packet:()=>ft,Sheen:()=>Ce,Specular:()=>Le,TextureBasisu:()=>at,TextureTransform:()=>lt,TextureWebP:()=>V,Transform:()=>ut,Transmission:()=>Ge,Unlit:()=>qe,Variant:()=>We,Volume:()=>et,XMP:()=>dt});var s=r(9928),n=r(8764).Buffer;new Uint8Array([0]);const o=[171,75,84,88,32,50,48,187,13,10,26,10];var i,a,u,c,l,h,f,p;!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(i||(i={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(a||(a={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(u||(u={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(c||(c={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(l||(l={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(h||(h={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(f||(f={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(p||(p={}));class g{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=i.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:a.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:u.UNSPECIFIED,colorPrimaries:c.SRGB,transferFunction:c.SRGB,flags:h.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class d{constructor(e,t,r,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const r=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,s)}}function m(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):n.from(e).toString("utf8")}function y(e){const t=new Uint8Array(e.buffer,e.byteOffset,o.length);if(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||t[4]!==o[4]||t[5]!==o[5]||t[6]!==o[6]||t[7]!==o[7]||t[8]!==o[8]||t[9]!==o[9]||t[10]!==o[10]||t[11]!==o[11])throw new Error("Missing KTX 2.0 identifier.");const r=new g,s=17*Uint32Array.BYTES_PER_ELEMENT,n=new d(e,o.length,s,!0);r.vkFormat=n._nextUint32(),r.typeSize=n._nextUint32(),r.pixelWidth=n._nextUint32(),r.pixelHeight=n._nextUint32(),r.pixelDepth=n._nextUint32(),r.layerCount=n._nextUint32(),r.faceCount=n._nextUint32();const i=n._nextUint32();r.supercompressionScheme=n._nextUint32();const a=n._nextUint32(),u=n._nextUint32(),c=n._nextUint32(),l=n._nextUint32(),h=n._nextUint64(),f=n._nextUint64(),p=new d(e,o.length+s,3*i*8,!0);for(let t=0;t<i;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const y=new d(e,a,u,!0),T={vendorId:y._skip(4)._nextUint16(),descriptorType:y._nextUint16(),versionNumber:y._nextUint16(),descriptorBlockSize:y._nextUint16(),colorModel:y._nextUint8(),colorPrimaries:y._nextUint8(),transferFunction:y._nextUint8(),flags:y._nextUint8(),texelBlockDimension:{x:y._nextUint8()+1,y:y._nextUint8()+1,z:y._nextUint8()+1,w:y._nextUint8()+1},bytesPlane:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],samples:[]},x=(T.descriptorBlockSize/4-6)/4;for(let e=0;e<x;e++)T.samples[e]={bitOffset:y._nextUint16(),bitLength:y._nextUint8(),channelID:y._nextUint8(),samplePosition:[y._nextUint8(),y._nextUint8(),y._nextUint8(),y._nextUint8()],sampleLower:y._nextUint32(),sampleUpper:y._nextUint32()};r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(T);const E=new d(e,c,l,!0);for(;E._offset<l;){const e=E._nextUint32(),t=E._scan(e),s=m(t),n=E._scan(e-t.byteLength);r.keyValue[s]=s.match(/^ktx/i)?m(n):n,E._offset%4&&E._skip(4-E._offset%4)}if(f<=0)return r;const A=new d(e,h,f,!0),b=A._nextUint16(),R=A._nextUint16(),_=A._nextUint32(),w=A._nextUint32(),I=A._nextUint32(),S=A._nextUint32(),v=[];for(let e=0;e<i;e++)v.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const N=h+A._offset,M=N+_,C=M+w,O=C+I,P=new Uint8Array(e.buffer,e.byteOffset+N,_),U=new Uint8Array(e.buffer,e.byteOffset+M,w),F=new Uint8Array(e.buffer,e.byteOffset+C,I),B=new Uint8Array(e.buffer,e.byteOffset+O,S);return r.globalData={endpointCount:b,selectorCount:R,imageDescs:v,endpointsData:P,selectorsData:U,tablesData:F,extendedData:B},r}const T="INSTANCE_ATTRIBUTE";class x extends s.ExtensionProperty{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[s.PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}x.EXTENSION_NAME="EXT_mesh_gpu_instancing";const E="EXT_mesh_gpu_instancing";class A extends s.Extension{constructor(...e){super(...e),this.extensionName=E,this.provideTypes=[s.PropertyType.NODE],this.prewriteTypes=[s.PropertyType.ACCESSOR]}createInstancedMesh(){return new x(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[E])return;const s=t.extensions[E],n=this.createInstancedMesh();for(const t in s.attributes)n.setAttribute(t,e.accessors[s.attributes[t]]);e.nodes[r].setExtension(E,n)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const r of t.listAttributes())e.addAccessorToUsageGroup(r,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((r=>{const s=r.getExtension(E);if(s){const n=e.nodeIndexMap.get(r),o=t.json.nodes[n],i={attributes:{}};s.listSemantics().forEach((t=>{const r=s.getAttribute(t);i.attributes[t]=e.accessorIndexMap.get(r)})),o.extensions=o.extensions||{},o.extensions[E]=i}})),this}}function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}var R,_,w;A.EXTENSION_NAME=E,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(R||(R={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(_||(_={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(w||(w={}));const{BYTE:I,SHORT:S,FLOAT:v}=s.Accessor.ComponentType,{normalize:N,denormalize:M}=s.MathUtils;function C(e,t,r,n){const{filter:o,bits:i}=n,a={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(r!==_.ATTRIBUTES)return a;if(o!==w.NONE){let r=e.getNormalized()?function(e){const t=e.getComponentType(),r=e.getArray(),s=new Float32Array(r.length);for(let e=0;e<r.length;e++)s[e]=M(r[e],t);return s}(e):new Float32Array(a.array);switch(o){case w.EXPONENTIAL:a.byteStride=4*e.getElementSize(),a.componentType=v,a.normalized=!1,a.array=t.encodeFilterExp(r,e.getCount(),a.byteStride,i);break;case w.OCTAHEDRAL:a.byteStride=i>8?8:4,a.componentType=i>8?S:I,a.normalized=!0,r=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let r=0,s=e.length/3;r<s;r++)t[4*r]=e[3*r],t[4*r+1]=e[3*r+1],t[4*r+2]=e[3*r+2];return t}(r):r,a.array=t.encodeFilterOct(r,e.getCount(),a.byteStride,i);break;case w.QUATERNION:a.byteStride=8,a.componentType=S,a.normalized=!0,a.array=t.encodeFilterQuat(r,e.getCount(),a.byteStride,i);break;default:throw new Error("Invalid filter.")}a.min=e.getMin([]),a.max=e.getMax([]),e.getNormalized()&&(a.min=a.min.map((t=>M(t,e.getComponentType()))),a.max=a.max.map((t=>M(t,e.getComponentType())))),a.normalized&&(a.min=a.min.map((e=>N(e,a.componentType))),a.max=a.max.map((e=>N(e,a.componentType))))}else a.byteStride%4&&(a.array=function(e,t){const r=s.BufferUtils.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,n=new e.constructor(e.length/t*r);for(let s=0;s*t<e.length;s++)for(let o=0;o<t;o++)n[s*r+o]=e[s*t+o];return n}(a.array,e.getElementSize()),a.byteStride=a.array.byteLength/e.getCount());return a}function O(e,t){return t===s.WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some((e=>e instanceof s.Primitive&&e.getMode()===s.Primitive.Mode.TRIANGLES))?_.TRIANGLES:_.INDICES:_.ATTRIBUTES}function P(e,t){const r=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof s.Root)));for(const t of r){const r=t.getName(),s=t.getAttributes().key||"";if("indices"===r)return{filter:w.NONE};if("attributes"===r){if("POSITION"===s)return{filter:w.NONE};if("TEXCOORD_0"===s)return{filter:w.NONE};if("NORMAL"===s)return{filter:w.OCTAHEDRAL,bits:8};if("TANGENT"===s)return{filter:w.OCTAHEDRAL,bits:8};if(s.startsWith("JOINTS_"))return{filter:w.NONE};if(s.startsWith("WEIGHTS_"))return{filter:w.NONE}}if("output"===r){const t=U(e);return"rotation"===t?{filter:w.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:w.EXPONENTIAL,bits:12}:{filter:w.NONE}}if("input"===r)return{filter:w.NONE};if("inverseBindMatrices"===r)return{filter:w.NONE}}return{filter:w.NONE}}function U(e){for(const t of e.listParents())if(t instanceof s.AnimationSampler)for(const e of t.listParents())if(e instanceof s.AnimationChannel)return e.getTargetPath();return null}const F="EXT_meshopt_compression",B={method:R.QUANTIZE};class D extends s.Extension{constructor(...e){super(...e),this.extensionName=F,this.prereadTypes=[s.PropertyType.BUFFER,s.PropertyType.PRIMITIVE],this.prewriteTypes=[s.PropertyType.BUFFER,s.PropertyType.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=B,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=b({},B,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${F}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${F}]: Missing WASM support.`)}return t===s.PropertyType.BUFFER?this._prereadBuffers(e):t===s.PropertyType.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((r,n)=>{if(!r.extensions||!r.extensions[F])return;const o=r.extensions[F],i=o.byteOffset||0,a=o.byteLength||0,u=o.count,c=o.byteStride,l=new Uint8Array(u*c),h=t.json.buffers[r.buffer],f=s.BufferUtils.toView(h.uri?t.resources[h.uri]:t.resources[s.GLB_BUFFER],i,a);this._decoder.decodeGltfBuffer(l,u,c,f,o.mode,o.filter),e.bufferViews[n]=l}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((r=>{var s;r.extensions&&r.extensions[F]&&(s=t.json.buffers[r.buffer]).extensions&&s.extensions.EXT_meshopt_compression&&s.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[r.buffer],e.buffers[r.extensions[F].buffer])}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const r of e.listParents())r instanceof s.Accessor&&r.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===s.PropertyType.ACCESSOR?this._prewriteAccessors(e):t===s.PropertyType.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,r=this._encoder,n=this._encoderOptions,o=this.document.createBuffer(),i=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const o of this.document.getRoot().listAccessors()){if("weights"===U(o))continue;const a=e.getAccessorUsage(o),u=O(o,a),c=n.method===R.FILTER?P(o,this.document):{filter:w.NONE},l=C(o,r,u,c),{array:h,byteStride:f}=l,p=o.getBuffer();if(!p)throw new Error(`${F}: Missing buffer for accessor.`);const g=this.document.getRoot().listBuffers().indexOf(p),d=[a,u,c.filter,f,g].join(":");let m=this._encoderBufferViews[d],y=this._encoderBufferViewData[d],T=this._encoderBufferViewAccessors[d];m&&y||(T=this._encoderBufferViewAccessors[d]=[],y=this._encoderBufferViewData[d]=[],m=this._encoderBufferViews[d]={buffer:i,target:s.WriterContext.USAGE_TO_TARGET[a],byteOffset:0,byteLength:0,byteStride:a===s.WriterContext.BufferViewUsage.ARRAY_BUFFER?f:void 0,extensions:{[F]:{buffer:g,byteOffset:0,byteLength:0,mode:u,filter:c.filter!==w.NONE?c.filter:void 0,byteStride:f,count:0}}});const x=e.createAccessorDef(o);x.componentType=l.componentType,x.normalized=l.normalized,x.byteOffset=m.byteLength,x.min&&l.min&&(x.min=l.min),x.max&&l.max&&(x.max=l.max),e.accessorIndexMap.set(o,t.accessors.length),t.accessors.push(x),T.push(x),y.push(new Uint8Array(h.buffer,h.byteOffset,h.byteLength)),m.byteLength+=h.byteLength,m.extensions.EXT_meshopt_compression.count+=o.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],o=this._encoderBufferViewData[r],i=this.document.getRoot().listBuffers()[n.extensions[F].buffer],a=e.otherBufferViews.get(i)||[],{count:u,byteStride:c,mode:l}=n.extensions[F],h=s.BufferUtils.concat(o),f=t.encodeGltfBuffer(h,u,c,l),p=s.BufferUtils.pad(f);n.extensions[F].byteLength=f.byteLength,o.length=0,o.push(p),a.push(p),e.otherBufferViews.set(i,a)}}write(e){let t=0;for(const r in this._encoderBufferViews){const n=this._encoderBufferViews[r],o=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[r][0]),i=this._encoderBufferViewAccessors[r];for(const e of i)e.bufferView=o;const a=e.jsonDoc.json.bufferViews[o],u=a.byteOffset||0;Object.assign(a,n),a.byteOffset=t,a.extensions[F].byteOffset=u,t+=s.BufferUtils.padNumber(n.byteLength)}const r=this._encoderFallbackBuffer,n=e.bufferIndexMap.get(r),o=e.jsonDoc.json.buffers[n];return o.byteLength=t,o.extensions={[F]:{fallback:!0}},r.dispose(),this}}D.EXTENSION_NAME=F,D.EncoderMethod=R;const L="EXT_texture_webp";class j{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=s.BufferUtils.decodeText(e.slice(0,4)),r=s.BufferUtils.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==r)return null;const n=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<n.byteLength;){const e=s.BufferUtils.decodeText(new Uint8Array([n.getUint8(o),n.getUint8(o+1),n.getUint8(o+2),n.getUint8(o+3)])),t=n.getUint32(o+4,!0);if("VP8 "===e)return[16383&n.getInt16(o+14,!0),16383&n.getInt16(o+16,!0)];if("VP8L"===e){const e=n.getUint8(o+9),t=n.getUint8(o+10),r=n.getUint8(o+11);return[1+((63&t)<<8|e),1+((15&n.getUint8(o+12))<<10|r<<2|(192&t)>>6)]}o+=8+t+t%2}return null}getChannels(e){return 4}}class V extends s.Extension{constructor(...e){super(...e),this.extensionName=L,this.prereadTypes=[s.PropertyType.TEXTURE]}static register(){s.ImageUtils.registerFormat("image/webp",new j)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[L]&&(e.source=e.extensions[L].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/webp"===r.getMimeType()){const s=e.imageIndexMap.get(r);(t.json.textures||[]).forEach((e=>{e.source===s&&(e.extensions=e.extensions||{},e.extensions[L]={source:e.source},delete e.source)}))}})),this}}V.EXTENSION_NAME=L;const k="KHR_draco_mesh_compression";let G,z,H,q;function $(e,t){const r=new G.DecoderBuffer;try{if(r.Init(t,t.length),e.GetEncodedGeometryType(r)!==G.TRIANGULAR_MESH)throw new Error(`[${k}] Unknown geometry type.`);const s=new G.Mesh;if(!e.DecodeBufferToMesh(r,s).ok()||0===s.ptr)throw new Error(`[${k}] Decoding failure.`);return s}finally{G.destroy(r)}}function Y(e,t){const r=3*t.num_faces();let s,n;if(t.num_points()<=65534){const o=r*Uint16Array.BYTES_PER_ELEMENT;s=G._malloc(o),e.GetTrianglesUInt16Array(t,o,s),n=new Uint16Array(G.HEAPU16.buffer,s,r).slice()}else{const o=r*Uint32Array.BYTES_PER_ELEMENT;s=G._malloc(o),e.GetTrianglesUInt32Array(t,o,s),n=new Uint32Array(G.HEAPU32.buffer,s,r).slice()}return G._free(s),n}function X(e,t,r,s){const n=H[s.componentType],o=z[s.componentType],i=r.num_components(),a=t.num_points()*i,u=a*o.BYTES_PER_ELEMENT,c=G._malloc(u);e.GetAttributeDataArrayForAllPoints(t,r,n,u,c);const l=new o(G.HEAPF32.buffer,c,a).slice();return G._free(c),l}var K,W;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(K||(K={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(W||(W={}));const J={[W.POSITION]:14,[W.NORMAL]:10,[W.COLOR]:8,[W.TEX_COORD]:12,[W.GENERIC]:12},Z={decodeSpeed:5,encodeSpeed:5,method:K.EDGEBREAKER,quantizationBits:J,quantizationVolume:"mesh"};function Q(e,t=Z){const r=b({},Z,t);r.quantizationBits=b({},J,t.quantizationBits);const s=new q.Encoder,n=new q.MeshBuilder,o=new q.Mesh,i={},a=new q.DracoInt8Array;for(const t of e.listSemantics()){const a=e.getAttribute(t),u=ee(t),c=te(n,a.getComponentType(),o,q[u],a.getCount(),a.getElementSize(),a.getArray());if(-1===c)throw new Error(`Error compressing "${t}" attribute.`);if(i[t]=c,"mesh"===r.quantizationVolume||"POSITION"!==t)s.SetAttributeQuantization(q[u],r.quantizationBits[u]);else{if("object"!=typeof r.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=r,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);s.SetAttributeExplicitQuantization(q[u],r.quantizationBits[u],a.getElementSize(),e.min,t)}}}const u=e.getIndices();if(!u)throw new Error("Primitive must have indices.");n.AddFacesToMesh(o,u.getCount()/3,u.getArray()),s.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),s.SetTrackEncodedProperties(!0),r.method===K.SEQUENTIAL||e.listTargets().length>0?s.SetEncodingMethod(q.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(q.MESH_EDGEBREAKER_ENCODING);const c=s.EncodeMeshToDracoBuffer(o,a);if(c<=0)throw new Error("Error applying Draco compression.");const l=new Uint8Array(c);for(let e=0;e<c;++e)l[e]=a.GetValue(e);const h=e.getAttribute("POSITION").getCount(),f=s.GetNumberOfEncodedPoints(),p=3*s.GetNumberOfEncodedFaces();if(e.listTargets().length>0&&f!==h)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return q.destroy(a),q.destroy(o),q.destroy(n),q.destroy(s),{numVertices:f,numIndices:p,data:l,attributeIDs:i}}function ee(e){return"POSITION"===e?W.POSITION:"NORMAL"===e?W.NORMAL:e.startsWith("COLOR_")?W.COLOR:e.startsWith("TEXCOORD_")?W.TEX_COORD:W.GENERIC}function te(e,t,r,n,o,i,a){switch(t){case s.Accessor.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(r,n,o,i,a);case s.Accessor.ComponentType.BYTE:return e.AddInt8Attribute(r,n,o,i,a);case s.Accessor.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(r,n,o,i,a);case s.Accessor.ComponentType.SHORT:return e.AddInt16Attribute(r,n,o,i,a);case s.Accessor.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(r,n,o,i,a);case s.Accessor.ComponentType.FLOAT:return e.AddFloatAttribute(r,n,o,i,a);default:throw new Error(`Unexpected component type, "${t}".`)}}const re="KHR_draco_mesh_compression";class se extends s.Extension{constructor(...e){super(...e),this.extensionName=re,this.prereadTypes=[s.PropertyType.PRIMITIVE],this.prewriteTypes=[s.PropertyType.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,G=this._decoderModule,z={[s.Accessor.ComponentType.FLOAT]:Float32Array,[s.Accessor.ComponentType.UNSIGNED_INT]:Uint32Array,[s.Accessor.ComponentType.UNSIGNED_SHORT]:Uint16Array,[s.Accessor.ComponentType.UNSIGNED_BYTE]:Uint8Array,[s.Accessor.ComponentType.SHORT]:Int16Array,[s.Accessor.ComponentType.BYTE]:Int8Array},H={[s.Accessor.ComponentType.FLOAT]:G.DT_FLOAT32,[s.Accessor.ComponentType.UNSIGNED_INT]:G.DT_UINT32,[s.Accessor.ComponentType.UNSIGNED_SHORT]:G.DT_UINT16,[s.Accessor.ComponentType.UNSIGNED_BYTE]:G.DT_UINT8,[s.Accessor.ComponentType.SHORT]:G.DT_INT16,[s.Accessor.ComponentType.BYTE]:G.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,q=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${re}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),r=e.jsonDoc,n=new Map;try{const o=r.json.meshes||[];for(const i of o)for(const o of i.primitives){if(!o.extensions||!o.extensions[re])continue;const i=o.extensions[re];let[a,u]=n.get(i.bufferView)||[];if(!u||!a){const e=r.json.bufferViews[i.bufferView],o=r.json.buffers[e.buffer],c=s.BufferUtils.toView(o.uri?r.resources[o.uri]:r.resources[s.GLB_BUFFER],e.byteOffset||0,e.byteLength);a=new this._decoderModule.Decoder,u=$(a,c),n.set(i.bufferView,[a,u]),t.debug(`[${re}] Decompressed ${c.byteLength} bytes.`)}for(const t in o.attributes){const r=e.jsonDoc.json.accessors[o.attributes[t]],s=a.GetAttributeByUniqueId(u,i.attributes[t]),n=X(a,u,s,r);e.accessors[o.attributes[t]].setArray(n)}void 0!==o.indices&&e.accessors[o.indices].setArray(Y(a,u))}}finally{for(const[e,t]of Array.from(n.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${re}] Please install extension dependency, "draco3d.encoder".`);const r=this.document.getLogger();r.debug(`[${re}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(e){const t=e.getLogger(),r=new Set,n=new Set;for(const o of e.getRoot().listMeshes())for(const e of o.listPrimitives())e.getIndices()?e.getMode()!==s.Primitive.Mode.TRIANGLES?(n.add(e),t.warn(`[${re}] Skipping Draco compression on non-TRIANGLES primitive.`)):r.add(e):(n.add(e),t.warn(`[${re}] Skipping Draco compression on non-indexed primitive.`));const o=e.getRoot().listAccessors(),i=new Map;for(let e=0;e<o.length;e++)i.set(o[e],e);const a=new Map,u=new Set,c=new Map;for(const t of Array.from(r)){let r=ne(t,i);if(u.has(r))c.set(t,r);else{if(a.has(t.getIndices())){const r=t.getIndices(),s=r.clone();i.set(s,e.getRoot().listAccessors().length-1),t.swap(r,s)}for(const r of t.listAttributes())if(a.has(r)){const s=r.clone();i.set(s,e.getRoot().listAccessors().length-1),t.swap(r,s)}r=ne(t,i),u.add(r),c.set(t,r),a.set(t.getIndices(),r);for(const e of t.listAttributes())a.set(e,r)}}for(const e of Array.from(a.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(s.PropertyType.PRIMITIVE)||!t.has(s.PropertyType.ROOT))throw new Error(`[${re}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const e of Array.from(r)){const t=c.get(e),r=e.getIndices();if(a.get(r)!==t||e.listAttributes().some((e=>a.get(e)!==t)))throw new Error(`[${re}] Draco primitives must share all, or no, accessors.`)}for(const e of Array.from(n)){const t=e.getIndices();if(a.has(t)||e.listAttributes().some((e=>a.has(e))))throw new Error(`[${re}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return c}(this.document),o=new Map;let i="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?r.warn(`[${re}]: quantizationVolume=scene requires exactly 1 scene.`):i=(0,s.bounds)(this.document.getRoot().listScenes().pop()));for(const t of Array.from(n.keys())){const r=n.get(t);if(!r)throw new Error("Unexpected primitive.");if(o.has(r)){o.set(r,o.get(r));continue}const s=t.getIndices(),a=e.jsonDoc.json.accessors,u=Q(t,b({},this._encoderOptions,{quantizationVolume:i}));o.set(r,u);const c=e.createAccessorDef(s);c.count=u.numIndices,e.accessorIndexMap.set(s,a.length),a.push(c);for(const r of t.listSemantics()){const s=t.getAttribute(r),n=e.createAccessorDef(s);n.count=u.numVertices,e.accessorIndexMap.set(s,a.length),a.push(n)}const l=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(l)||e.otherBufferViews.set(l,[]),e.otherBufferViews.get(l).push(u.data)}return r.debug(`[${re}] Compressed ${n.size} primitives.`),e.extensionData[re]={primitiveHashMap:n,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[re];for(const r of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(r)];for(let n=0;n<r.listPrimitives().length;n++){const o=r.listPrimitives()[n],i=s.primitives[n],a=t.primitiveHashMap.get(o);if(!a)continue;const u=t.primitiveEncodingMap.get(a);i.extensions=i.extensions||{},i.extensions[re]={bufferView:e.otherBufferViewsIndexMap.get(u.data),attributes:u.attributeIDs}}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==re)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==re))}return this}}function ne(e,t){const r=[],s=e.getIndices();r.push(t.get(s));for(const s of e.listAttributes())r.push(t.get(s));return r.sort().join("|")}se.EXTENSION_NAME=re,se.EncoderMethod=K;class oe extends s.ExtensionProperty{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[s.PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:oe.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return s.ColorUtils.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return s.ColorUtils.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}oe.EXTENSION_NAME="KHR_lights_punctual",oe.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const ie="KHR_lights_punctual";class ae extends s.Extension{constructor(...e){super(...e),this.extensionName=ie}createLight(e=""){return new oe(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[ie])return this;const r=(t.json.extensions[ie].lights||[]).map((e=>{var t,r;const s=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&s.setColor(e.color),void 0!==e.intensity&&s.setIntensity(e.intensity),void 0!==e.range&&s.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&s.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(r=e.spot)?void 0:r.outerConeAngle)&&s.setOuterConeAngle(e.spot.outerConeAngle),s}));return t.json.nodes.forEach(((t,s)=>{t.extensions&&t.extensions[ie]&&e.nodes[s].setExtension(ie,r[t.extensions[ie].light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const r=[],n=new Map;for(const e of this.properties){const t=e,o={type:t.getType()};s.MathUtils.eq(t.getColor(),[1,1,1])||(o.color=t.getColor()),1!==t.getIntensity()&&(o.intensity=t.getIntensity()),null!=t.getRange()&&(o.range=t.getRange()),t.getName()&&(o.name=t.getName()),t.getType()===oe.Type.SPOT&&(o.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),r.push(o),n.set(t,r.length-1)}return this.document.getRoot().listNodes().forEach((r=>{const s=r.getExtension(ie);if(s){const o=e.nodeIndexMap.get(r),i=t.json.nodes[o];i.extensions=i.extensions||{},i.extensions[ie]={light:n.get(s)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[ie]={lights:r},this}}ae.EXTENSION_NAME=ie;const{R:ue,G:ce,B:le}=s.TextureChannel;class he extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new s.TextureInfo(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new s.TextureInfo(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new s.TextureInfo(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:ue})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ce})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:ue|ce|le})}}he.EXTENSION_NAME="KHR_materials_clearcoat";const fe="KHR_materials_clearcoat";class pe extends s.Extension{constructor(...e){super(...e),this.extensionName=fe}createClearcoat(){return new he(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[fe]){const n=this.createClearcoat();e.materials[s].setExtension(fe,n);const o=t.extensions[fe];if(void 0!==o.clearcoatFactor&&n.setClearcoatFactor(o.clearcoatFactor),void 0!==o.clearcoatRoughnessFactor&&n.setClearcoatRoughnessFactor(o.clearcoatRoughnessFactor),void 0!==o.clearcoatTexture){const t=o.clearcoatTexture;n.setClearcoatTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getClearcoatTextureInfo(),t)}if(void 0!==o.clearcoatRoughnessTexture){const t=o.clearcoatRoughnessTexture;n.setClearcoatRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==o.clearcoatNormalTexture){const t=o.clearcoatNormalTexture;n.setClearcoatNormalTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&n.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const s=r.getExtension(fe);if(s){const n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{};const i=o.extensions[fe]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const t=s.getClearcoatTexture(),r=s.getClearcoatTextureInfo();i.clearcoatTexture=e.createTextureInfoDef(t,r)}if(s.getClearcoatRoughnessTexture()){const t=s.getClearcoatRoughnessTexture(),r=s.getClearcoatRoughnessTextureInfo();i.clearcoatRoughnessTexture=e.createTextureInfoDef(t,r)}if(s.getClearcoatNormalTexture()){const t=s.getClearcoatNormalTexture(),r=s.getClearcoatNormalTextureInfo();i.clearcoatNormalTexture=e.createTextureInfoDef(t,r),1!==s.getClearcoatNormalScale()&&(i.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}})),this}}pe.EXTENSION_NAME=fe;class ge extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ge.EXTENSION_NAME="KHR_materials_emissive_strength";const de="KHR_materials_emissive_strength";class me extends s.Extension{constructor(...e){super(...e),this.extensionName=de}createEmissiveStrength(){return new ge(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[de]){const s=this.createEmissiveStrength();e.materials[r].setExtension(de,s);const n=t.extensions[de];void 0!==n.emissiveStrength&&s.setEmissiveStrength(n.emissiveStrength)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const s=r.getExtension(de);if(s){const n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{},o.extensions[de]={emissiveStrength:s.getEmissiveStrength()}}})),this}}me.EXTENSION_NAME=de;class ye extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}ye.EXTENSION_NAME="KHR_materials_ior";const Te="KHR_materials_ior";class xe extends s.Extension{constructor(...e){super(...e),this.extensionName=Te}createIOR(){return new ye(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Te]){const s=this.createIOR();e.materials[r].setExtension(Te,s);const n=t.extensions[Te];void 0!==n.ior&&s.setIOR(n.ior)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const s=r.getExtension(Te);if(s){const n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{},o.extensions[Te]={ior:s.getIOR()}}})),this}}xe.EXTENSION_NAME=Te;const{R:Ee,G:Ae,B:be,A:Re}=s.TextureChannel;class _e extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new s.TextureInfo(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new s.TextureInfo(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return s.ColorUtils.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(s.ColorUtils.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Ee|Ae|be|Re})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Ee|Ae|be|Re})}}_e.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const we="KHR_materials_pbrSpecularGlossiness";class Ie extends s.Extension{constructor(...e){super(...e),this.extensionName=we}createPBRSpecularGlossiness(){return new _e(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[we]){const n=this.createPBRSpecularGlossiness();e.materials[s].setExtension(we,n);const o=t.extensions[we];if(void 0!==o.diffuseFactor&&n.setDiffuseFactor(o.diffuseFactor),void 0!==o.specularFactor&&n.setSpecularFactor(o.specularFactor),void 0!==o.glossinessFactor&&n.setGlossinessFactor(o.glossinessFactor),void 0!==o.diffuseTexture){const t=o.diffuseTexture;n.setDiffuseTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getDiffuseTextureInfo(),t)}if(void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;n.setSpecularGlossinessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const s=r.getExtension(we);if(s){const n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{};const i=o.extensions[we]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const t=s.getDiffuseTexture(),r=s.getDiffuseTextureInfo();i.diffuseTexture=e.createTextureInfoDef(t,r)}if(s.getSpecularGlossinessTexture()){const t=s.getSpecularGlossinessTexture(),r=s.getSpecularGlossinessTextureInfo();i.specularGlossinessTexture=e.createTextureInfoDef(t,r)}}})),this}}Ie.EXTENSION_NAME=we;const{R:Se,G:ve,B:Ne,A:Me}=s.TextureChannel;class Ce extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new s.TextureInfo(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new s.TextureInfo(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return s.ColorUtils.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",s.ColorUtils.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Se|ve|Ne})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Me})}}Ce.EXTENSION_NAME="KHR_materials_sheen";const Oe="KHR_materials_sheen";class Pe extends s.Extension{constructor(...e){super(...e),this.extensionName=Oe}createSheen(){return new Ce(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[Oe]){const n=this.createSheen();e.materials[s].setExtension(Oe,n);const o=t.extensions[Oe];if(void 0!==o.sheenColorFactor&&n.setSheenColorFactor(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&n.setSheenRoughnessFactor(o.sheenRoughnessFactor),void 0!==o.sheenColorTexture){const t=o.sheenColorTexture;n.setSheenColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSheenColorTextureInfo(),t)}if(void 0!==o.sheenRoughnessTexture){const t=o.sheenRoughnessTexture;n.setSheenRoughnessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const s=r.getExtension(Oe);if(s){const n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{};const i=o.extensions[Oe]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const t=s.getSheenColorTexture(),r=s.getSheenColorTextureInfo();i.sheenColorTexture=e.createTextureInfoDef(t,r)}if(s.getSheenRoughnessTexture()){const t=s.getSheenRoughnessTexture(),r=s.getSheenRoughnessTextureInfo();i.sheenRoughnessTexture=e.createTextureInfoDef(t,r)}}})),this}}Pe.EXTENSION_NAME=Oe;const{R:Ue,G:Fe,B:Be,A:De}=s.TextureChannel;class Le extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new s.TextureInfo(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new s.TextureInfo(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return s.ColorUtils.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",s.ColorUtils.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:De})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Ue|Fe|Be})}}Le.EXTENSION_NAME="KHR_materials_specular";const je="KHR_materials_specular";class Ve extends s.Extension{constructor(...e){super(...e),this.extensionName=je}createSpecular(){return new Le(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[je]){const n=this.createSpecular();e.materials[s].setExtension(je,n);const o=t.extensions[je];if(void 0!==o.specularFactor&&n.setSpecularFactor(o.specularFactor),void 0!==o.specularColorFactor&&n.setSpecularColorFactor(o.specularColorFactor),void 0!==o.specularTexture){const t=o.specularTexture;n.setSpecularTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSpecularTextureInfo(),t)}if(void 0!==o.specularColorTexture){const t=o.specularColorTexture;n.setSpecularColorTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(je);if(n){const o=e.materialIndexMap.get(r),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[je]={};if(1!==n.getSpecularFactor()&&(a.specularFactor=n.getSpecularFactor()),s.MathUtils.eq(n.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const t=n.getSpecularTexture(),r=n.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(t,r)}if(n.getSpecularColorTexture()){const t=n.getSpecularColorTexture(),r=n.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(t,r)}}})),this}}Ve.EXTENSION_NAME=je;const{R:ke}=s.TextureChannel;class Ge extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new s.TextureInfo(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:ke})}}Ge.EXTENSION_NAME="KHR_materials_transmission";const ze="KHR_materials_transmission";class He extends s.Extension{constructor(...e){super(...e),this.extensionName=ze}createTransmission(){return new Ge(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[ze]){const n=this.createTransmission();e.materials[s].setExtension(ze,n);const o=t.extensions[ze];if(void 0!==o.transmissionFactor&&n.setTransmissionFactor(o.transmissionFactor),void 0!==o.transmissionTexture){const t=o.transmissionTexture;n.setTransmissionTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const s=r.getExtension(ze);if(s){const n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{};const i=o.extensions[ze]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const t=s.getTransmissionTexture(),r=s.getTransmissionTextureInfo();i.transmissionTexture=e.createTextureInfoDef(t,r)}}})),this}}He.EXTENSION_NAME=ze;class qe extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[s.PropertyType.MATERIAL]}}qe.EXTENSION_NAME="KHR_materials_unlit";const $e="KHR_materials_unlit";class Ye extends s.Extension{constructor(...e){super(...e),this.extensionName=$e}createUnlit(){return new qe(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,r)=>{t.extensions&&t.extensions[$e]&&e.materials[r].setExtension($e,this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{if(r.getExtension($e)){const s=e.materialIndexMap.get(r),n=t.json.materials[s];n.extensions=n.extensions||{},n.extensions[$e]={}}})),this}}Ye.EXTENSION_NAME=$e;class Xe extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Xe.EXTENSION_NAME="KHR_materials_variants";class Ke extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[s.PropertyType.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Ke.EXTENSION_NAME="KHR_materials_variants";class We extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}We.EXTENSION_NAME="KHR_materials_variants";const Je="KHR_materials_variants";class Ze extends s.Extension{constructor(...e){super(...e),this.extensionName=Je}createMappingList(){return new Ke(this.document.getGraph())}createVariant(e=""){return new We(this.document.getGraph(),e)}createMapping(){return new Xe(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof We))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Je])return this;const r=(t.json.extensions[Je].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,s)=>{const n=e.meshes[s];(t.primitives||[]).forEach(((t,s)=>{if(!t.extensions||!t.extensions[Je])return;const o=this.createMappingList(),i=t.extensions[Je];for(const t of i.mappings){const s=this.createMapping();void 0!==t.material&&s.setMaterial(e.materials[t.material]);for(const e of t.variants||[])s.addVariant(r[e]);o.addMapping(s)}n.listPrimitives()[s].setExtension(Je,o)}))})),this}write(e){const t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;const s=[],n=new Map;for(const t of r)n.set(t,s.length),s.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const r=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,s)=>{const o=t.getExtension(Je);if(!o)return;const i=e.jsonDoc.json.meshes[r].primitives[s],a=o.listMappings().map((t=>{const r=e.createPropertyDef(t),s=t.getMaterial();return s&&(r.material=e.materialIndexMap.get(s)),r.variants=t.listVariants().map((e=>n.get(e))),r}));i.extensions=i.extensions||{},i.extensions[Je]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[Je]={variants:s},this}}Ze.EXTENSION_NAME=Je;const{G:Qe}=s.TextureChannel;class et extends s.ExtensionProperty{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[s.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new s.TextureInfo(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Qe})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return s.ColorUtils.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",s.ColorUtils.hexToFactor(e,t))}}et.EXTENSION_NAME="KHR_materials_volume";const tt="KHR_materials_volume";class rt extends s.Extension{constructor(...e){super(...e),this.extensionName=tt}createVolume(){return new et(this.document.getGraph())}read(e){const t=e.jsonDoc,r=t.json.textures||[];return(t.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[tt]){const n=this.createVolume();e.materials[s].setExtension(tt,n);const o=t.extensions[tt];if(void 0!==o.thicknessFactor&&n.setThicknessFactor(o.thicknessFactor),void 0!==o.attenuationDistance&&n.setAttenuationDistance(o.attenuationDistance),void 0!==o.attenuationColor&&n.setAttenuationColor(o.attenuationColor),void 0!==o.thicknessTexture){const t=o.thicknessTexture;n.setThicknessTexture(e.textures[r[t.index].source]),e.setTextureInfo(n.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((r=>{const n=r.getExtension(tt);if(n){const o=e.materialIndexMap.get(r),i=t.json.materials[o];i.extensions=i.extensions||{};const a=i.extensions[tt]={};if(n.getThicknessFactor()>0&&(a.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(a.attenuationDistance=n.getAttenuationDistance()),s.MathUtils.eq(n.getAttenuationColor(),[1,1,1])||(a.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const t=n.getThicknessTexture(),r=n.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(t,r)}}})),this}}rt.EXTENSION_NAME=tt;const st="KHR_mesh_quantization";class nt extends s.Extension{constructor(...e){super(...e),this.extensionName=st}read(e){return this}write(e){return this}}nt.EXTENSION_NAME=st;const ot="KHR_texture_basisu";class it{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=y(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=y(e).dataFormatDescriptor[0];if(t.colorModel===u.ETC1S)return 2===t.samples.length&&15==(15&t.samples[1].channelID)?4:3;if(t.colorModel===u.UASTC)return 3==(15&t.samples[0].channelID)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=y(e),r=this.getChannels(e)>3;let s=0;for(let e=0;e<t.levels.length;e++){const n=t.levels[e];s+=n.uncompressedByteLength?n.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(r?16:8)}return s}}class at extends s.Extension{constructor(...e){super(...e),this.extensionName=ot,this.prereadTypes=[s.PropertyType.TEXTURE]}static register(){s.ImageUtils.registerFormat("image/ktx2",new it)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions[ot]&&(e.source=e.extensions[ot].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((r=>{if("image/ktx2"===r.getMimeType()){const s=e.imageIndexMap.get(r);t.json.textures.forEach((e=>{e.source===s&&(e.extensions=e.extensions||{},e.extensions[ot]={source:e.source},delete e.source)}))}})),this}}at.EXTENSION_NAME=ot;class ut extends s.ExtensionProperty{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[s.PropertyType.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}ut.EXTENSION_NAME="KHR_texture_transform";const ct="KHR_texture_transform";class lt extends s.Extension{constructor(...e){super(...e),this.extensionName=ct}createTransform(){return new ut(this.document.getGraph())}read(e){for(const[t,r]of Array.from(e.textureInfos.entries())){if(!r.extensions||!r.extensions[ct])continue;const e=this.createTransform(),s=r.extensions[ct];void 0!==s.offset&&e.setOffset(s.offset),void 0!==s.rotation&&e.setRotation(s.rotation),void 0!==s.scale&&e.setScale(s.scale),void 0!==s.texCoord&&e.setTexCoord(s.texCoord),t.setExtension(ct,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,r]of t){const t=e.getExtension(ct);if(!t)continue;r.extensions=r.extensions||{};const n={},o=s.MathUtils.eq;o(t.getOffset(),[0,0])||(n.offset=t.getOffset()),0!==t.getRotation()&&(n.rotation=t.getRotation()),o(t.getScale(),[1,1])||(n.scale=t.getScale()),null!=t.getTexCoord()&&(n.texCoord=t.getTexCoord()),r.extensions[ct]=n}return this}}lt.EXTENSION_NAME=ct;const ht=[s.PropertyType.ROOT,s.PropertyType.SCENE,s.PropertyType.NODE,s.PropertyType.MESH,s.PropertyType.MATERIAL,s.PropertyType.TEXTURE,s.PropertyType.ANIMATION];class ft extends s.ExtensionProperty{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=ht}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",b({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const r=b({},this.get("properties"));return t?r[e]=t:delete r[e],this.set("properties",r)}toJSONLD(){return b({"@context":pt(this.get("context"))},pt(this.get("properties")))}fromJSONLD(e){const t=(e=pt(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function pt(e){return JSON.parse(JSON.stringify(e))}ft.EXTENSION_NAME="KHR_xmp_json_ld";const gt="KHR_xmp_json_ld";class dt extends s.Extension{constructor(...e){super(...e),this.extensionName=gt}createPacket(){return new ft(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const r=null==(t=e.jsonDoc.json.extensions)?void 0:t[gt];if(!r||!r.packets)return this;const s=e.jsonDoc.json,n=this.document.getRoot(),o=r.packets.map((e=>this.createPacket().fromJSONLD(e))),i=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],a=[[n],n.listScenes(),n.listNodes(),n.listMeshes(),n.listMaterials(),n.listTextures(),n.listAnimations()];for(let e=0;e<i.length;e++){const t=i[e]||[];for(let r=0;r<t.length;r++){const s=t[r];s.extensions&&s.extensions[gt]&&a[e][r].setExtension(gt,o[s.extensions[gt].packet])}}return this}write(e){const{json:t}=e.jsonDoc,r=[];for(const n of this.properties){r.push(n.toJSONLD());for(const o of n.listParents()){let n;switch(o.propertyType){case s.PropertyType.ROOT:n=t.asset;break;case s.PropertyType.SCENE:n=t.scenes[e.sceneIndexMap.get(o)];break;case s.PropertyType.NODE:n=t.nodes[e.nodeIndexMap.get(o)];break;case s.PropertyType.MESH:n=t.meshes[e.meshIndexMap.get(o)];break;case s.PropertyType.MATERIAL:n=t.materials[e.materialIndexMap.get(o)];break;case s.PropertyType.TEXTURE:n=t.images[e.imageIndexMap.get(o)];break;case s.PropertyType.ANIMATION:n=t.animations[e.animationIndexMap.get(o)];break;default:n=null,this.document.getLogger().warn(`[${gt}]: Unsupported parent property, "${o.propertyType}"`)}n&&(n.extensions=n.extensions||{},n.extensions[gt]={packet:r.length-1})}}return r.length>0&&(t.extensions=t.extensions||{},t.extensions[gt]={packets:r}),this}}dt.EXTENSION_NAME=gt;const mt=[se,ae,pe,me,xe,Ie,Ve,Pe,He,Ye,Ze,rt,nt,at,lt,dt],yt=[A,D,V,...mt]},9800:(e,t,r)=>{"use strict";r.r(t),r.d(t,{QUANTIZE_DEFAULTS:()=>Ae,TEXTURE_RESIZE_DEFAULTS:()=>Ye,TextureResizeFilter:()=>$e,bounds:()=>s.bounds,center:()=>P,colorspace:()=>F,dedup:()=>D,dequantize:()=>V,inspect:()=>z,instance:()=>Q,metalRough:()=>se,normals:()=>ue,partition:()=>pe,prune:()=>he,quantize:()=>be,reorder:()=>Be,resample:()=>Pe,sequence:()=>Ve,tangents:()=>Ge,textureResize:()=>Xe,unweld:()=>oe,weld:()=>We});var s=r(9928),n=r(2861),o=r.n(n),i=r(8897),a=r.n(i),u=r(8764).Buffer;function c(e,t,r={}){const s=document.createElement("canvas");s.width=e.shape[0],s.height=e.shape[1];const n=s.getContext("2d"),o=n.getImageData(0,0,s.width,s.height);try{h(e,o.data)}catch(e){return f.from(Promise.reject(e))}n.putImageData(o,0,0);const i=r.quality?r.quality/100:void 0;switch(t){case"canvas":return s;case"jpg":case"jpeg":return l(s,"image/jpeg",i);case"png":return l(s,"image/png");default:throw new Error("[ndarray-pixels] Unsupported file type: "+t)}}function l(e,t,r){const s=new Promise(((s,n)=>{e.toBlob((async e=>{e?s(new Uint8Array(await e.arrayBuffer())):n(new Error("[ndarray-pixels] Failed to canvas.toBlob()."))}),t,r)}));return f.from(s)}function h(e,t,r=-1){if(4===e.shape.length)return h(e.pick(r),t,0);if(3===e.shape.length)if(3===e.shape[2])a().assign(o()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),e),a().assigns(o()(t,[e.shape[0]*e.shape[1]],[4],3),255);else if(4===e.shape[2])a().assign(o()(t,[e.shape[0],e.shape[1],4],[4,4*e.shape[0],1]),e);else{if(1!==e.shape[2])throw new Error("[ndarray-pixels] Incompatible array shape.");a().assign(o()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),o()(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),a().assigns(o()(t,[e.shape[0]*e.shape[1]],[4],3),255)}else{if(2!==e.shape.length)throw new Error("[ndarray-pixels] Incompatible array shape.");a().assign(o()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),o()(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),a().assigns(o()(t,[e.shape[0]*e.shape[1]],[4],3),255)}return t}class f{constructor(e){this._promise=void 0,this._promise=e}on(e,t){return"data"===e?this._promise.then(t):"error"===e?this._promise.catch(t):"end"===e&&this._promise.finally(t),this}static from(e){return new f(e)}}async function p(e,t){return e instanceof Uint8Array&&void 0!==u&&(e=u.from(e)),new Promise(((r,s)=>{!function(e,t,r){if(r=r||t,e instanceof Uint8Array){if("string"!=typeof t)throw new Error("[ndarray-pixels] Type must be given for Uint8Array image data");const r=new Blob([e],{type:t});e=URL.createObjectURL(r)}const s=new Image;s.crossOrigin="anonymous",s.onload=function(){URL.revokeObjectURL(e);const t=document.createElement("canvas");t.width=s.width,t.height=s.height;const n=t.getContext("2d");n.drawImage(s,0,0);const i=n.getImageData(0,0,s.width,s.height);r(null,o()(new Uint8Array(i.data),[s.width,s.height,4],[4,4*s.width,1],0))},s.onerror=t=>{URL.revokeObjectURL(e),r(t)},s.src=e}(e,t,((e,t)=>{t&&!e?r(t):s(e)}))}))}async function g(e,t){return new Promise(((r,s)=>{const n=[],o=t.replace("image/","");c(e,o).on("data",(e=>n.push(e))).on("end",(()=>r(function(e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let s=0;for(const t of e)r.set(t,s),s+=t.byteLength;return r}(n)))).on("error",(e=>s(e)))}))}var d=r(7485),m=r(7160),y=r(5975);const T=(e,t)=>{if(e<=-t||e>=t)return 0;const r=e*Math.PI;return Math.sin(r)/r*Math.sin(r/t)/(r/t)},x=e=>Math.round(16383*e),E=(e,t,r,s,n)=>{const o=n?2:3,i=1/r,a=Math.min(1,r),u=o/a,c=Math.floor(2*(u+1)),l=new Int16Array((c+2)*t);let h=0;for(let r=0;r<t;r++){const n=(r+.5)*i+s,c=Math.max(0,Math.floor(n-u)),f=Math.min(e-1,Math.ceil(n+u)),p=f-c+1,g=new Float32Array(p),d=new Int16Array(p);let m=0,y=0;for(let e=c;e<=f;e++){const t=T((e+.5-n)*a,o);m+=t,g[y]=t,y++}let E=0;for(let e=0;e<g.length;e++){const t=g[e]/m;E+=t,d[e]=x(t)}d[t>>1]+=x(1-E);let A=0;for(;A<d.length&&0===d[A];)A++;let b=d.length-1;for(;b>0&&0===d[b];)b--;const R=b-A+1;l[h++]=c+A,l[h++]=R,l.set(d.subarray(A,b+1),h),h+=R}return l},A=e=>e<0?0:e>255?255:e,b=(e,t,r)=>{const[s,n]=e.shape,[o]=t.shape;for(let s=0;s<n;s++){const n=s;let i=0;for(let a=0;a<o;a++){let o=r[i++],u=0,c=0,l=0,h=0;for(let t=r[i++];t>0;t--){const t=r[i++];u+=t*e.get(o,s,0),c+=t*e.get(o,s,1),l+=t*e.get(o,s,2),h+=t*e.get(o,s,3),o++}t.set(a,n,0,A(u+8192>>14)),t.set(a,n,1,A(c+8192>>14)),t.set(a,n,2,A(l+8192>>14)),t.set(a,n,3,A(h+8192>>14))}}};var R,_;function w(e,t,r){const[s,n]=e.shape,[i,a]=t.shape,u=a/n,c=E(s,i,i/s,0,r===R.LANCZOS_2),l=E(n,a,u,0,r===R.LANCZOS_2),h=o()(new Uint8Array(i*n*4),[n,i,4]),f=h.transpose(1,0),p=t.transpose(1,0);b(e,f,c),b(h,p,l)}function I(e,t){w(e,t,R.LANCZOS_3)}function S(e,t){w(e,t,R.LANCZOS_2)}function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function N(e,t){return Object.defineProperty(t,"name",{value:e}),t}async function M(e,t,r){if(!e)return null;const s=e.getImage();if(!s)return null;const n=await p(s,e.getMimeType());for(let e=0;e<n.shape[0];++e)for(let t=0;t<n.shape[1];++t)r(n,e,t);const o=await g(n,"image/png");return t.setImage(o).setMimeType("image/png")}(_=R||(R={}))[_.LANCZOS_3=3]="LANCZOS_3",_[_.LANCZOS_2=2]="LANCZOS_2";class C{constructor(){this._map=new Map}get size(){return this._map.size}has(e){return this._map.has(e)}add(e,t){let r=this._map.get(e);return r||(r=new Set,this._map.set(e,r)),r.add(t),this}get(e){return this._map.get(e)||new Set}keys(){return this._map.keys()}}const O={pivot:"center"};function P(e=O){const t=v({},O,e);return N("center",(e=>{const r=e.getLogger(),n=e.getRoot(),o=n.listAnimations().length>0||n.listSkins().length>0;e.getRoot().listScenes().forEach(((i,a)=>{let u;if(r.debug(`center: Scene ${a+1} / ${n.listScenes().length}.`),"string"==typeof t.pivot){const e=(0,s.bounds)(i);u=[(e.max[0]-e.min[0])/2+e.min[0],(e.max[1]-e.min[1])/2+e.min[1],(e.max[2]-e.min[2])/2+e.min[2]],"above"===t.pivot&&(u[1]=e.max[1]),"below"===t.pivot&&(u[1]=e.min[1])}else u=t.pivot;r.debug(`center: Pivot "${u.join(", ")}".`);const c=[-1*u[0],-1*u[1],-1*u[2]];if(o){r.debug("center: Model contains animation or skin. Adding a wrapper node.");const t=e.createNode("Pivot").setTranslation(c);i.listChildren().forEach((e=>t.addChild(e))),i.addChild(t)}else r.debug("center: Skipping wrapper, offsetting all root nodes."),i.listChildren().forEach((e=>{const t=e.getTranslation();e.setTranslation([t[0]+c[0],t[1]+c[1],t[2]+c[2]])}))})),r.debug("center: Complete.")}))}const U="colorspace";function F(e){return N(U,(t=>{const r=t.getLogger();if("linear"===e.inputEncoding)return void r.info(`${U}: Vertex colors already linear. Skipping conversion.`);if("sRGB"!==e.inputEncoding)return void r.error(`${U}: Unknown input encoding "${e.inputEncoding}"  should be "sRGB" or "linear". Skipping conversion.`);const s=new Set;function n(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function o(e){const t=[0,0,0];let r;for(let o=0;r=e.getAttribute(`COLOR_${o}`);o++)if(!s.has(r)){for(let e=0;e<r.getCount();e++)r.getElement(e,t),t[0]=n(t[0]),t[1]=n(t[1]),t[2]=n(t[2]),r.setElement(e,t);s.add(r)}}t.getRoot().listMeshes().forEach((e=>e.listPrimitives().forEach(o))),r.debug(`${U}: Complete.`)}))}const B={propertyTypes:[s.PropertyType.ACCESSOR,s.PropertyType.MESH,s.PropertyType.TEXTURE,s.PropertyType.MATERIAL]},D=function(e=B){const t=v({},B,e),r=new Set(t.propertyTypes);for(const e of t.propertyTypes)if(!B.propertyTypes.includes(e))throw new Error(`dedup: Unsupported deduplication on type "${e}".`);return N("dedup",(e=>{const t=e.getLogger();r.has(s.PropertyType.ACCESSOR)&&function(e,t){const r=new Set,n=new Set,o=new Set,i=new Set,a=t.getRoot().listMeshes();a.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((e=>n.add(e)));const t=e.getIndices();t&&r.add(t)}))}));for(const e of t.getRoot().listAnimations())for(const t of e.listSamplers()){const e=t.getInput(),r=t.getOutput();e&&o.add(e),r&&i.add(r)}function u(e){const t=new Map;for(let r=0;r<e.length;r++){const n=e[r],o=s.BufferUtils.toView(n.getArray());if(!t.has(n))for(let r=0;r<e.length;r++){const i=e[r];n!==i&&(t.has(i)||n.getType()===i.getType()&&n.getComponentType()===i.getComponentType()&&n.getCount()===i.getCount()&&n.getNormalized()===i.getNormalized()&&s.BufferUtils.equals(o,s.BufferUtils.toView(i.getArray()))&&t.set(i,n))}}return t}const c=u(Array.from(r));e.debug(`dedup: Found ${c.size} duplicates among ${r.size} indices.`);const l=u(Array.from(n));e.debug(`dedup: Found ${l.size} duplicates among ${n.size} attributes.`);const h=u(Array.from(o)),f=u(Array.from(i));e.debug(`dedup: Found ${h.size+f.size} duplicates among ${o.size+i.size} animation accessors.`),a.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((t=>{l.has(t)&&e.swap(t,l.get(t))}));const t=e.getIndices();t&&c.has(t)&&e.swap(t,c.get(t))}))})),Array.from(c.keys()).forEach((e=>e.dispose())),Array.from(l.keys()).forEach((e=>e.dispose()));for(const e of t.getRoot().listAnimations())for(const t of e.listSamplers()){const e=t.getInput(),r=t.getOutput();e&&h.has(e)&&t.swap(e,h.get(e)),r&&f.has(r)&&t.swap(r,f.get(r))}Array.from(h.keys()).forEach((e=>e.dispose())),Array.from(f.keys()).forEach((e=>e.dispose()))}(t,e),r.has(s.PropertyType.MESH)&&function(e,t){const r=t.getRoot(),n=new Map;r.listAccessors().forEach(((e,t)=>n.set(e,t))),r.listMaterials().forEach(((e,t)=>n.set(e,t)));const o=r.listMeshes().length,i=new Map;for(const e of r.listMeshes()){const t=[];for(const r of e.listPrimitives())t.push(L(r,n));const r=t.join(";");if(i.has(r)){const t=i.get(r);e.listParents().forEach((r=>{r.propertyType!==s.PropertyType.ROOT&&r.swap(e,t)})),e.dispose()}else i.set(r,e)}e.debug(`dedup: Found ${o-i.size} duplicates among ${o} meshes.`)}(t,e),r.has(s.PropertyType.TEXTURE)&&function(e,t){const r=t.getRoot(),n=r.listTextures(),o=new Map;for(let e=0;e<n.length;e++){const t=n[e],r=t.getImage();if(!o.has(t))for(let e=0;e<n.length;e++){const i=n[e],a=i.getImage();if(t===i)continue;if(o.has(i))continue;if(t.getMimeType()!==i.getMimeType())continue;const u=t.getSize(),c=i.getSize();u&&c&&u[0]===c[0]&&u[1]===c[1]&&r&&a&&s.BufferUtils.equals(r,a)&&o.set(i,t)}}e.debug(`dedup: Found ${o.size} duplicates among ${r.listTextures().length} textures.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof s.Root||r.swap(e,t)})),e.dispose()}))}(t,e),r.has(s.PropertyType.MATERIAL)&&function(e,t){const r=t.getRoot(),n=r.listMaterials(),o=new Map;for(let e=0;e<n.length;e++){const t=n[e];if(!o.has(t))for(let e=0;e<n.length;e++){const r=n[e];t!==r&&(o.has(r)||t.equals(r)&&o.set(r,t))}}e.debug(`dedup: Found ${o.size} duplicates among ${r.listMaterials().length} materials.`),Array.from(o.entries()).forEach((([e,t])=>{e.listParents().forEach((r=>{r instanceof s.Root||r.swap(e,t)})),e.dispose()}))}(t,e),t.debug("dedup: Complete.")}))};function L(e,t){const r=[];for(const s of e.listSemantics()){const n=e.getAttribute(s);r.push(s+":"+t.get(n))}if(e instanceof s.Primitive){const s=e.getIndices();s&&r.push("indices:"+t.get(s));const n=e.getMaterial();n&&r.push("material:"+t.get(n)),r.push("mode:"+e.getMode());for(const s of e.listTargets())r.push("target:"+L(s,t))}return r.join(",")}const j={pattern:/^((?!JOINTS_).)*$/};function V(e=j){const t=v({},j,e);return N("dequantize",(e=>{const r=e.getLogger();for(const r of e.getRoot().listMeshes())for(const e of r.listPrimitives())k(e,t);e.createExtension(d.MeshQuantization).dispose(),r.debug("dequantize: Complete.")}))}function k(e,t){for(const r of e.listSemantics())G(r,e.getAttribute(r),t);for(const r of e.listTargets())for(const e of r.listSemantics())G(e,r.getAttribute(e),t)}function G(e,t,r){if(!t.getArray())return;if(!r.pattern.test(e))return;if(t.getComponentSize()>=4)return;const s=t.getArray(),n=new Float32Array(s.length);for(let e=0,r=t.getCount(),o=[];e<r;e++)o=t.getElement(e,o),t.setArray(n).setElement(e,o).setArray(s);t.setArray(n).setNormalized(!1)}function z(e){return{scenes:H(e),meshes:q(e),materials:$(e),textures:Y(e),animations:X(e)}}function H(e){return{properties:e.getRoot().listScenes().map((e=>{const t=e.listChildren()[0],r=(0,s.bounds)(e);return{name:e.getName(),rootName:t?t.getName():"",bboxMin:W(r.min),bboxMax:W(r.max)}}))}}function q(e){return{properties:e.getRoot().listMeshes().map((e=>{const t=e.listParents().filter((e=>"Root"!==e.propertyType)).length;let r=0,n=0;const o=new Set,i=new Set,a=new Set;e.listPrimitives().forEach((e=>{for(const t of e.listSemantics()){const r=e.getAttribute(t);o.add(t+":"+J(r.getArray())),a.add(r)}for(const t of e.listTargets())t.listAttributes().forEach((e=>a.add(e)));const t=e.getIndices();t&&(i.add(J(t.getArray())),a.add(t)),n+=e.listAttributes()[0].getCount(),r+=function(e){const t=e.getIndices(),r=e.getAttribute("POSITION");switch(e.getMode()){case s.Primitive.Mode.POINTS:return r.getCount();case s.Primitive.Mode.LINES:return t?t.getCount()/2:r.getCount()/2;case s.Primitive.Mode.LINE_LOOP:return r.getCount();case s.Primitive.Mode.LINE_STRIP:return r.getCount()-1;case s.Primitive.Mode.TRIANGLES:return t?t.getCount()/3:r.getCount()/3;case s.Primitive.Mode.TRIANGLE_STRIP:case s.Primitive.Mode.TRIANGLE_FAN:return r.getCount()-2;default:throw new Error("Unexpected mode: "+e.getMode())}}(e)}));let u=0;Array.from(a).forEach((e=>u+=e.getArray().byteLength));const c=e.listPrimitives().map((e=>K[e.getMode()]));return{name:e.getName(),mode:Array.from(new Set(c)),primitives:e.listPrimitives().length,glPrimitives:r,vertices:n,indices:Array.from(i).sort(),attributes:Array.from(o).sort(),instances:t,size:u}}))}}function $(e){return{properties:e.getRoot().listMaterials().map((t=>{const r=t.listParents().filter((e=>"Root"!==e.propertyType)).length,n=new Set(t.listExtensions()),o=e.getGraph().listEdges().filter((e=>{const r=e.getChild(),o=e.getParent();return r instanceof s.Texture&&o===t||!!(r instanceof s.Texture&&o instanceof s.ExtensionProperty&&n.has(o))})).map((e=>e.getName()));return{name:t.getName(),instances:r,textures:o,alphaMode:t.getAlphaMode(),doubleSided:t.getDoubleSided()}}))}}function Y(e){return{properties:e.getRoot().listTextures().map((t=>{const r=t.listParents().filter((e=>"Root"!==e.propertyType)).length,n=e.getGraph().listParentEdges(t).map((e=>e.getName())).filter((e=>"texture"!==e)),o=s.ImageUtils.getSize(t.getImage(),t.getMimeType());return{name:t.getName(),uri:t.getURI(),slots:Array.from(new Set(n)),instances:r,mimeType:t.getMimeType(),resolution:o?o.join("x"):"",size:t.getImage().byteLength,gpuSize:s.ImageUtils.getMemSize(t.getImage(),t.getMimeType())}}))}}function X(e){return{properties:e.getRoot().listAnimations().map((e=>{let t=1/0,r=-1/0;e.listSamplers().forEach((e=>{const s=e.getInput();s&&(t=Math.min(t,s.getMin([])[0]),r=Math.max(r,s.getMax([])[0]))}));let s=0,n=0;const o=new Set;return e.listSamplers().forEach((e=>{const t=e.getInput(),r=e.getOutput();t&&(n+=t.getCount(),o.add(t),r&&o.add(r))})),Array.from(o).forEach((e=>{s+=e.getArray().byteLength})),{name:e.getName(),channels:e.listChannels().length,samplers:e.listSamplers().length,duration:Math.round(1e3*(r-t))/1e3,keyframes:n,size:s}}))}}const K=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function W(e){for(let t=0;t<e.length;t++)e[t].toFixed&&(e[t]=Number(e[t].toFixed(5)));return e}function J(e){return e.constructor.name.replace("Array","").toLowerCase()}const Z={};function Q(e=Z){return v({},Z,e),N("instance",(e=>{const t=e.getLogger(),r=e.getRoot(),n=e.createExtension(d.MeshGPUInstancing);if(r.listAnimations().length)throw new Error("instance: Instancing is not currently supported for animated models.");let o=0,i=0;for(const a of r.listScenes()){const r=new Map;a.traverse((e=>{const t=e.getMesh();t&&r.set(t,(r.get(t)||new Set).add(e))}));const u=[];for(const c of Array.from(r.keys())){const l=Array.from(r.get(c));if(l.length<2)continue;if(l.some((e=>e.getSkin())))continue;const h=te(e,n,c,l.length),f=h.getAttribute("TRANSLATION"),p=h.getAttribute("ROTATION"),g=h.getAttribute("SCALE"),d=e.createNode().setMesh(c).setExtension("EXT_mesh_gpu_instancing",h);a.addChild(d);let m=!1,y=!1,T=!1;for(let e=0;e<l.length;e++){let t,r,n;const o=l[e];f.setElement(e,t=o.getWorldTranslation()),p.setElement(e,r=o.getWorldRotation()),g.setElement(e,n=o.getWorldScale()),s.MathUtils.eq(t,[0,0,0])||(m=!0),s.MathUtils.eq(r,[0,0,0,1])||(y=!0),s.MathUtils.eq(n,[1,1,1])||(T=!0),o.setMesh(null),u.push(o)}m||f.dispose(),y||p.dispose(),T||g.dispose(),ee(u,t),o++,i+=l.length}}o>0?t.info(`instance: Created ${o} batches, with ${i} total instances.`):(t.info("instance: No meshes with multiple parent nodes were found."),n.dispose()),t.debug("instance: Complete.")}))}function ee(e,t){let r,n=0;for(;r=e.pop();){if(r.listChildren().length||r.getCamera()||r.getMesh()||r.getSkin()||r.listExtensions().length)continue;const t=r.getParent();t instanceof s.Node&&e.push(t),r.dispose(),n++}t.debug(`instance: Removed ${n} unused nodes.`)}function te(e,t,r,s){const n=r.listPrimitives()[0].getAttribute("POSITION").getBuffer(),o=e.createAccessor().setType("VEC3").setArray(new Float32Array(3*s)).setBuffer(n),i=e.createAccessor().setType("VEC4").setArray(new Float32Array(4*s)).setBuffer(n),a=e.createAccessor().setType("VEC3").setArray(new Float32Array(3*s)).setBuffer(n);return t.createInstancedMesh().setAttribute("TRANSLATION",o).setAttribute("ROTATION",i).setAttribute("SCALE",a)}const re={};function se(e=re){return v({},re,e),N("metalRough",(async e=>{const t=e.getLogger();if(!e.getRoot().listExtensionsUsed().map((e=>e.extensionName)).includes("KHR_materials_pbrSpecularGlossiness"))return void t.warn("metalRough: KHR_materials_pbrSpecularGlossiness not found on document.");const r=e.createExtension(d.MaterialsIOR),s=e.createExtension(d.MaterialsSpecular),n=e.createExtension(d.MaterialsPBRSpecularGlossiness),o=new Set;for(const t of e.getRoot().listMaterials()){const n=t.getExtension("KHR_materials_pbrSpecularGlossiness");if(!n)continue;const i=s.createSpecular().setSpecularFactor(1).setSpecularColorFactor(n.getSpecularFactor());o.add(n.getSpecularGlossinessTexture()),o.add(t.getBaseColorTexture()),o.add(t.getMetallicRoughnessTexture()),t.setBaseColorFactor(n.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",r.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",i);const a=n.getDiffuseTexture();a&&(t.setBaseColorTexture(a),t.getBaseColorTextureInfo().copy(n.getDiffuseTextureInfo()));const u=n.getSpecularGlossinessTexture();if(u){const r=n.getSpecularGlossinessTextureInfo(),s=e.createTexture();await M(u,s,((e,t,r)=>{e.set(t,r,3,255)})),i.setSpecularTexture(s),i.setSpecularColorTexture(s),i.getSpecularTextureInfo().copy(r),i.getSpecularColorTextureInfo().copy(r);const o=n.getGlossinessFactor(),a=e.createTexture();await M(u,a,((e,t,r)=>{const s=255-Math.round(e.get(t,r,3)*o);e.set(t,r,0,0),e.set(t,r,1,s),e.set(t,r,2,0),e.set(t,r,3,255)})),t.setMetallicRoughnessTexture(a),t.getMetallicRoughnessTextureInfo().copy(r)}else i.setSpecularColorFactor(n.getSpecularFactor()),t.setRoughnessFactor(1-n.getGlossinessFactor());t.setExtension("KHR_materials_pbrSpecularGlossiness",null)}n.dispose();for(const e of o)e&&1===e.listParents().length&&e.dispose();t.debug("metalRough: Complete.")}))}const ne={};function oe(e=ne){return v({},ne,e),N("unweld",(e=>{const t=e.getLogger(),r=new Map;for(const s of e.getRoot().listMeshes())for(const e of s.listPrimitives()){const s=e.getIndices();if(s){for(const n of e.listAttributes())e.swap(n,ie(n,s,t,r)),1===n.listParents().length&&n.dispose();for(const n of e.listTargets())for(const e of n.listAttributes())n.swap(e,ie(e,s,t,r)),1===e.listParents().length&&e.dispose();e.setIndices(null),1===s.listParents().length&&s.dispose()}}t.debug("unweld: Complete.")}))}function ie(e,t,r,s){if(s.has(e)&&s.get(e).has(t))return r.debug(`unweld: Cache hit for reused attribute, "${e.getName()}".`),s.get(e).get(t);const n=e.clone(),o=e.getArray().constructor;n.setArray(new o(t.getCount()*e.getElementSize()));const i=[];for(let r=0;r<t.getCount();r++)n.setElement(r,e.getElement(t.getScalar(r),i));return s.has(e)||s.set(e,new Map),s.get(e).set(t,n),n}const ae={overwrite:!1};function ue(e=ae){const t=v({},ae,e);return N("normals",(async e=>{const r=e.getLogger();let s=0;await e.transform(oe());for(const n of e.getRoot().listMeshes())for(const o of n.listPrimitives()){const n=o.getAttribute("POSITION");let i=o.getAttribute("NORMAL");if(t.overwrite&&i)i.dispose();else if(i){r.debug("normals: Skipping primitive: NORMAL found.");continue}i=e.createAccessor().setArray(new Float32Array(3*n.getCount())).setType("VEC3");const a=[0,0,0],u=[0,0,0],c=[0,0,0];for(let e=0;e<n.getCount();e+=3){n.getElement(e+0,a),n.getElement(e+1,u),n.getElement(e+2,c);const t=ce(a,u,c);i.setElement(e+0,t),i.setElement(e+1,t),i.setElement(e+2,t)}o.setAttribute("NORMAL",i),s++}s?r.debug("normals: Complete."):r.warn("normals: No qualifying primitives found. See debug output.")}))}function ce(e,t,r){const s=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],n=[r[0]-e[0],r[1]-e[1],r[2]-e[2]];return(0,m.Fv)([0,0,0],[s[1]*n[2]-s[2]*n[1],s[2]*n[0]-s[0]*n[2],s[0]*n[1]-s[1]*n[0]])}const le={propertyTypes:[s.PropertyType.NODE,s.PropertyType.SKIN,s.PropertyType.MESH,s.PropertyType.CAMERA,s.PropertyType.PRIMITIVE,s.PropertyType.PRIMITIVE_TARGET,s.PropertyType.ANIMATION,s.PropertyType.MATERIAL,s.PropertyType.TEXTURE,s.PropertyType.ACCESSOR,s.PropertyType.BUFFER]},he=function(e=le){const t=v({},le,e).propertyTypes;return N("prune",(e=>{const r=e.getLogger(),n=e.getRoot(),o=e.getGraph(),i={};if(t.includes(s.PropertyType.NODE)&&n.listNodes().forEach(a),t.includes(s.PropertyType.SKIN)&&n.listSkins().forEach(a),t.includes(s.PropertyType.MESH)&&n.listMeshes().forEach(a),t.includes(s.PropertyType.CAMERA)&&n.listCameras().forEach(a),t.includes(s.PropertyType.PRIMITIVE)&&u(o,s.PropertyType.PRIMITIVE),t.includes(s.PropertyType.PRIMITIVE_TARGET)&&u(o,s.PropertyType.PRIMITIVE_TARGET),t.includes(s.PropertyType.ANIMATION))for(const e of n.listAnimations()){for(const t of e.listChannels())t.getTargetNode()||(t.dispose(),c(t));if(e.listChannels().length)e.listSamplers().forEach(a);else{const t=e.listSamplers();a(e),t.forEach(a)}}if(t.includes(s.PropertyType.MATERIAL)&&n.listMaterials().forEach(a),t.includes(s.PropertyType.TEXTURE)&&n.listTextures().forEach(a),t.includes(s.PropertyType.ACCESSOR)&&n.listAccessors().forEach(a),t.includes(s.PropertyType.BUFFER)&&n.listBuffers().forEach(a),Object.keys(i).length){const e=Object.keys(i).map((e=>`${e} (${i[e]})`)).join(", ");r.info(`prune: Removed types... ${e}`)}else r.info("prune: No unused properties found.");function a(e){e.listParents().filter((e=>!(e instanceof s.Root||e instanceof s.AnimationChannel))).length||(e.dispose(),c(e))}function u(e,t){e.listEdges().map((e=>e.getParent())).filter((e=>e.propertyType===t)).forEach(a)}function c(e){i[e.propertyType]=i[e.propertyType]||0,i[e.propertyType]++}r.debug("prune: Complete.")}))},fe={animations:!0,meshes:!0},pe=(e=fe)=>{const t=v({},fe,e);return N("partition",(async e=>{const r=e.getLogger();!1!==t.meshes&&function(e,t,r){const s=new Set(e.getRoot().listBuffers().map((e=>e.getURI())));e.getRoot().listMeshes().forEach(((n,o)=>{if(Array.isArray(r.meshes)&&!r.meshes.includes(n.getName()))return void t.debug(`partition: Skipping mesh #${o} with name "${n.getName()}".`);t.debug(`partition: Creating buffer for mesh "${n.getName()}".`);const i=e.createBuffer(n.getName()).setURI(ge(n.getName()||"mesh",s));n.listPrimitives().forEach((e=>{const t=e.getIndices();t&&t.setBuffer(i),e.listAttributes().forEach((e=>e.setBuffer(i))),e.listTargets().forEach((e=>{e.listAttributes().forEach((e=>e.setBuffer(i)))}))}))}))}(e,r,t),!1!==t.animations&&function(e,t,r){const s=new Set(e.getRoot().listBuffers().map((e=>e.getURI())));e.getRoot().listAnimations().forEach(((n,o)=>{if(Array.isArray(r.animations)&&!r.animations.includes(n.getName()))return void t.debug(`partition: Skipping animation #${o} with name "${n.getName()}".`);t.debug(`partition: Creating buffer for animation "${n.getName()}".`);const i=e.createBuffer(n.getName()).setURI(ge(n.getName()||"animation",s));n.listSamplers().forEach((e=>{const t=e.getInput(),r=e.getOutput();t&&t.setBuffer(i),r&&r.setBuffer(i)}))}))}(e,r,t),t.meshes||t.animations||r.warn("partition: Select animations or meshes to create a partition."),await e.transform(he({propertyTypes:[s.PropertyType.BUFFER]})),r.debug("partition: Complete.")}))};function ge(e,t){let r=`${e}.bin`,s=1;for(;t.has(r);)r=`${e}_${s++}.bin`;return r}const de=[Int8Array,Int16Array,Int32Array],{TRANSLATION:me,ROTATION:ye,SCALE:Te,WEIGHTS:xe}=s.AnimationChannel.TargetPath,Ee=[me,ye,Te],Ae={pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12},be=(e=Ae)=>{const t=v({},Ae,e);return N("quantize",(async e=>{const r=e.getLogger(),n=e.getRoot();let o;e.createExtension(d.MeshQuantization).setRequired(!0),"scene"===t.quantizationVolume&&(o=_e(function(e){const t=e[0];for(const r of e)(0,m.VV)(t.min,t.min,r.min),(0,m.Fp)(t.max,t.max,r.max);return t}(n.listMeshes().map(Ne))));for(const r of e.getRoot().listMeshes()){"mesh"===t.quantizationVolume&&(o=_e(Ne(r))),o&&t.pattern.test("POSITION")&&we(e,r,o);for(const s of r.listPrimitives()){Re(e,s,o,t);for(const r of s.listTargets())Re(e,r,o,t)}}await e.transform(he({propertyTypes:[s.PropertyType.ACCESSOR,s.PropertyType.SKIN]}),D({propertyTypes:[s.PropertyType.ACCESSOR]})),r.debug("quantize: Complete.")}))};function Re(e,t,r,n){const o=e.getLogger();for(const e of t.listSemantics()){if(!n.pattern.test(e))continue;const i=t.getAttribute(e),{bits:a,ctor:u}=ve(e,i,o,n);if(!u)continue;if(a<8||a>16)throw new Error("quantize: Requires bits = 816.");if(i.getComponentSize()<=a/8)continue;const c=i.clone();if("POSITION"===e){const e=r.scale,n=[];t instanceof s.Primitive?(0,y.U_)(n,Ce(r)):(0,y.xJ)(n,[1/e,1/e,1/e]);for(let e=0,t=[0,0,0],r=c.getCount();e<r;e++)c.getElement(e,t),c.setElement(e,(0,m.fF)(t,t,n))}Se(c,u,a),t.swap(i,c)}if(t.getAttribute("WEIGHTS_0")&&function(e){const t=e.getAttribute("POSITION").getCount(),r=[];for(let s=0;s<t;s++){let t,n=0,o=1/0,i=-1,a=null,u=0;for(;t=e.getAttribute("WEIGHTS_"+u++);){t.getElement(s,r);for(let e=0;e<r.length;e++)n+=r[e],r[e]>0&&r[e]<o&&(a=t,o=r[e],i=e)}a&&1!==n&&(a.getElement(s,r),r[i]+=1-n,a.setElement(s,r))}}(t),t instanceof s.Primitive&&t.getIndices()&&t.listAttributes().length&&t.listAttributes()[0].getCount()<65535){const e=t.getIndices();e.setArray(new Uint16Array(e.getArray()))}}function _e(e){const{min:t,max:r}=e,s=Math.max((r[0]-t[0])/2,(r[1]-t[1])/2,(r[2]-t[2])/2);return{offset:[t[0]+(r[0]-t[0])/2,t[1]+(r[1]-t[1])/2,t[2]+(r[2]-t[2])/2],scale:s}}function we(e,t,r){const n=Ce(r);for(const o of t.listParents())if(o instanceof s.Node){const i=o.listParents().filter((e=>e instanceof s.AnimationChannel)),a=i.some((e=>Ee.includes(e.getTargetPath()))),u=o.listChildren().length>0;if(o.getSkin()){o.setSkin(Ie(o.getSkin(),r));continue}let c;u||a?(c=e.createNode("").setMesh(t),o.addChild(c).setMesh(null),i.filter((e=>e.getTargetPath()===xe)).forEach((e=>e.setTargetNode(c)))):c=o;const l=c.getMatrix();(0,y.Jp)(l,l,n),c.setMatrix(l)}}function Ie(e,t){e=e.clone();const r=Ce(t),s=e.getInverseBindMatrices().clone(),n=[];for(let e=0,t=s.getCount();e<t;e++)s.getElement(e,n),(0,y.Jp)(n,n,r),s.setElement(e,n);return e.setInverseBindMatrices(s)}function Se(e,t,r){const s=new t(e.getArray().length),n=de.includes(t)?1:0,o=r-n,i=8*t.BYTES_PER_ELEMENT-n,a=Math.pow(2,o)-1,u=i-o,c=2*o-i;for(let t=0,r=0,n=[];t<e.getCount();t++){e.getElement(t,n);for(let e=0;e<n.length;e++){let t=Math.round(Math.abs(n[e])*a);t=t<<u|t>>c,s[r++]=t*Math.sign(n[e])}}e.setArray(s).setNormalized(!0)}function ve(e,t,r,s){const n=t.getMinNormalized([]),o=t.getMaxNormalized([]);let i,a;if("POSITION"===e)i=s.quantizePosition,a=i<=8?Int8Array:Int16Array;else if("NORMAL"===e||"TANGENT"===e)i=s.quantizeNormal,a=i<=8?Int8Array:Int16Array;else if(e.startsWith("COLOR_"))i=s.quantizeColor,a=i<=8?Uint8Array:Uint16Array;else if(e.startsWith("TEXCOORD_")){if(n.some((e=>e<0))||o.some((e=>e>1)))return r.warn(`quantize: Skipping ${e}; out of [0,1] range.`),{bits:-1};i=s.quantizeTexcoord,a=i<=8?Uint8Array:Uint16Array}else{if(e.startsWith("JOINTS_"))return i=Math.max(...t.getMax([]))<=255?8:16,a=i<=8?Uint8Array:Uint16Array,t.getComponentSize()>i/8&&t.setArray(new a(t.getArray())),{bits:-1};if(e.startsWith("WEIGHTS_")){if(n.some((e=>e<0))||o.some((e=>e>1)))return r.warn(`quantize: Skipping ${e}; out of [0,1] range.`),{bits:-1};i=s.quantizeWeight,a=i<=8?Uint8Array:Uint16Array}else{if(!e.startsWith("_"))throw new Error(`quantize: Unexpected semantic, "${e}".`);if(n.some((e=>e<-1))||o.some((e=>e>1)))return r.warn(`quantize: Skipping ${e}; out of [-1,1] range.`),{bits:-1};i=s.quantizeGeneric,a=a=n.some((e=>e<0))?i<=8?Int8Array:Int16Array:i<=8?Uint8Array:Uint16Array}}return{bits:i,ctor:a}}function Ne(e){const t=[],r=[];for(const s of e.listPrimitives()){const e=s.getAttribute("POSITION");e&&t.push(e);for(const e of s.listTargets()){const t=e.getAttribute("POSITION");t&&r.push(t)}}if(0===t.length)throw new Error('quantize: Missing "POSITION" attribute.');const s=Me(t,3);if(r.length>0){const{min:e,max:t}=Me(r,3);(0,m.VV)(s.min,s.min,(0,m.VV)(e,(0,m.bA)(e,e,2),[0,0,0])),(0,m.Fp)(s.max,s.max,(0,m.Fp)(t,(0,m.bA)(t,t,2),[0,0,0]))}return s}function Me(e,t){const r=new Array(t).fill(1/0),s=new Array(t).fill(-1/0),n=[],o=[];for(const i of e){i.getMinNormalized(n),i.getMaxNormalized(o);for(let e=0;e<t;e++)r[e]=Math.min(r[e],n[e]),s[e]=Math.max(s[e],o[e])}return{min:r,max:s}}function Ce(e){return(0,y.Iw)([],[0,0,0,1],e.offset,[e.scale,e.scale,e.scale])}const Oe={tolerance:1e-4},Pe=(e=Oe)=>{const t=v({},Oe,e);return N("resample",((e,r)=>{const n=new Set,o=e.getRoot().listAccessors().length,i=e.getLogger();let a=!1;for(const r of e.getRoot().listAnimations()){const e=new Set;for(const t of r.listChannels())t.getSampler()&&"weights"===t.getTargetPath()&&e.add(t.getSampler());for(const s of r.listSamplers())e.has(s)?a=!0:"STEP"!==s.getInterpolation()&&"LINEAR"!==s.getInterpolation()||(n.add(s.getInput()),n.add(s.getOutput()),Ue(s,t))}for(const e of Array.from(n.values()))e.listParents().some((e=>!(e instanceof s.Root)))||e.dispose();e.getRoot().listAccessors().length>o&&!function(e,t,r){return!!e&&e.stack.lastIndexOf("resample")<e.stack.lastIndexOf("dedup")}(r)&&i.warn('resample: Resampling required copying accessors, some of which may be duplicates. Consider using "dedup" to consolidate any duplicates.'),a&&i.warn("resample: Skipped optimizing morph target keyframes, not yet supported."),i.debug("resample: Complete.")}))};function Ue(e,t){const r=e.getInput().clone(),s=e.getOutput().clone(),n=t.tolerance,o=r.getCount()-1,i=[];let a=1;for(let t=1;t<o;++t){const o=r.getScalar(t),c=r.getScalar(t-1),l=r.getScalar(t+1),h=(o-c)/(l-c);let f=!1;if(o!==l&&(1!==t||o!==r.getScalar(0)))for(let r=0;r<s.getElementSize();r++){const o=s.getElement(t,i)[r],a=s.getElement(t-1,i)[r],c=s.getElement(t+1,i)[r];if("LINEAR"===e.getInterpolation()){if(Math.abs(o-(a*(1-(u=h))+c*u))>n){f=!0;break}}else if("STEP"===e.getInterpolation()&&(o!==a||o!==c)){f=!0;break}}f&&(t!==a&&(r.setScalar(a,r.getScalar(t)),s.setElement(a,s.getElement(t,i))),a++)}var u;o>0&&(r.setScalar(a,r.getScalar(o)),s.setElement(a,s.getElement(o,i)),a++),a!==r.getCount()?(r.setArray(r.getArray().slice(0,a)),s.setArray(s.getArray().slice(0,a*s.getElementSize())),e.setInput(r),e.setOutput(s)):(r.dispose(),s.dispose())}const Fe={target:"size"};function Be(e=Fe){const t=v({},Fe,e),r=t.encoder;return N("reorder",(async e=>{const n=e.getLogger();await r.ready;const o=function(e){const t=new C,r=new Map,s=new C;for(const n of e.getRoot().listMeshes())for(const e of n.listPrimitives()){const n=e.getIndices();if(n){r.set(n,e.getMode());for(const r of Le(e))t.add(n,r),s.add(r,e)}}return{indicesToAttributes:t,indicesToMode:r,attributesToPrimitives:s}}(e);for(const e of o.indicesToAttributes.keys()){const n=e.clone();let i=n.getArray().slice();i instanceof Uint32Array||(i=new Uint32Array(i));const[a,u]=r.reorderMesh(i,o.indicesToMode.get(e)===s.Primitive.Mode.TRIANGLES,"size"===t.target);n.setArray(u<=65534?new Uint16Array(i):i);for(const t of o.indicesToAttributes.get(e)){const r=t.clone();De(r,a,u);for(const s of o.attributesToPrimitives.get(t))if(s.getIndices()===e&&s.swap(e,n),s.getIndices()===n){s.swap(t,r);for(const e of s.listTargets())e.swap(t,r)}}}await e.transform(he({propertyTypes:[s.PropertyType.ACCESSOR]})),o.indicesToAttributes.size?n.debug("reorder: Complete."):n.warn("reorder: No qualifying primitives found; may need to weld first.")}))}function De(e,t,r){const s=e.getElementSize(),n=e.getCount(),o=e.getArray(),i=o.slice(0,r*s);for(let e=0;e<n;e++)for(let r=0;r<s;r++)i[t[e]*s+r]=o[e*s+r];e.setArray(i)}function Le(e){const t=[];for(const r of e.listAttributes())t.push(r);for(const r of e.listTargets())for(const e of r.listAttributes())t.push(e);return Array.from(new Set(t))}const je={name:"",fps:10,pattern:/.*/,sort:!0};function Ve(e=je){const t=v({},je,e);return N("sequence",(e=>{const r=e.getLogger(),n=e.getRoot(),o=t.fps,i=n.listNodes().filter((e=>e.getName().match(t.pattern)));t.sort&&i.sort(((e,t)=>e.getName()>t.getName()?1:-1));const a=e.createAnimation(t.name),u=n.listBuffers()[0];i.forEach(((t,r)=>{let n,c;0===r?(n=[r/o,(r+1)/o],c=[1,1,1,0,0,0]):r===i.length-1?(n=[(r-1)/o,r/o],c=[0,0,0,1,1,1]):(n=[(r-1)/o,r/o,(r+1)/o],c=[0,0,0,1,1,1,0,0,0]);const l=e.createAccessor().setArray(new Float32Array(n)).setBuffer(u),h=e.createAccessor().setArray(new Float32Array(c)).setBuffer(u).setType(s.Accessor.Type.VEC3),f=e.createAnimationSampler().setInterpolation(s.AnimationSampler.Interpolation.STEP).setInput(l).setOutput(h),p=e.createAnimationChannel().setTargetNode(t).setTargetPath(s.AnimationChannel.TargetPath.SCALE).setSampler(f);a.addSampler(f).addChannel(p)})),r.debug("sequence: Complete.")}))}const ke={overwrite:!1};function Ge(e=ke){if(!e.generateTangents)throw new Error('tangents: generateTangents callback required  install "mikktspace".');const t=v({},ke,e);return N("tangents",(e=>{const r=e.getLogger(),n=new Map,o=new Map;let i=0;for(const a of e.getRoot().listMeshes()){const u=a.getName(),c=a.listPrimitives();for(let a=0;a<c.length;a++){const l=c[a];if(!He(l,r,u,a,t.overwrite))continue;const h=ze(l),f=l.getAttribute("POSITION").getArray(),p=l.getAttribute("NORMAL").getArray(),g=l.getAttribute(h).getArray(),d=n.get(f)||(0,s.uuid)();n.set(f,d);const m=n.get(p)||(0,s.uuid)();n.set(p,m);const y=n.get(g)||(0,s.uuid)();n.set(g,y);const T=l.getAttribute("TANGENT");T&&2===T.listParents().length&&T.dispose();const x=`${d}|${m}|${y}`;let E=o.get(x);if(E){r.debug(`tangents: Found cache for primitive ${a} of mesh "${u}".`),l.setAttribute("TANGENT",E),i++;continue}r.debug(`tangents: Generating for primitive ${a} of mesh "${u}".`);const A=l.getAttribute("POSITION").getBuffer(),b=t.generateTangents(f instanceof Float32Array?f:new Float32Array(f),p instanceof Float32Array?p:new Float32Array(p),g instanceof Float32Array?g:new Float32Array(g));for(let e=3;e<b.length;e+=4)b[e]*=-1;E=e.createAccessor().setBuffer(A).setArray(b).setType("VEC4"),l.setAttribute("TANGENT",E),o.set(x,E),i++}}i?r.debug("tangents: Complete."):r.warn("tangents: No qualifying primitives found. See debug output.")}))}function ze(e){const t=e.getMaterial();if(!t)return"TEXCOORD_0";const r=t.getNormalTextureInfo();if(!r)return"TEXCOORD_0";const s=`TEXCOORD_${r.getTexCoord()}`;return e.getAttribute(s)?s:"TEXCOORD_0"}function He(e,t,r,n,o){return e.getMode()===s.Primitive.Mode.TRIANGLES&&e.getAttribute("POSITION")&&e.getAttribute("NORMAL")&&e.getAttribute("TEXCOORD_0")?e.getAttribute("TANGENT")&&!o?(t.debug(`tangents: Skipping primitive ${n} of mesh "${r}": TANGENT found.`),!1):!e.getIndices()||(t.warn(`tangents: Skipping primitive ${n} of mesh "${r}": primitives must be unwelded.`),!1):(t.debug(`tangents: Skipping primitive ${n} of mesh "${r}": primitives must have attributes=[POSITION, NORMAL, TEXCOORD_0] and mode=TRIANGLES.`),!1)}const qe="textureResize";var $e;!function(e){e.LANCZOS3="lanczos3",e.LANCZOS2="lanczos2"}($e||($e={}));const Ye={size:[2048,2048],filter:$e.LANCZOS3,pattern:null};function Xe(e=Ye){const t=v({},Ye,e);return N(qe,(async e=>{const r=e.getLogger();for(const s of e.getRoot().listTextures()){const e=s.getName(),n=s.getURI();if(t.pattern&&!t.pattern.test(e)&&!t.pattern.test(n))continue;if("image/png"!==s.getMimeType()&&"image/jpeg"!==s.getMimeType()){r.warn(`Skipping unsupported texture type, "${s.getMimeType()}".`);continue}const[i,a]=t.size,[u,c]=s.getSize();if(u<=i&&c<=a){r.debug(`${qe}: Skipping "${n||e}", within size range.`);continue}let l=u,h=c;l>i&&(h=Math.floor(h*(i/l)),l=i),h>a&&(l=Math.floor(l*(a/h)),h=a);const f=s.getImage(),d=await p(f,s.getMimeType()),m=o()(new Uint8Array(l*h*4),[l,h,4]);r.debug(`${qe}: Resizing "${n||e}", ${d.shape}  ${m.shape}...`);try{t.filter===$e.LANCZOS3?I(d,m):S(d,m)}catch(t){if(t instanceof Error){r.warn(`${qe}: Failed to resize "${n||e}": "${t.message}".`);continue}throw t}s.setImage(await g(m,s.getMimeType()))}r.debug(`${qe}: Complete.`)}))}const Ke={tolerance:1e-4};function We(e=Ke){const t=v({},Ke,e);return N("weld",(e=>{const r=e.getLogger();for(const r of e.getRoot().listMeshes())for(const n of r.listPrimitives())n.getMode()!==s.Primitive.Mode.POINTS&&(0===t.tolerance?Je(e,n):Ze(e,n,t));r.debug("weld: Complete.")}))}function Je(e,t){if(t.getIndices())return;const r=t.listAttributes()[0],n=r.getCount(),o=r.getBuffer(),i=n<=65534?new Uint16Array(n):new Uint32Array(n),a=e.createAccessor().setBuffer(o).setType(s.Accessor.Type.SCALAR).setArray(i);for(let e=0;e<a.getCount();e++)a.setScalar(e,e);t.setIndices(a)}function Ze(e,t,r){const s=Math.max(r.tolerance,Number.EPSILON),n=Math.log10(1/s),o=Math.pow(10,n),i={},a=t.getIndices(),u=a?a.getCount():t.listAttributes()[0].getCount(),c=new Map;t.listAttributes().forEach((e=>c.set(e,[]))),t.listTargets().forEach((e=>{e.listAttributes().forEach((e=>c.set(e,[])))}));const l=[];let h=0;for(let e=0;e<u;e++){const r=a?a.getScalar(e):e,s=[],n=[];for(const e of t.listAttributes())for(let t=0;t<e.getElementSize();t++)s.push(~~(e.getElement(r,n)[t]*o));const u=s.join("|");if(u in i)l.push(i[u]);else{for(const e of t.listAttributes())c.get(e).push(e.getElement(r,[]));for(const e of t.listTargets())for(const t of e.listAttributes())c.get(t).push(t.getElement(r,[]));i[u]=h,l.push(h),h++}}const f=t.listAttributes()[0].getCount(),p=c.get(t.getAttribute("POSITION")).length;e.getLogger().debug(`weld: ${f}  ${p} vertices.`);for(const e of t.listAttributes())et(t,e,c.get(e)),1===e.listParents().length&&e.dispose();for(const e of t.listTargets())for(const t of e.listAttributes())et(e,t,c.get(t)),1===t.listParents().length&&t.dispose();if(a){const e=Qe(a.getArray(),l.length);e.set(l),t.setIndices(a.clone().setArray(e)),1===a.listParents().length&&a.dispose()}else{const r=f<=65534?new Uint16Array(l):new Uint32Array(l);t.setIndices(e.createAccessor().setArray(r))}}function Qe(e,t){return new(0,e.constructor)(t)}function et(e,t,r){const s=r.length*t.getElementSize(),n=Qe(t.getArray(),s),o=t.clone().setArray(n);for(let e=0;e<r.length;e++)o.setElement(e,r[e]);e.swap(t,o)}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),r=t[0],s=t[1];return 3*(r+s)/4-s},t.toByteArray=function(e){var t,r,o=u(e),i=o[0],a=o[1],c=new n(function(e,t,r){return 3*(t+r)/4-r}(0,i,a)),l=0,h=a>0?i-4:i;for(r=0;r<h;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,c[l++]=255&t);1===a&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,s=e.length,n=s%3,o=[],i=16383,a=0,u=s-n;a<u;a+=i)o.push(c(e,a,a+i>u?u:a+i));1===n?(t=e[s-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[s-2]<<8)+e[s-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],s=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=o.length;i<a;++i)r[i]=o[i],s[o.charCodeAt(i)]=i;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,s){for(var n,o,i=[],a=t;a<s;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(r[(o=n)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return i.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},8764:(e,t,r)=>{"use strict";var s=r(9742),n=r(645),o=r(5826);function i(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,r)}function c(e,t,r,s){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,s){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(s||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,r):new Uint8Array(t,r,s);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,r,s):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var s=0|g(t,r),n=(e=a(e,s)).write(t,r);n!==s&&(e=e.slice(0,n));return e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|p(t.length);return 0===(e=a(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(s=t.length)!=s?a(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var s;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t){var r=t.length<0?0:0|p(t.length);e=a(e,r);for(var s=0;s<r;s+=1)e[s]=255&t[s];return e}function p(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var s=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(s)return k(e).length;t=(""+t).toLowerCase(),s=!0}}function d(e,t,r){var s=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return v(this,t,r);case"latin1":case"binary":return N(this,t,r);case"base64":return w(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function m(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function y(e,t,r,s,n){if(0===e.length)return-1;if("string"==typeof r?(s=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=u.from(t,s)),u.isBuffer(t))return 0===t.length?-1:T(e,t,r,s,n);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):T(e,[t],r,s,n);throw new TypeError("val must be string, number or Buffer")}function T(e,t,r,s,n){var o,i=1,a=e.length,u=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return-1;i=2,a/=2,u/=2,r/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(n){var l=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(r+u>a&&(r=a-u),o=r;o>=0;o--){for(var h=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){h=!1;break}if(h)return o}return-1}function x(e,t,r,s){r=Number(r)||0;var n=e.length-r;s?(s=Number(s))>n&&(s=n):s=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");s>o/2&&(s=o/2);for(var i=0;i<s;++i){var a=parseInt(t.substr(2*i,2),16);if(isNaN(a))return i;e[r+i]=a}return i}function E(e,t,r,s){return z(k(t,e.length-r),e,r,s)}function A(e,t,r,s){return z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,s)}function b(e,t,r,s){return A(e,t,r,s)}function R(e,t,r,s){return z(G(t),e,r,s)}function _(e,t,r,s){return z(function(e,t){for(var r,s,n,o=[],i=0;i<e.length&&!((t-=2)<0);++i)s=(r=e.charCodeAt(i))>>8,n=r%256,o.push(n),o.push(s);return o}(t,e.length-r),e,r,s)}function w(e,t,r){return 0===t&&r===e.length?s.fromByteArray(e):s.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var s=[],n=t;n<r;){var o,i,a,u,c=e[n],l=null,h=c>239?4:c>223?3:c>191?2:1;if(n+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[n+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[n+1],i=e[n+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[n+1],i=e[n+2],a=e[n+3],128==(192&o)&&128==(192&i)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,s.push(l>>>10&1023|55296),l=56320|1023&l),s.push(l),n+=h}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var r="",s=0;for(;s<t;)r+=String.fromCharCode.apply(String,e.slice(s,s+=S));return r}(s)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==r.g.TYPED_ARRAY_SUPPORT?r.g.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=i(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,s){return l(t),t<=0?a(e,t):void 0!==r?"string"==typeof s?a(e,t).fill(r,s):a(e,t).fill(r):a(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,s=t.length,n=0,o=Math.min(r,s);n<o;++n)if(e[n]!==t[n]){r=e[n],s=t[n];break}return r<s?-1:s<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var s=u.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var i=e[r];if(!u.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(s,n),n+=i.length}return s},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):d.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,s,n){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===s&&(s=0),void 0===n&&(n=this.length),t<0||r>e.length||s<0||n>this.length)throw new RangeError("out of range index");if(s>=n&&t>=r)return 0;if(s>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(s>>>=0),i=(r>>>=0)-(t>>>=0),a=Math.min(o,i),c=this.slice(s,n),l=e.slice(t,r),h=0;h<a;++h)if(c[h]!==l[h]){o=c[h],i=l[h];break}return o<i?-1:i<o?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},u.prototype.write=function(e,t,r,s){if(void 0===t)s="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)s=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===s&&(s="utf8")):(s=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var o=!1;;)switch(s){case"hex":return x(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":return A(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return R(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function v(e,t,r){var s="";r=Math.min(e.length,r);for(var n=t;n<r;++n)s+=String.fromCharCode(127&e[n]);return s}function N(e,t,r){var s="";r=Math.min(e.length,r);for(var n=t;n<r;++n)s+=String.fromCharCode(e[n]);return s}function M(e,t,r){var s=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>s)&&(r=s);for(var n="",o=t;o<r;++o)n+=V(e[o]);return n}function C(e,t,r){for(var s=e.slice(t,r),n="",o=0;o<s.length;o+=2)n+=String.fromCharCode(s[o]+256*s[o+1]);return n}function O(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,r,s,n,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(r+s>e.length)throw new RangeError("Index out of range")}function U(e,t,r,s){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-r,2);n<o;++n)e[r+n]=(t&255<<8*(s?n:1-n))>>>8*(s?n:1-n)}function F(e,t,r,s){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-r,4);n<o;++n)e[r+n]=t>>>8*(s?n:3-n)&255}function B(e,t,r,s,n,o){if(r+s>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,s,o){return o||B(e,0,r,4),n.write(e,t,r,s,23,4),r+4}function L(e,t,r,s,o){return o||B(e,0,r,8),n.write(e,t,r,s,52,8),r+8}u.prototype.slice=function(e,t){var r,s=this.length;if((e=~~e)<0?(e+=s)<0&&(e=0):e>s&&(e=s),(t=void 0===t?s:~~t)<0?(t+=s)<0&&(t=0):t>s&&(t=s),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var n=t-e;r=new u(n,void 0);for(var o=0;o<n;++o)r[o]=this[o+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var s=this[e],n=1,o=0;++o<t&&(n*=256);)s+=this[e+o]*n;return s},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var s=this[e+--t],n=1;t>0&&(n*=256);)s+=this[e+--t]*n;return s},u.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var s=this[e],n=1,o=0;++o<t&&(n*=256);)s+=this[e+o]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||O(e,t,this.length);for(var s=t,n=1,o=this[e+--s];s>0&&(n*=256);)o+=this[e+--s]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),n.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),n.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),n.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),n.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,s){(e=+e,t|=0,r|=0,s)||P(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,o=0;for(this[t]=255&e;++o<r&&(n*=256);)this[t+o]=e/n&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,s){(e=+e,t|=0,r|=0,s)||P(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):F(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,s){if(e=+e,t|=0,!s){var n=Math.pow(2,8*r-1);P(this,e,t,r,n-1,-n)}var o=0,i=1,a=0;for(this[t]=255&e;++o<r&&(i*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/i>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,s){if(e=+e,t|=0,!s){var n=Math.pow(2,8*r-1);P(this,e,t,r,n-1,-n)}var o=r-1,i=1,a=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/i>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):F(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,s){if(r||(r=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<r&&(s=r),s===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-r&&(s=e.length-t+r);var n,o=s-r;if(this===e&&r<t&&t<s)for(n=o-1;n>=0;--n)e[n+t]=this[n+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},u.prototype.fill=function(e,t,r,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,r=this.length):"string"==typeof r&&(s=r,r=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("string"==typeof s&&!u.isEncoding(s))throw new TypeError("Unknown encoding: "+s)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var i=u.isBuffer(e)?e:k(new u(e,s).toString()),a=i.length;for(o=0;o<r-t;++o)this[o+t]=i[o%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function k(e,t){var r;t=t||1/0;for(var s=e.length,n=null,o=[],i=0;i<s;++i){if((r=e.charCodeAt(i))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===s){(t-=3)>-1&&o.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function G(e){return s.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,r,s){for(var n=0;n<s&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}},6239:(e,t,r)=>{"use strict";var s=r(5081);function n(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new n;t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var o=0;o<r.length;++o){var i=r[o];if("array"===i||"object"==typeof i&&i.blockIndices){if(t.argTypes[o]="array",t.arrayArgs.push(o),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+o),o<t.pre.args.length&&t.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array args");if(o<t.post.args.length&&t.post.args[o].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(o),t.shimArgs.push("scalar"+o);else if("index"===i){if(t.indexArgs.push(o),o<t.pre.args.length&&t.pre.args[o].count>0)throw new Error("cwise: pre() block may not reference array index");if(o<t.body.args.length&&t.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array index");if(o<t.post.args.length&&t.post.args[o].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(o),o<t.pre.args.length&&t.pre.args[o].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(o<t.body.args.length&&t.body.args[o].lvalue)throw new Error("cwise: body() block may not write to array shape");if(o<t.post.args.length&&t.post.args[o].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+r[o]);t.argTypes[o]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(o)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,s(t)}},1984:(e,t,r)=>{"use strict";var s=r(8706);function n(e,t,r){var s,n,o=e.length,i=t.arrayArgs.length,a=t.indexArgs.length>0,u=[],c=[],l=0,h=0;for(s=0;s<o;++s)c.push(["i",s,"=0"].join(""));for(n=0;n<i;++n)for(s=0;s<o;++s)h=l,l=e[s],0===s?c.push(["d",n,"s",s,"=t",n,"p",l].join("")):c.push(["d",n,"s",s,"=(t",n,"p",l,"-s",h,"*t",n,"p",h,")"].join(""));for(c.length>0&&u.push("var "+c.join(",")),s=o-1;s>=0;--s)l=e[s],u.push(["for(i",s,"=0;i",s,"<s",l,";++i",s,"){"].join(""));for(u.push(r),s=0;s<o;++s){for(h=l,l=e[s],n=0;n<i;++n)u.push(["p",n,"+=d",n,"s",s].join(""));a&&(s>0&&u.push(["index[",h,"]-=s",h].join("")),u.push(["++index[",l,"]"].join(""))),u.push("}")}return u.join("\n")}function o(e,t,r){for(var s=e.body,n=[],o=[],i=0;i<e.args.length;++i){var a=e.args[i];if(!(a.count<=0)){var u=new RegExp(a.name,"g"),c="",l=t.arrayArgs.indexOf(i);switch(t.argTypes[i]){case"offset":var h=t.offsetArgIndex.indexOf(i);l=t.offsetArgs[h].array,c="+q"+h;case"array":c="p"+l+c;var f="l"+i,p="a"+l;if(0===t.arrayBlockIndices[l])1===a.count?"generic"===r[l]?a.lvalue?(n.push(["var ",f,"=",p,".get(",c,")"].join("")),s=s.replace(u,f),o.push([p,".set(",c,",",f,")"].join(""))):s=s.replace(u,[p,".get(",c,")"].join("")):s=s.replace(u,[p,"[",c,"]"].join("")):"generic"===r[l]?(n.push(["var ",f,"=",p,".get(",c,")"].join("")),s=s.replace(u,f),a.lvalue&&o.push([p,".set(",c,",",f,")"].join(""))):(n.push(["var ",f,"=",p,"[",c,"]"].join("")),s=s.replace(u,f),a.lvalue&&o.push([p,"[",c,"]=",f].join("")));else{for(var g=[a.name],d=[c],m=0;m<Math.abs(t.arrayBlockIndices[l]);m++)g.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(m+1)+"*t"+l+"b"+m);if(u=new RegExp(g.join(""),"g"),c=d.join("+"),"generic"===r[l])throw new Error("cwise: Generic arrays not supported in combination with blocks!");s=s.replace(u,[p,"[",c,"]"].join(""))}break;case"scalar":s=s.replace(u,"Y"+t.scalarArgs.indexOf(i));break;case"index":s=s.replace(u,"index");break;case"shape":s=s.replace(u,"shape")}}}return[n.join("\n"),s,o.join("\n")].join("\n").trim()}function i(e){for(var t=new Array(e.length),r=!0,s=0;s<e.length;++s){var n=e[s],o=n.match(/\d+/);o=o?o[0]:"",0===n.charAt(0)?t[s]="u"+n.charAt(1)+o:t[s]=n.charAt(0)+o,s>0&&(r=r&&t[s]===t[s-1])}return r?t[0]:t.join("")}e.exports=function(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,a=new Array(e.arrayArgs.length),u=new Array(e.arrayArgs.length),c=0;c<e.arrayArgs.length;++c)u[c]=t[2*c],a[c]=t[2*c+1];var l=[],h=[],f=[],p=[],g=[];for(c=0;c<e.arrayArgs.length;++c){e.arrayBlockIndices[c]<0?(f.push(0),p.push(r),l.push(r),h.push(r+e.arrayBlockIndices[c])):(f.push(e.arrayBlockIndices[c]),p.push(e.arrayBlockIndices[c]+r),l.push(0),h.push(e.arrayBlockIndices[c]));for(var d=[],m=0;m<a[c].length;m++)f[c]<=a[c][m]&&a[c][m]<p[c]&&d.push(a[c][m]-f[c]);g.push(d)}var y=["SS"],T=["'use strict'"],x=[];for(m=0;m<r;++m)x.push(["s",m,"=SS[",m,"]"].join(""));for(c=0;c<e.arrayArgs.length;++c){y.push("a"+c),y.push("t"+c),y.push("p"+c);for(m=0;m<r;++m)x.push(["t",c,"p",m,"=t",c,"[",f[c]+m,"]"].join(""));for(m=0;m<Math.abs(e.arrayBlockIndices[c]);++m)x.push(["t",c,"b",m,"=t",c,"[",l[c]+m,"]"].join(""))}for(c=0;c<e.scalarArgs.length;++c)y.push("Y"+c);if(e.shapeArgs.length>0&&x.push("shape=SS.slice(0)"),e.indexArgs.length>0){var E=new Array(r);for(c=0;c<r;++c)E[c]="0";x.push(["index=[",E.join(","),"]"].join(""))}for(c=0;c<e.offsetArgs.length;++c){var A=e.offsetArgs[c],b=[];for(m=0;m<A.offset.length;++m)0!==A.offset[m]&&(1===A.offset[m]?b.push(["t",A.array,"p",m].join("")):b.push([A.offset[m],"*t",A.array,"p",m].join("")));0===b.length?x.push("q"+c+"=0"):x.push(["q",c,"=",b.join("+")].join(""))}var R=s([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((x=x.concat(R)).length>0&&T.push("var "+x.join(",")),c=0;c<e.arrayArgs.length;++c)T.push("p"+c+"|=0");e.pre.body.length>3&&T.push(o(e.pre,e,u));var _=o(e.body,e,u),w=function(e){for(var t=0,r=e[0].length;t<r;){for(var s=1;s<e.length;++s)if(e[s][t]!==e[0][t])return t;++t}return t}(g);w<r?T.push(function(e,t,r,s){for(var o=t.length,i=r.arrayArgs.length,a=r.blockSize,u=r.indexArgs.length>0,c=[],l=0;l<i;++l)c.push(["var offset",l,"=p",l].join(""));for(l=e;l<o;++l)c.push(["for(var j"+l+"=SS[",t[l],"]|0;j",l,">0;){"].join("")),c.push(["if(j",l,"<",a,"){"].join("")),c.push(["s",t[l],"=j",l].join("")),c.push(["j",l,"=0"].join("")),c.push(["}else{s",t[l],"=",a].join("")),c.push(["j",l,"-=",a,"}"].join("")),u&&c.push(["index[",t[l],"]=j",l].join(""));for(l=0;l<i;++l){for(var h=["offset"+l],f=e;f<o;++f)h.push(["j",f,"*t",l,"p",t[f]].join(""));c.push(["p",l,"=(",h.join("+"),")"].join(""))}for(c.push(n(t,r,s)),l=e;l<o;++l)c.push("}");return c.join("\n")}(w,g[0],e,_)):T.push(n(g[0],e,_)),e.post.body.length>3&&T.push(o(e.post,e,u)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+T.join("\n")+"\n----------");var I=[e.funcName||"unnamed","_cwise_loop_",a[0].join("s"),"m",w,i(u)].join("");return new Function(["function ",I,"(",y.join(","),"){",T.join("\n"),"} return ",I].join(""))()}},5081:(e,t,r)=>{"use strict";var s=r(1984);e.exports=function(e){var t=["'use strict'","var CACHED={}"],r=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var o=[],i=[],a=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],u=[],c=[],l=0;l<e.arrayArgs.length;++l){var h=e.arrayArgs[l];r.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),o.push("t"+h),o.push("r"+h),i.push("t"+h),i.push("r"+h+".join()"),a.push("array"+h+".data"),a.push("array"+h+".stride"),a.push("array"+h+".offset|0"),l>0&&(u.push("array"+e.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[l]))),c.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[l])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),l=0;l<e.scalarArgs.length;++l)a.push("scalar"+e.scalarArgs[l]);return r.push(["type=[",i.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",o.join(","),"])}","return proc(",a.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(s.bind(void 0,e))}},9685:(e,t,r)=>{"use strict";r.d(t,{WT:()=>s});var s="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},5975:(e,t,r)=>{"use strict";r.d(t,{U_:()=>n,GH:()=>o,Jp:()=>i,xJ:()=>a,j6:()=>u,Iw:()=>c});var s=r(9685);function n(e,t){var r=t[0],s=t[1],n=t[2],o=t[3],i=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],p=t[11],g=t[12],d=t[13],m=t[14],y=t[15],T=r*a-s*i,x=r*u-n*i,E=r*c-o*i,A=s*u-n*a,b=s*c-o*a,R=n*c-o*u,_=l*d-h*g,w=l*m-f*g,I=l*y-p*g,S=h*m-f*d,v=h*y-p*d,N=f*y-p*m,M=T*N-x*v+E*S+A*I-b*w+R*_;return M?(M=1/M,e[0]=(a*N-u*v+c*S)*M,e[1]=(n*v-s*N-o*S)*M,e[2]=(d*R-m*b+y*A)*M,e[3]=(f*b-h*R-p*A)*M,e[4]=(u*I-i*N-c*w)*M,e[5]=(r*N-n*I+o*w)*M,e[6]=(m*E-g*R-y*x)*M,e[7]=(l*R-f*E+p*x)*M,e[8]=(i*v-a*I+c*_)*M,e[9]=(s*I-r*v-o*_)*M,e[10]=(g*b-d*E+y*T)*M,e[11]=(h*E-l*b-p*T)*M,e[12]=(a*w-i*S-u*_)*M,e[13]=(r*S-s*w+n*_)*M,e[14]=(d*x-g*A-m*T)*M,e[15]=(l*A-h*x+f*T)*M,e):null}function o(e){var t=e[0],r=e[1],s=e[2],n=e[3],o=e[4],i=e[5],a=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],p=e[12],g=e[13],d=e[14],m=e[15];return(t*i-r*o)*(h*m-f*d)-(t*a-s*o)*(l*m-f*g)+(t*u-n*o)*(l*d-h*g)+(r*a-s*i)*(c*m-f*p)-(r*u-n*i)*(c*d-h*p)+(s*u-n*a)*(c*g-l*p)}function i(e,t,r){var s=t[0],n=t[1],o=t[2],i=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],p=t[10],g=t[11],d=t[12],m=t[13],y=t[14],T=t[15],x=r[0],E=r[1],A=r[2],b=r[3];return e[0]=x*s+E*a+A*h+b*d,e[1]=x*n+E*u+A*f+b*m,e[2]=x*o+E*c+A*p+b*y,e[3]=x*i+E*l+A*g+b*T,x=r[4],E=r[5],A=r[6],b=r[7],e[4]=x*s+E*a+A*h+b*d,e[5]=x*n+E*u+A*f+b*m,e[6]=x*o+E*c+A*p+b*y,e[7]=x*i+E*l+A*g+b*T,x=r[8],E=r[9],A=r[10],b=r[11],e[8]=x*s+E*a+A*h+b*d,e[9]=x*n+E*u+A*f+b*m,e[10]=x*o+E*c+A*p+b*y,e[11]=x*i+E*l+A*g+b*T,x=r[12],E=r[13],A=r[14],b=r[15],e[12]=x*s+E*a+A*h+b*d,e[13]=x*n+E*u+A*f+b*m,e[14]=x*o+E*c+A*p+b*y,e[15]=x*i+E*l+A*g+b*T,e}function a(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(e,t){var r=new s.WT(3);!function(e,t){var r=t[0],s=t[1],n=t[2],o=t[4],i=t[5],a=t[6],u=t[8],c=t[9],l=t[10];e[0]=Math.hypot(r,s,n),e[1]=Math.hypot(o,i,a),e[2]=Math.hypot(u,c,l)}(r,t);var n=1/r[0],o=1/r[1],i=1/r[2],a=t[0]*n,u=t[1]*o,c=t[2]*i,l=t[4]*n,h=t[5]*o,f=t[6]*i,p=t[8]*n,g=t[9]*o,d=t[10]*i,m=a+h+d,y=0;return m>0?(y=2*Math.sqrt(m+1),e[3]=.25*y,e[0]=(f-g)/y,e[1]=(p-c)/y,e[2]=(u-l)/y):a>h&&a>d?(y=2*Math.sqrt(1+a-h-d),e[3]=(f-g)/y,e[0]=.25*y,e[1]=(u+l)/y,e[2]=(p+c)/y):h>d?(y=2*Math.sqrt(1+h-a-d),e[3]=(p-c)/y,e[0]=(u+l)/y,e[1]=.25*y,e[2]=(f+g)/y):(y=2*Math.sqrt(1+d-a-h),e[3]=(u-l)/y,e[0]=(p+c)/y,e[1]=(f+g)/y,e[2]=.25*y),e}function c(e,t,r,s){var n=t[0],o=t[1],i=t[2],a=t[3],u=n+n,c=o+o,l=i+i,h=n*u,f=n*c,p=n*l,g=o*c,d=o*l,m=i*l,y=a*u,T=a*c,x=a*l,E=s[0],A=s[1],b=s[2];return e[0]=(1-(g+m))*E,e[1]=(f+x)*E,e[2]=(p-T)*E,e[3]=0,e[4]=(f-x)*A,e[5]=(1-(h+m))*A,e[6]=(d+y)*A,e[7]=0,e[8]=(p+T)*b,e[9]=(d-y)*b,e[10]=(1-(h+g))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}},7160:(e,t,r)=>{"use strict";r.d(t,{kE:()=>n,VV:()=>o,Fp:()=>i,bA:()=>a,Fv:()=>u,fF:()=>c});var s=r(9685);function n(e){var t=e[0],r=e[1],s=e[2];return Math.hypot(t,r,s)}function o(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function i(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function a(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function u(e,t){var r=t[0],s=t[1],n=t[2],o=r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function c(e,t,r){var s=t[0],n=t[1],o=t[2],i=r[3]*s+r[7]*n+r[11]*o+r[15];return i=i||1,e[0]=(r[0]*s+r[4]*n+r[8]*o+r[12])/i,e[1]=(r[1]*s+r[5]*n+r[9]*o+r[13])/i,e[2]=(r[2]*s+r[6]*n+r[10]*o+r[14])/i,e}var l,h;l=new s.WT(3),s.WT!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),h=l},645:(e,t)=>{t.read=function(e,t,r,s,n){var o,i,a=8*n-s-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?n-1:0,f=r?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=f,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=s;l>0;i=256*i+e[t+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(p?-1:1);i+=Math.pow(2,s),o-=c}return(p?-1:1)*i*Math.pow(2,o-s)},t.write=function(e,t,r,s,n,o){var i,a,u,c=8*o-n-1,l=(1<<c)-1,h=l>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=s?0:o-1,g=s?1:-1,d=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,i=l):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),(t+=i+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(i++,u/=2),i+h>=l?(a=0,i=l):i+h>=1?(a=(t*u-1)*Math.pow(2,n),i+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),i=0));n>=8;e[r+p]=255&a,p+=g,a/=256,n-=8);for(i=i<<n|a,c+=n;c>0;e[r+p]=255&i,p+=g,i/=256,c-=8);e[r+p-g]|=128*d}},6907:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}},8738:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},5826:e=>{var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},8897:(e,t,r)=>{"use strict";var s=r(6239),n={body:"",args:[],thisVars:[],localVars:[]};function o(e){if(!e)return n;for(var t=0;t<e.args.length;++t){var r=e.args[t];e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function i(e){for(var t=[],r=0;r<e.args.length;++r)t.push("a"+r);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return s({args:e.args,pre:o(e.pre),body:o(e.body),post:o(e.proc),funcName:e.funcName})}(e))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in a){var r=a[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:e+"seq"})}}();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in u){var r=u[e];t[e]=i({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:e}),t[e+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in c){var r=c[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<l.length;++e){var r=l[e];t[r]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),t[r+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var e=0;e<h.length;++e){var r=h[e];t[r]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),t[r+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),t[r+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),t[r+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var f=["atan2","pow"];!function(){for(var e=0;e<f.length;++e){var r=f[e];t[r+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),t[r+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),t[r+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),t[r+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),t.any=s({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=s({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=s({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=s({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=s({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=s({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=s({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=s({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=s({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=s({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=s({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=s({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=s({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},2861:(e,t,r)=>{var s=r(6907),n=r(8738),o="undefined"!=typeof Float64Array;function i(e,t){return e[0]-t[0]}function a(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(i);var s=new Array(r.length);for(e=0;e<s.length;++e)s[e]=r[e][1];return s}function u(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n="generic"===e;if(-1===t){var o="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(o)()}if(0===t){o="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",o)(c[e][0])}o=["'use strict'"];var i=s(t),u=i.map((function(e){return"i"+e})),l="this.offset+"+i.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),h=i.map((function(e){return"b"+e})).join(","),f=i.map((function(e){return"c"+e})).join(",");o.push("function "+r+"(a,"+h+","+f+",d){this.data=a","this.shape=["+h+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),o.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+i.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),t<4?(o.push("function "+r+"_order(){"),2===t?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+r+"_set("+u.join(",")+",v){"),n?o.push("return this.data.set("+l+",v)}"):o.push("return this.data["+l+"]=v}"),o.push("proto.get=function "+r+"_get("+u.join(",")+"){"),n?o.push("return this.data.get("+l+")}"):o.push("return this.data["+l+"]}"),o.push("proto.index=function "+r+"_index(",u.join(),"){return "+l+"}"),o.push("proto.hi=function "+r+"_hi("+u.join(",")+"){return new "+r+"(this.data,"+i.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+i.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var p=i.map((function(e){return"a"+e+"=this.shape["+e+"]"})),g=i.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+r+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+g.join(","));for(var d=0;d<t;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");o.push("return new "+r+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+r+"_step("+u.join(",")+"){var "+i.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+i.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<t;++d)o.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");o.push("return new "+r+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),y=new Array(t);for(d=0;d<t;++d)m[d]="a[i"+d+"]",y[d]="b[i"+d+"]";o.push("proto.transpose=function "+r+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+m.join(",")+","+y.join(",")+",this.offset)}"),o.push("proto.pick=function "+r+"_pick("+u+"){var a=[],b=[],c=this.offset");for(d=0;d<t;++d)o.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+i.map((function(e){return"shape["+e+"]"})).join(",")+","+i.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(c[e],a)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,r,s){if(void 0===e)return(0,c.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===r){r=new Array(i);for(var a=i-1,l=1;a>=0;--a)r[a]=l,l*=t[a]}if(void 0===s){s=0;for(a=0;a<i;++a)r[a]<0&&(s-=(t[a]-1)*r[a])}for(var h=function(e){if(n(e))return"buffer";if(o)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=c[h];f.length<=i+1;)f.push(u(h,f.length-1));return(0,f[i+1])(e,t,r,s)}},8706:e=>{"use strict";e.exports=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,s=e.length,n=e[0],o=e[0],i=1;i<s;++i)if(o=n,t(n=e[i],o)){if(i===r){r++;continue}e[r++]=n}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,s=e[0],n=e[0],o=1;o<r;++o,n=s)if(n=s,(s=e[o])!==n){if(o===t){t++;continue}e[t++]=s}return e.length=t,e}(e))}},87:()=>{},7263:()=>{}}]);