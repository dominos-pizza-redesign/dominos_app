/*! For license information please see 485.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[485,928],{9928:(e,t,s)=>{"use strict";s.r(t),s.d(t,{Accessor:()=>J,Animation:()=>$,AnimationChannel:()=>Z,AnimationSampler:()=>Q,Buffer:()=>ee,BufferUtils:()=>S,COPY_IDENTITY:()=>q,Camera:()=>te,ColorUtils:()=>_,DenoIO:()=>Ce,Document:()=>xe,ExtensibleProperty:()=>W,Extension:()=>Ee,ExtensionProperty:()=>se,FileUtils:()=>N,Format:()=>A,GLB_BUFFER:()=>T,Graph:()=>i,GraphEdge:()=>n,ImageUtils:()=>v,Logger:()=>D,Material:()=>ue,MathUtils:()=>F,Mesh:()=>ce,Node:()=>he,NodeIO:()=>ve,PlatformIO:()=>Me,Primitive:()=>le,PrimitiveTarget:()=>fe,Property:()=>K,PropertyType:()=>x,ReaderContext:()=>ye,Root:()=>Te,Scene:()=>ge,Skin:()=>de,Texture:()=>me,TextureChannel:()=>R,TextureInfo:()=>re,VERSION:()=>m,VertexLayout:()=>E,WebIO:()=>Oe,WriterContext:()=>be,bounds:()=>I,uuid:()=>Y});class r{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;return void 0===s[e]&&(s[e]=[]),-1===s[e].indexOf(t)&&s[e].push(t),this}removeEventListener(e,t){if(void 0===this._listeners)return this;const s=this._listeners[e];if(void 0!==s){const e=s.indexOf(t);-1!==e&&s.splice(e,1)}return this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){const s=t.slice(0);for(let t=0,r=s.length;t<r;t++)s[t].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class n extends r{constructor(e,t,s,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=s,this._attributes=r,!t.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class i extends r{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map((e=>e.getParent()))}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map((e=>e.getChild()))}disconnectParents(e,t){let s=this.listParentEdges(e);return t&&(s=s.filter((e=>t(e.getParent())))),s.forEach((e=>e.dispose())),this}createEdge(e,t,s,r){return this._registerEdge(new n(e,t,s,r))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",(()=>this._removeEdge(e))),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},o.apply(this,arguments)}function a(e){return e instanceof n}function u(e){return Array.isArray(e)&&e[0]instanceof n}function c(e){return!!(e&&"object"==typeof e&&Object.values(e)[0]instanceof n)}const h=Symbol("attributes"),l=Symbol("immutableKeys");class f extends r{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[h]=void 0,this[l]=void 0,this.graph=e,this[l]=new Set,this[h]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const s in e){const r=e[s];if(r instanceof f){const e=this.graph.createEdge(s,this,r);e.addEventListener("dispose",(()=>r.dispose())),this[l].add(s),t[s]=e}else t[s]=r}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((e=>e.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const s in this[h]){const r=this[h][s];if(a(r)){const n=r;n.getChild()===e&&this.setRef(s,t,n.getAttributes())}else if(u(r)){const n=r.find((t=>t.getChild()===e));if(n){const r=n.getAttributes();this.removeRef(s,e).addRef(s,t,r)}}else if(c(r)){const n=r;for(const r in n){const i=n[r];i.getChild()===e&&this.setRefMap(s,r,t,i.getAttributes())}}}return this}get(e){return this[h][e]}set(e,t){return this[h][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[h][e];return t?t.getChild():null}setRef(e,t,s){if(this[l].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[h][e];if(r&&r.dispose(),!t)return this;const n=this.graph.createEdge(e,this,t,s);return n.addEventListener("dispose",(()=>{delete this[h][e],this.dispatchEvent({type:"change",attribute:e})})),this[h][e]=n,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[h][e].map((e=>e.getChild()))}addRef(e,t,s){const r=this.graph.createEdge(e,this,t,s),n=this[h][e];return n.push(r),r.addEventListener("dispose",(()=>{const t=n.filter((e=>e!==r));n.length=0;for(const e of t)n.push(e);this.dispatchEvent({type:"change",attribute:e})})),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[h][e].filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}listRefMapKeys(e){return Object.keys(this[h][e])}listRefMapValues(e){return Object.values(this[h][e]).map((e=>e.getChild()))}getRefMap(e,t){const s=this[h][e];return s[t]?s[t].getChild():null}setRefMap(e,t,s,r){const n=this[h][e],i=n[t];if(i&&i.dispose(),!s)return this;r=Object.assign(r||{},{key:t});const a=this.graph.createEdge(e,this,s,o({},r,{key:t}));return a.addEventListener("dispose",(()=>{delete n[t],this.dispatchEvent({type:"change",attribute:e,key:t})})),n[t]=a,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(o({},e,{target:this})),this.graph.dispatchEvent(o({},e,{target:this,type:`node:${e.type}`})),this}}var p=s(7160),g=s(5975),d=s(8764).Buffer;const m="v2.0.5",T="@glb.bin";var x,E,y,R,A;function I(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},s=e.propertyType===x.NODE?[e]:e.listChildren();for(const e of s)e.traverse((e=>{const s=e.getMesh();if(!s)return;const r=w(s,e.getWorldMatrix());b(r.min,t),b(r.max,t)}));return t}function w(e,t){const s={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const r of e.listPrimitives()){const e=r.getAttribute("POSITION");if(!e)continue;let n=[0,0,0],i=[0,0,0];for(let r=0;r<e.getCount();r++)n=e.getElement(r,n),i=(0,p.fF)(i,n,t),b(i,s)}return s}function b(e,t){for(let s=0;s<3;s++)t.min[s]=Math.min(e[s],t.min[s]),t.max[s]=Math.max(e[s],t.max[s])}!function(e){e.ACCESSOR="Accessor",e.ANIMATION="Animation",e.ANIMATION_CHANNEL="AnimationChannel",e.ANIMATION_SAMPLER="AnimationSampler",e.BUFFER="Buffer",e.CAMERA="Camera",e.MATERIAL="Material",e.MESH="Mesh",e.PRIMITIVE="Primitive",e.PRIMITIVE_TARGET="PrimitiveTarget",e.NODE="Node",e.ROOT="Root",e.SCENE="Scene",e.SKIN="Skin",e.TEXTURE="Texture",e.TEXTURE_INFO="TextureInfo"}(x||(x={})),function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(E||(E={})),function(e){e.ARRAY_BUFFER="ARRAY_BUFFER",e.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",e.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",e.OTHER="OTHER"}(y||(y={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(R||(R={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(A||(A={}));class S{static createBufferFromDataURI(e){if(void 0===d){const t=atob(e.split(",")[1]),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return s}{const t=e.split(",")[1],s=e.indexOf("base64")>=0;return d.from(t,s?"base64":"utf8")}}static encodeText(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):d.from(e)}static decodeText(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):d.from(e).toString("utf8")}static concat(e){let t=0;for(const s of e)t+=s.byteLength;const s=new Uint8Array(t);let r=0;for(const t of e)s.set(t,r),r+=t.byteLength;return s}static pad(e,t=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const r=new Uint8Array(s);if(r.set(e),0!==t)for(let n=e.byteLength;n<s;n++)r[n]=t;return r}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==t[s])return!1;return!0}static toView(e,t=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class _{static hexToFactor(e,t){e=Math.floor(e);const s=t;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[s,r,n]=this.convertLinearToSRGB(e,t);return 255*s<<16^255*r<<8^255*n<<0}static convertSRGBToLinear(e,t){const s=e,r=t;for(let e=0;e<3;e++)r[e]=s[e]<.04045?.0773993808*s[e]:Math.pow(.9478672986*s[e]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const s=e,r=t;for(let e=0;e<3;e++)r[e]=s[e]<.0031308?12.92*s[e]:1.055*Math.pow(s[e],.41666)-.055;return t}}class N{static basename(e){const t=(e=new URL(e,"https://null.example").pathname).split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){return 0!==e.indexOf("data:")?(e=new URL(e,"https://null.example").pathname).split(/[\\/]/).pop().split(/[.]/).pop():0===e.indexOf("data:image/png")?"png":0===e.indexOf("data:image/jpeg")?"jpeg":"bin"}}class M{match(e){return e.length>=8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return S.decodeText(e.slice(12,16))===M.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}M.PNG_FRIED_CHUNK_NAME="CgBI";class v{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let s=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)s+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":`image/${e}`}}function C(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}function O(e){return"[object Object]"===Object.prototype.toString.call(e)}function U(e){if(!1===O(e))return!1;const t=e.constructor;if(void 0===t)return!0;const s=t.prototype;return!1!==O(s)&&!1!==Object.prototype.hasOwnProperty.call(s,"isPrototypeOf")}v.impls={"image/jpeg":new class{match(e){return e.length>=3&&255===e[0]&&216===e[1]&&255===e[2]}getSize(e){let t,s,r=new DataView(e.buffer,e.byteOffset+4);for(;r.byteLength;){if(t=r.getUint16(0,!1),C(r,t),s=r.getUint8(t+1),192===s||193===s||194===s)return[r.getUint16(t+7,!1),r.getUint16(t+5,!1)];r=new DataView(e.buffer,r.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new M};class D{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=D.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=D.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=D.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=D.Verbosity.ERROR&&console.error(e)}}D.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},D.DEFAULT_INSTANCE=new D(D.Verbosity.INFO);class F{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-t[s])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,s,r){let n=(0,p.kE)([e[0],e[1],e[2]]);const i=(0,p.kE)([e[4],e[5],e[6]]),o=(0,p.kE)([e[8],e[9],e[10]]);(0,g.GH)(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];const a=e.slice(),u=1/n,c=1/i,h=1/o;a[0]*=u,a[1]*=u,a[2]*=u,a[4]*=c,a[5]*=c,a[6]*=c,a[8]*=h,a[9]*=h,a[10]*=h,(0,g.j6)(s,a),r[0]=n,r[1]=i,r[2]=o}static compose(e,t,s,r){const n=r,i=t[0],o=t[1],a=t[2],u=t[3],c=i+i,h=o+o,l=a+a,f=i*c,p=i*h,g=i*l,d=o*h,m=o*l,T=a*l,x=u*c,E=u*h,y=u*l,R=s[0],A=s[1],I=s[2];return n[0]=(1-(d+T))*R,n[1]=(p+y)*R,n[2]=(g-E)*R,n[3]=0,n[4]=(p-y)*A,n[5]=(1-(f+T))*A,n[6]=(m+x)*A,n[7]=0,n[8]=(g+E)*I,n[9]=(m-x)*I,n[10]=(1-(f+d))*I,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}}function P(e,t){if(!!e!=!!t)return!1;const s=e.getChild(),r=t.getChild();return s===r||s.equals(r)}function B(e,t){if(!!e!=!!t)return!1;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const r=e[s],n=t[s];if(r.getChild()!==n.getChild()&&!r.getChild().equals(n.getChild()))return!1}return!0}function L(e,t){if(!!e!=!!t)return!1;const s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(const s in e){const r=e[s],n=t[s];if(!!r!=!!n)return!1;const i=r.getChild(),o=n.getChild();if(i!==o&&!i.equals(o))return!1}return!0}function j(e,t){if(e===t)return!0;if(!!e!=!!t||!e||!t)return!1;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}function V(e,t){if(e===t)return!0;if(!!e!=!!t)return!1;if(!U(e)||!U(t))return e===t;const s=e,r=t;let n,i=0,o=0;for(n in s)i++;for(n in r)o++;if(i!==o)return!1;for(n in s){const e=s[n],t=r[n];if(G(e)&&G(t)){if(!j(e,t))return!1}else if(U(e)&&U(t)){if(!V(e,t))return!1}else if(e!==t)return!1}return!0}function G(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const k="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",H=new Set,z=function(){let e="";for(let t=0;t<6;t++)e+=k.charAt(Math.floor(Math.random()*k.length));return e},Y=function(){for(let e=0;e<999;e++){const e=z();if(!H.has(e))return H.add(e),e}return""};class X{static dirname(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substring(0,t+1)}static resolve(e,t){if(!this.isRelativePath(t))return t;const s=e.split("/"),r=t.split("/");s.pop();for(let e=0;e<r.length;e++)"."!==r[e]&&(".."===r[e]?s.pop():s.push(r[e]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}X.DEFAULT_INIT={},X.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const q=e=>e;class K extends f{constructor(e,t=""){super(e),this[h].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new(0,this.constructor)(this.graph).copy(this,q)}copy(e,t=q){for(const e in this[h]){const t=this[h][e];if(t instanceof n)this[l].has(e)||t.dispose();else if(Array.isArray(t)&&t[0]instanceof n)for(const e of t)e.dispose();else if(U(t)&&Object.values(t)[0]instanceof n)for(const e in t)t[e].dispose()}for(const s in e[h]){const r=this[h][s],i=e[h][s];if(i instanceof n)this[l].has(s)?r.getChild().copy(t(i.getChild()),t):this.setRef(s,t(i.getChild()),i.getAttributes());else if(Array.isArray(i)&&i[0]instanceof n)for(const e of i)this.addRef(s,t(e.getChild()),e.getAttributes());else if(U(i)&&Object.values(i)[0]instanceof n)for(const e in i){const r=i[e];this.setRefMap(s,e,t(r.getChild()),r.getAttributes())}else this[h][s]=U(i)?JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.slice():i}return this}equals(e){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const t in this[h]){const s=this[h][t],r=e[h][t];if(a(s)||a(r)){if(!P(s,r))return!1}else if(u(s)||u(r)){if(!B(s,r))return!1}else if(c(s)||c(r)){if(!L(s,r))return!1}else if(U(s)||U(r)){if(!V(s,r))return!1}else if(G(s)||G(r)){if(!j(s,r))return!1}else if(s!==r)return!1}return!0}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.graph.listParents(this)}}class W extends K{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class J extends W{constructor(...e){super(...e),this.i=F.identity,this.o=F.identity}init(){this.propertyType=x.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:J.Type.SCALAR,componentType:J.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=q){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case J.Type.SCALAR:return 1;case J.Type.VEC2:return 2;case J.Type.VEC3:return 3;case J.Type.VEC4:case J.Type.MAT2:return 4;case J.Type.MAT3:return 9;case J.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case J.ComponentType.BYTE:case J.ComponentType.UNSIGNED_BYTE:return 1;case J.ComponentType.SHORT:case J.ComponentType.UNSIGNED_SHORT:return 2;case J.ComponentType.UNSIGNED_INT:case J.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let s=0;s<t;s++)e[s]=this.o(e[s]);return e}getMin(e){const t=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let t=0;t<r;t++)e[t]=1/0;for(let n=0;n<s*r;n+=r)for(let s=0;s<r;s++){const r=t[n+s];Number.isFinite(r)&&(e[s]=Math.min(e[s],r))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let s=0;s<t;s++)e[s]=this.o(e[s]);return e}getMax(e){const t=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let t=0;t<r;t++)e[t]=-1/0;for(let n=0;n<s*r;n+=r)for(let s=0;s<r;s++){const r=t[n+s];Number.isFinite(r)&&(e[s]=Math.max(e[s],r))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return J.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=e=>F.denormalize(e,this.get("componentType")),this.i=e=>F.normalize(e,this.get("componentType"))):(this.o=F.identity,this.i=F.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const s=this.getElementSize(),r=this.get("array");for(let n=0;n<s;n++)t[n]=this.o(r[e*s+n]);return t}setElement(e,t){const s=this.getElementSize(),r=this.get("array");for(let n=0;n<s;n++)r[e*s+n]=this.i(t[n]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(e){switch(e.constructor){case Float32Array:return J.ComponentType.FLOAT;case Uint32Array:return J.ComponentType.UNSIGNED_INT;case Uint16Array:return J.ComponentType.UNSIGNED_SHORT;case Uint8Array:return J.ComponentType.UNSIGNED_BYTE;case Int16Array:return J.ComponentType.SHORT;case Int8Array:return J.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):J.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}J.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},J.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class $ extends W{init(){this.propertyType=x.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Z extends W{init(){this.propertyType=x.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Z.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Q extends W{init(){this.propertyType=x.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Q.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:y.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:y.OTHER})}}Q.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class ee extends W{init(){this.propertyType=x.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class te extends W{init(){this.propertyType=x.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:te.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}te.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class se extends K{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}se.EXTENSION_NAME=void 0;class re extends W{init(){this.propertyType=x.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:re.WrapMode.REPEAT,wrapT:re.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}re.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},re.MagFilter={NEAREST:9728,LINEAR:9729},re.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:ne,G:ie,B:oe,A:ae}=R;class ue extends W{init(){this.propertyType=x.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:ue.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new re(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new re(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new re(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new re(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new re(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return _.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",_.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:ne|ie|oe|ae})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return _.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",_.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:ne|ie|oe})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:ne|ie|oe})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:ne})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:ie|oe})}}ue.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class ce extends W{init(){this.propertyType=x.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class he extends W{constructor(...e){super(...e),this.u=null}init(){this.propertyType=x.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=q){if(t===q)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return F.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return F.decompose(e,t,s,r),this.set("translation",t).set("rotation",s).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return F.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return F.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return F.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let t=this;t instanceof he;t=t.u)e.push(t);let t;const s=e.pop().getMatrix();for(;t=e.pop();)(0,g.Jp)(s,s,t.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[h].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class le extends W{init(){this.propertyType=x.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:le.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:y.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}le.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class fe extends K{init(){this.propertyType=x.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}class ge extends W{init(){this.propertyType=x.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=q){if(t===q)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[h].children;return t[t.length-1].addEventListener("dispose",(()=>e.u=null)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class de extends W{init(){this.propertyType=x.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:y.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class me extends W{init(){this.propertyType=x.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||v.extensionToMimeType(N.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",v.extensionToMimeType(N.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",S.assertView(e))}getSize(){const e=this.get("image");return e?v.getSize(e,this.getMimeType()):null}}class Te extends W{init(){this.propertyType=x.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.0.5",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",(e=>{this.l(e.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=q){if(t===q)throw new Error("Root cannot be copied.");this.set("asset",pe({},e.get("asset"))),this.setName(e.getName()),this.setExtras(pe({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const r=e.getExtension(s);this.setExtension(s,t(r))}return this}l(e){return e instanceof ge?this.addRef("scenes",e):e instanceof he?this.addRef("nodes",e):e instanceof te?this.addRef("cameras",e):e instanceof de?this.addRef("skins",e):e instanceof ce?this.addRef("meshes",e):e instanceof ue?this.addRef("materials",e):e instanceof me?this.addRef("textures",e):e instanceof $?this.addRef("animations",e):e instanceof J?this.addRef("accessors",e):e instanceof ee&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class xe{constructor(){this.m=new i,this.T=new Te(this.m),this.v=D.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return(new xe).setLogger(this.v).merge(this)}merge(e){for(const t of e.getRoot().listExtensionsUsed()){const e=this.createExtension(t.constructor);t.isRequired()&&e.setRequired(!0)}const t=new Set,s=new Map;t.add(e.T),s.set(e.T,this.T);for(const r of e.m.listEdges())for(const e of[r.getParent(),r.getChild()]){if(t.has(e))continue;let r;r=e.propertyType===x.TEXTURE_INFO?e:new(0,e.constructor)(this.m),s.set(e,r),t.add(e)}const r=e=>{const t=s.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const e of t){const t=s.get(e);if(!t)throw new Error("Could resolve property.");t.copy(e,r)}return this}async transform(...e){const t=e.map((e=>e.name));for(const s of e)await s(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){return new ge(this.m,e)}createNode(e=""){return new he(this.m,e)}createCamera(e=""){return new te(this.m,e)}createSkin(e=""){return new de(this.m,e)}createMesh(e=""){return new ce(this.m,e)}createPrimitive(){return new le(this.m)}createPrimitiveTarget(e=""){return new fe(this.m,e)}createMaterial(e=""){return new ue(this.m,e)}createTexture(e=""){return new me(this.m,e)}createAnimation(e=""){return new $(this.m,e)}createAnimationChannel(e=""){return new Z(this.m,e)}createAnimationSampler(e=""){return new Q(this.m,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new J(this.m,e).setBuffer(t)}createBuffer(e=""){return new ee(this.m,e)}}class Ee{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=e=>{const t=e,s=t.target;s instanceof se&&s.extensionName===this.extensionName&&("node:create"===t.type&&this.M(s),"node:dispose"===t.type&&this.I(s))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}Ee.EXTENSION_NAME=void 0;class ye{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord);const s=this.jsonDoc.json.textures[t.index];if(void 0===s.sampler)return;const r=this.jsonDoc.json.samplers[s.sampler];void 0!==r.magFilter&&e.setMagFilter(r.magFilter),void 0!==r.minFilter&&e.setMinFilter(r.minFilter),void 0!==r.wrapS&&e.setWrapS(r.wrapS),void 0!==r.wrapT&&e.setWrapT(r.wrapT)}}const Re={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ae={logger:D.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function Ie(e,t){const s=t.bufferViews[e.bufferView],r=t.jsonDoc.json.bufferViews[e.bufferView],n=Re[e.componentType],i=J.getElementSize(e.type),o=n.BYTES_PER_ELEMENT;if(void 0!==r.byteStride&&r.byteStride!==i*o)return function(e,t){const s=t.bufferViews[e.bufferView],r=t.jsonDoc.json.bufferViews[e.bufferView],n=Re[e.componentType],i=J.getElementSize(e.type),o=n.BYTES_PER_ELEMENT,a=e.byteOffset||0,u=new n(e.count*i),c=new DataView(s.buffer,s.byteOffset,s.byteLength),h=r.byteStride;for(let t=0;t<e.count;t++)for(let s=0;s<i;s++){const r=a+t*h+s*o;let n;switch(e.componentType){case J.ComponentType.FLOAT:n=c.getFloat32(r,!0);break;case J.ComponentType.UNSIGNED_INT:n=c.getUint32(r,!0);break;case J.ComponentType.UNSIGNED_SHORT:n=c.getUint16(r,!0);break;case J.ComponentType.UNSIGNED_BYTE:n=c.getUint8(r);break;case J.ComponentType.SHORT:n=c.getInt16(r,!0);break;case J.ComponentType.BYTE:n=c.getInt8(r);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}u[t*i+s]=n}return u}(e,t);const a=s.byteOffset+(e.byteOffset||0);return new n(s.buffer.slice(a,a+e.count*i*o))}var we;!function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(we||(we={}));class be{constructor(e,t,s){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=s;const r=e.getRoot(),n=r.listBuffers().length,i=r.listTextures().length;this.bufferURIGenerator=new Se(n>1,s.basename),this.imageURIGenerator=new Se(i>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const s={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const n={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},i=JSON.stringify(n);this.textureDefIndexMap.has(i)||(this.textureDefIndexMap.set(i,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(n));const o={index:this.textureDefIndexMap.get(i)};return 0!==t.getTexCoord()&&(o.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,o),o}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some((e=>"attributes"===e.getName()&&"POSITION"===e.getAttributes().key||"input"===e.getName()))&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,s){if(this.options.format===A.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=v.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const t of this.N.getGraph().listParentEdges(e)){const{usage:e}=t.getAttributes();if(e)return e;t.getParent().propertyType!==x.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${t.getName()}".`)}return be.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const s=this.O.get(e);if(s&&s!==t)throw new Error(`Accessor with usage "${s}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,s]of Array.from(this.O.entries()))e[s]=e[s]||[],e[s].push(t);return e}}be.BufferViewTarget=we,be.BufferViewUsage=y,be.USAGE_TO_TARGET={[y.ARRAY_BUFFER]:we.ARRAY_BUFFER,[y.ELEMENT_ARRAY_BUFFER]:we.ELEMENT_ARRAY_BUFFER};class Se{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}const{BufferViewUsage:_e}=be;var Ne;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Ne||(Ne={}));class Me{constructor(){this.v=D.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=E.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||"glb"===N.extension(e)?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(e,t=Ae){const s=pe({},Ae,t),{json:r}=e,n=new xe;this.validate(e,s);const i=new ye(e),o=r.asset,a=n.getRoot().getAsset();o.copyright&&(a.copyright=o.copyright),o.extras&&(a.extras=o.extras),void 0!==r.extras&&n.getRoot().setExtras(pe({},r.extras));const u=r.extensionsUsed||[],c=r.extensionsRequired||[];for(const e of s.extensions)if(u.includes(e.EXTENSION_NAME)){const t=n.createExtension(e).setRequired(c.includes(e.EXTENSION_NAME));for(const e of t.readDependencies)t.install(e,s.dependencies[e])}const h=r.buffers||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(x.BUFFER))).forEach((e=>e.preread(i,x.BUFFER))),i.buffers=h.map((e=>{const t=n.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),i.bufferViewBuffers=(r.bufferViews||[]).map(((t,s)=>{if(!i.bufferViews[s]){const r=e.json.buffers[t.buffer];i.bufferViews[s]=S.toView(r.uri?e.resources[r.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength)}return i.buffers[t.buffer]})),i.accessors=(r.accessors||[]).map((e=>{const t=n.createAccessor(e.name,i.bufferViewBuffers[e.bufferView]).setType(e.type);if(e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView&&!e.sparse)return t;let s;return s=void 0!==e.sparse?function(e,t){const s=Re[e.componentType],r=J.getElementSize(e.type);let n;n=void 0!==e.bufferView?Ie(e,t):new s(e.count*r);const i=e.sparse,o=i.count,a=pe({},e,i.indices,{count:o,type:"SCALAR"}),u=pe({},e,i.values,{count:o}),c=Ie(a,t),h=Ie(u,t);for(let e=0;e<a.count;e++)for(let t=0;t<r;t++)n[c[e]*r+t]=h[e*r+t];return n}(e,i):Ie(e,i),t.setArray(s),t}));const l=r.images||[],f=r.textures||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(x.TEXTURE))).forEach((e=>e.preread(i,x.TEXTURE))),i.textures=l.map((t=>{const s=n.createTexture(t.name);if(t.extras&&s.setExtras(t.extras),void 0!==t.bufferView){const n=r.bufferViews[t.bufferView],i=e.json.buffers[n.buffer],o=n.byteOffset||0,a=(i.uri?e.resources[i.uri]:e.resources["@glb.bin"]).slice(o,o+n.byteLength);s.setImage(a)}else void 0!==t.uri&&(s.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&s.setURI(t.uri));if(void 0!==t.mimeType)s.setMimeType(t.mimeType);else if(t.uri){const e=N.extension(t.uri);s.setMimeType(v.extensionToMimeType(e))}return s})),i.materials=(r.materials||[]).map((e=>{const t=n.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const s=e.pbrMetallicRoughness||{};if(void 0!==s.baseColorFactor&&t.setBaseColorFactor(s.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==s.metallicFactor&&t.setMetallicFactor(s.metallicFactor),void 0!==s.roughnessFactor&&t.setRoughnessFactor(s.roughnessFactor),void 0!==s.baseColorTexture){const e=s.baseColorTexture;t.setBaseColorTexture(i.textures[f[e.index].source]),i.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const s=e.emissiveTexture;t.setEmissiveTexture(i.textures[f[s.index].source]),i.setTextureInfo(t.getEmissiveTextureInfo(),s)}if(void 0!==e.normalTexture){const s=e.normalTexture;t.setNormalTexture(i.textures[f[s.index].source]),i.setTextureInfo(t.getNormalTextureInfo(),s),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const s=e.occlusionTexture;t.setOcclusionTexture(i.textures[f[s.index].source]),i.setTextureInfo(t.getOcclusionTextureInfo(),s),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==s.metallicRoughnessTexture){const e=s.metallicRoughnessTexture;t.setMetallicRoughnessTexture(i.textures[f[e.index].source]),i.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t}));const p=r.meshes||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(x.PRIMITIVE))).forEach((e=>e.preread(i,x.PRIMITIVE))),i.meshes=p.map((e=>{const t=n.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((s=>{const r=n.createPrimitive();s.extras&&r.setExtras(s.extras),void 0!==s.material&&r.setMaterial(i.materials[s.material]),void 0!==s.mode&&r.setMode(s.mode);for(const[e,t]of Object.entries(s.attributes||{}))r.setAttribute(e,i.accessors[t]);void 0!==s.indices&&r.setIndices(i.accessors[s.indices]);const o=e.extras&&e.extras.targetNames||[];(s.targets||[]).forEach(((e,t)=>{const s=o[t]||t.toString(),a=n.createPrimitiveTarget(s);for(const[t,s]of Object.entries(e))a.setAttribute(t,i.accessors[s]);r.addTarget(a)})),t.addPrimitive(r)})),t})),i.cameras=(r.cameras||[]).map((e=>{const t=n.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===te.Type.PERSPECTIVE){const s=e.perspective;t.setYFov(s.yfov),t.setZNear(s.znear),void 0!==s.zfar&&t.setZFar(s.zfar),void 0!==s.aspectRatio&&t.setAspectRatio(s.aspectRatio)}else{const s=e.orthographic;t.setZNear(s.znear).setZFar(s.zfar).setXMag(s.xmag).setYMag(s.ymag)}return t}));const g=r.nodes||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(x.NODE))).forEach((e=>e.preread(i,x.NODE))),i.nodes=g.map((e=>{const t=n.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const s=[0,0,0],r=[0,0,0,1],n=[1,1,1];F.decompose(e.matrix,s,r,n),t.setTranslation(s),t.setRotation(r),t.setScale(n)}return void 0!==e.weights&&t.setWeights(e.weights),t})),i.skins=(r.skins||[]).map((e=>{const t=n.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(i.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(i.nodes[e.skeleton]);for(const s of e.joints)t.addJoint(i.nodes[s]);return t})),g.map(((e,t)=>{const s=i.nodes[t];(e.children||[]).forEach((e=>s.addChild(i.nodes[e]))),void 0!==e.mesh&&s.setMesh(i.meshes[e.mesh]),void 0!==e.camera&&s.setCamera(i.cameras[e.camera]),void 0!==e.skin&&s.setSkin(i.skins[e.skin])})),i.animations=(r.animations||[]).map((e=>{const t=n.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const s=(e.samplers||[]).map((e=>{const s=n.createAnimationSampler().setInput(i.accessors[e.input]).setOutput(i.accessors[e.output]).setInterpolation(e.interpolation||Q.Interpolation.LINEAR);return e.extras&&s.setExtras(e.extras),t.addSampler(s),s}));return(e.channels||[]).forEach((e=>{const r=n.createAnimationChannel().setSampler(s[e.sampler]).setTargetNode(i.nodes[e.target.node]).setTargetPath(e.target.path);e.extras&&r.setExtras(e.extras),t.addChannel(r)})),t}));const d=r.scenes||[];return n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(x.SCENE))).forEach((e=>e.preread(i,x.SCENE))),i.scenes=d.map((e=>{const t=n.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>i.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==r.scene&&n.getRoot().setDefaultScene(i.scenes[r.scene]),n.getRoot().listExtensionsUsed().forEach((e=>e.read(i))),n}static validate(e,t){const s=e.json;if("2.0"!==s.asset.version)throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired)for(const e of s.extensionsRequired)if(!t.extensions.find((t=>t.EXTENSION_NAME===e)))throw new Error(`Missing required extension, "${e}".`);if(s.extensionsUsed)for(const e of s.extensionsUsed)t.extensions.find((t=>t.EXTENSION_NAME===e))||t.logger.warn(`Missing optional extension, "${e}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const t=this._(S.assertView(e));this.L(t);const s=t.json;if(s.buffers&&s.buffers.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)}(t,e))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some((e=>function(e,t){return void 0!==t.uri&&!(t.uri in e.resources)&&void 0===t.bufferView}(t,e))))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(S.assertView(e)))}async writeJSON(e,t={}){if(t.format===A.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return class{static write(e,t){const s=e.getRoot(),r={asset:pe({generator:"glTF-Transform v2.0.5"},s.getAsset()),extras:pe({},s.getExtras())},n={json:r,resources:{}},i=new be(e,n,t),o=t.logger||D.DEFAULT_INSTANCE,a=new Set(t.extensions.map((e=>e.EXTENSION_NAME))),u=e.getRoot().listExtensionsUsed().filter((e=>a.has(e.extensionName))),c=e.getRoot().listExtensionsRequired().filter((e=>a.has(e.extensionName)));u.length<e.getRoot().listExtensionsUsed().length&&o.debug("Some extensions were not registered for I/O, and will not be written.");for(const e of u)for(const s of e.writeDependencies)e.install(s,t.dependencies[s]);function h(e,t,s,n){const o=[];let a=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=r.bufferViews.length;const s=t.getArray(),n=S.pad(S.toView(s));e.byteOffset=a,a+=n.byteLength,o.push(n),i.accessorIndexMap.set(t,r.accessors.length),r.accessors.push(e)}const u={buffer:t,byteOffset:s,byteLength:S.concat(o).byteLength};return n&&(u.target=n),r.bufferViews.push(u),{buffers:o,byteLength:a}}function l(e,t,s){const n=e[0].getCount();let o=0;for(const t of e){const e=i.createAccessorDef(t);e.bufferView=r.bufferViews.length,e.byteOffset=o;const s=t.getElementSize(),n=t.getComponentSize();o+=S.padNumber(s*n),i.accessorIndexMap.set(t,r.accessors.length),r.accessors.push(e)}const a=n*o,u=new ArrayBuffer(a),c=new DataView(u);for(let t=0;t<n;t++){let s=0;for(const r of e){const e=r.getElementSize(),n=r.getComponentSize(),i=r.getComponentType(),a=r.getArray();for(let r=0;r<e;r++){const u=t*o+s+r*n,h=a[t*e+r];switch(i){case J.ComponentType.FLOAT:c.setFloat32(u,h,!0);break;case J.ComponentType.BYTE:c.setInt8(u,h);break;case J.ComponentType.SHORT:c.setInt16(u,h,!0);break;case J.ComponentType.UNSIGNED_BYTE:c.setUint8(u,h);break;case J.ComponentType.UNSIGNED_SHORT:c.setUint16(u,h,!0);break;case J.ComponentType.UNSIGNED_INT:c.setUint32(u,h,!0);break;default:throw new Error("Unexpected component type: "+i)}}s+=S.padNumber(e*n)}}return r.bufferViews.push({buffer:t,byteOffset:s,byteLength:a,byteStride:o,target:be.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(u)]}}const f=new Map;for(const t of e.getGraph().listEdges()){if(t.getParent()===s)continue;const e=t.getChild();if(e instanceof J){const s=f.get(e)||[];s.push(t),f.set(e,s)}}if(r.accessors=[],r.bufferViews=[],r.samplers=[],r.textures=[],r.images=s.listTextures().map(((e,t)=>{const s=i.createPropertyDef(e);e.getMimeType()&&(s.mimeType=e.getMimeType());const r=e.getImage();return r&&i.createImageData(s,r,e),i.imageIndexMap.set(e,t),s})),u.filter((e=>e.prewriteTypes.includes(x.ACCESSOR))).forEach((e=>e.prewrite(i,x.ACCESSOR))),s.listAccessors().forEach((e=>{const t=i.accessorUsageGroupedByParent,s=i.accessorParents;if(i.accessorIndexMap.has(e))return;const r=f.get(e)||[],n=i.getAccessorUsage(e);if(i.addAccessorToUsageGroup(e,n),t.has(n)){const t=r[0].getParent(),n=s.get(t)||new Set;n.add(e),s.set(t,n)}})),u.filter((e=>e.prewriteTypes.includes(x.BUFFER))).forEach((e=>e.prewrite(i,x.BUFFER))),(s.listAccessors().length>0||s.listTextures().length>0||i.otherBufferViews.size>0)&&0===s.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");r.buffers=[],s.listBuffers().forEach(((e,s)=>{const o=i.createPropertyDef(e),a=i.accessorUsageGroupedByParent,u=i.accessorParents,c=e.listParents().filter((e=>e instanceof J)),f=new Set(c),p=[],g=r.buffers.length;let d=0;const m=i.listAccessorUsageGroups();for(const e in m)if(a.has(e))for(const s of Array.from(u.values())){const r=Array.from(s).filter((e=>f.has(e))).filter((t=>i.getAccessorUsage(t)===e));if(r.length)if(e!==_e.ARRAY_BUFFER||t.vertexLayout===E.INTERLEAVED){const t=e===_e.ARRAY_BUFFER?l(r,g,d):h(r,g,d);d+=t.byteLength,p.push(...t.buffers)}else for(const e of r){const t=l([e],g,d);d+=t.byteLength,p.push(...t.buffers)}}else{const t=m[e].filter((e=>f.has(e)));if(!t.length)continue;const s=h(t,g,d,e===_e.ELEMENT_ARRAY_BUFFER?be.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);d+=s.byteLength,p.push(...s.buffers)}if(i.imageBufferViews.length&&0===s)for(let e=0;e<i.imageBufferViews.length;e++)if(r.bufferViews[r.images[e].bufferView].byteOffset=d,d+=i.imageBufferViews[e].byteLength,p.push(i.imageBufferViews[e]),d%8){const e=8-d%8;d+=e,p.push(new Uint8Array(e))}if(i.otherBufferViews.has(e))for(const t of i.otherBufferViews.get(e))r.bufferViews.push({buffer:g,byteOffset:d,byteLength:t.byteLength}),i.otherBufferViewsIndexMap.set(t,r.bufferViews.length-1),d+=t.byteLength,p.push(t);if(d){let s;t.format===A.GLB?s="@glb.bin":(s=i.bufferURIGenerator.createURI(e,"bin"),o.uri=s),o.byteLength=d,n.resources[s]=S.concat(p)}r.buffers.push(o),i.bufferIndexMap.set(e,s)})),s.listAccessors().find((e=>!e.getBuffer()))&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),r.materials=s.listMaterials().map(((e,t)=>{const s=i.createPropertyDef(e);if(e.getAlphaMode()!==ue.AlphaMode.OPAQUE&&(s.alphaMode=e.getAlphaMode()),e.getAlphaMode()===ue.AlphaMode.MASK&&(s.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(s.doubleSided=!0),s.pbrMetallicRoughness={},F.eq(e.getBaseColorFactor(),[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),F.eq(e.getEmissiveFactor(),[0,0,0])||(s.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(s.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(s.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),r=e.getBaseColorTextureInfo();s.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(t,r)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),r=e.getEmissiveTextureInfo();s.emissiveTexture=i.createTextureInfoDef(t,r)}if(e.getNormalTexture()){const t=e.getNormalTexture(),r=e.getNormalTextureInfo(),n=i.createTextureInfoDef(t,r);1!==e.getNormalScale()&&(n.scale=e.getNormalScale()),s.normalTexture=n}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),r=e.getOcclusionTextureInfo(),n=i.createTextureInfoDef(t,r);1!==e.getOcclusionStrength()&&(n.strength=e.getOcclusionStrength()),s.occlusionTexture=n}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),r=e.getMetallicRoughnessTextureInfo();s.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(t,r)}return i.materialIndexMap.set(e,t),s})),r.meshes=s.listMeshes().map(((e,t)=>{const s=i.createPropertyDef(e);let r=null;return s.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const s=e.getMaterial();s&&(t.material=i.materialIndexMap.get(s)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const n=e.getIndices();n&&(t.indices=i.accessorIndexMap.get(n));for(const s of e.listSemantics())t.attributes[s]=i.accessorIndexMap.get(e.getAttribute(s));for(const s of e.listTargets()){const e={};for(const t of s.listSemantics())e[t]=i.accessorIndexMap.get(s.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!r&&(r=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(s.weights=e.getWeights()),r&&(s.extras=s.extras||{},s.extras.targetNames=r),i.meshIndexMap.set(e,t),s})),r.cameras=s.listCameras().map(((e,t)=>{const s=i.createPropertyDef(e);if(s.type=e.getType(),s.type===te.Type.PERSPECTIVE){s.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(s.perspective.aspectRatio=t)}else s.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return i.cameraIndexMap.set(e,t),s})),r.nodes=s.listNodes().map(((e,t)=>{const s=i.createPropertyDef(e);return F.eq(e.getTranslation(),[0,0,0])||(s.translation=e.getTranslation()),F.eq(e.getRotation(),[0,0,0,1])||(s.rotation=e.getRotation()),F.eq(e.getScale(),[1,1,1])||(s.scale=e.getScale()),e.getWeights().length&&(s.weights=e.getWeights()),i.nodeIndexMap.set(e,t),s})),r.skins=s.listSkins().map(((e,t)=>{const s=i.createPropertyDef(e),r=e.getInverseBindMatrices();r&&(s.inverseBindMatrices=i.accessorIndexMap.get(r));const n=e.getSkeleton();return n&&(s.skeleton=i.nodeIndexMap.get(n)),s.joints=e.listJoints().map((e=>i.nodeIndexMap.get(e))),i.skinIndexMap.set(e,t),s})),s.listNodes().forEach(((e,t)=>{const s=r.nodes[t],n=e.getMesh();n&&(s.mesh=i.meshIndexMap.get(n));const o=e.getCamera();o&&(s.camera=i.cameraIndexMap.get(o));const a=e.getSkin();a&&(s.skin=i.skinIndexMap.get(a)),e.listChildren().length>0&&(s.children=e.listChildren().map((e=>i.nodeIndexMap.get(e))))})),r.animations=s.listAnimations().map(((e,t)=>{const s=i.createPropertyDef(e),r=new Map;return s.samplers=e.listSamplers().map(((e,t)=>{const s=i.createPropertyDef(e);return s.input=i.accessorIndexMap.get(e.getInput()),s.output=i.accessorIndexMap.get(e.getOutput()),s.interpolation=e.getInterpolation(),r.set(e,t),s})),s.channels=e.listChannels().map((e=>{const t=i.createPropertyDef(e);return t.sampler=r.get(e.getSampler()),t.target={node:i.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),i.animationIndexMap.set(e,t),s})),r.scenes=s.listScenes().map(((e,t)=>{const s=i.createPropertyDef(e);return s.nodes=e.listChildren().map((e=>i.nodeIndexMap.get(e))),i.sceneIndexMap.set(e,t),s}));const p=s.getDefaultScene();return p&&(r.scene=s.listScenes().indexOf(p)),r.extensionsUsed=u.map((e=>e.extensionName)),r.extensionsRequired=c.map((e=>e.extensionName)),u.forEach((e=>e.write(i))),function(e){const t=[];for(const s in e){const r=e[s];(Array.isArray(r)&&0===r.length||null===r||""===r||r&&"object"==typeof r&&0===Object.keys(r).length)&&t.push(s)}for(const s of t)delete e[s]}(r),n}}.write(e,{format:t.format||A.GLTF,basename:t.basename||"",logger:this.v,vertexLayout:this.F,dependencies:pe({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:s}=await this.writeJSON(e,{format:A.GLB}),r=new Uint32Array([1179937895,2,12]),n=JSON.stringify(t),i=S.pad(S.encodeText(n),32),o=S.toView(new Uint32Array([i.byteLength,1313821514])),a=S.concat([o,i]);r[r.length-1]+=a.byteLength;const u=Object.values(s)[0];if(!u||!u.byteLength)return S.concat([S.toView(r),a]);const c=S.pad(u,0),h=S.toView(new Uint32Array([c.byteLength,5130562])),l=S.concat([h,c]);return r[r.length-1]+=l.byteLength,S.concat([S.toView(r),a,l])}async P(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const s={json:JSON.parse(t),resources:{}};return await this.D(s,this.dirname(e)),this.L(s),s}async U(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const s=this._(t);return await this.D(s,this.dirname(e)),this.L(s),s}async D(e,t){var s=this;const r=[...e.json.images||[],...e.json.buffers||[]].map((async function(r){const n=r.uri;if(!n||n.match(/data:/))return Promise.resolve();e.resources[n]=await s.readURI(s.resolve(t,n),"view"),s.lastReadBytes+=e.resources[n].byteLength}));await Promise.all(r)}L(e){function t(t){if(t.uri)if(t.uri in e.resources)S.assertView(e.resources[t.uri]);else if(t.uri.match(/data:/)){const s=`__${Y()}.${N.extension(t.uri)}`;e.resources[s]=S.createBufferFromDataURI(t.uri),t.uri=s}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:s}=e.json;return e={json:pe({},e.json),resources:pe({},e.resources)},t&&(e.json.images=t.map((e=>pe({},e)))),s&&(e.json.buffers=s.map((e=>pe({},e)))),e}_(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const s=new Uint32Array(e.buffer,e.byteOffset+12,2);if(s[1]!==Ne.JSON)throw new Error("Missing required GLB JSON chunk.");const r=s[0],n=S.decodeText(S.toView(e,20,r)),i=JSON.parse(n),o=20+r;if(e.byteLength<=o)return{json:i,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+o,2);if(a[1]!==Ne.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:i,resources:{"@glb.bin":S.toView(e,o+8,a[0])}}}}class ve extends Me{constructor(e=null,t=X.DEFAULT_INIT){super(),this.k=void 0,this.J=void 0,this.$=void 0,this.V=void 0,this.q=!1,this.k=s(87).promises,this.J=s(7263),this.$=e,this.V=t}setAllowHTTP(e){if(e&&!this.$)throw new Error("NodeIO requires a Fetch API implementation for HTTP requests.");return this.q=e,this}async readURI(e,t){if(X.isAbsoluteURL(e)){if(!this.q||!this.$)throw new Error("Network request blocked. Allow HTTP requests explicitly, if needed.");const s=await this.$(e,this.V);switch(t){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}else switch(t){case"view":return this.k.readFile(e);case"text":return this.k.readFile(e,"utf8")}}resolve(e,t){return X.isAbsoluteURL(e)||X.isAbsoluteURL(t)?X.resolve(e,t):this.J.resolve(e,t)}dirname(e){return X.isAbsoluteURL(e)?X.dirname(e):this.J.dirname(e)}async write(e,t){const s=!!e.match(/\.glb$/);await(s?this.W(e,t):this.H(e,t))}async H(e,t){var s=this;this.lastWriteBytes=0;const{json:r,resources:n}=await this.writeJSON(t,{format:A.GLTF,basename:N.basename(e)}),{k:i,J:o}=this,a=o.dirname(e),u=JSON.stringify(r,null,2);this.lastWriteBytes+=u.length,await i.writeFile(e,u);const c=Object.keys(n).map((async function(e){if(X.isAbsoluteURL(e)){if("bin"===N.extension(e))throw new Error(`Cannot write buffer to path "${e}".`);return}const t=d.from(n[e]);await i.writeFile(o.join(a,e),t),s.lastWriteBytes+=t.byteLength}));await Promise.all(c)}async W(e,t){const s=d.from(await this.writeBinary(t));await this.k.writeFile(e,s),this.lastWriteBytes=s.byteLength}}class Ce extends Me{constructor(e){super(),this.J=void 0,this.J=e}async readURI(e,t){switch(t){case"view":return Deno.readFile(e);case"text":return Deno.readTextFile(e)}}resolve(e,t){return this.J.resolve(e,t)}dirname(e){return this.J.dirname(e)}}class Oe extends Me{constructor(e=X.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,t){const s=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,t){return X.resolve(e,t)}dirname(e){return X.dirname(e)}}},7485:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ALL_EXTENSIONS:()=>Tt,Clearcoat:()=>le,DracoMeshCompression:()=>re,EmissiveStrength:()=>ge,INSTANCE_ATTRIBUTE:()=>x,IOR:()=>Te,InstancedMesh:()=>E,KHRONOS_EXTENSIONS:()=>mt,Light:()=>ie,LightsPunctual:()=>ae,Mapping:()=>Ke,MappingList:()=>We,MaterialsClearcoat:()=>pe,MaterialsEmissiveStrength:()=>me,MaterialsIOR:()=>Ee,MaterialsPBRSpecularGlossiness:()=>Se,MaterialsSheen:()=>Ue,MaterialsSpecular:()=>Ve,MaterialsTransmission:()=>ze,MaterialsUnlit:()=>qe,MaterialsVariants:()=>Ze,MaterialsVolume:()=>st,MeshGPUInstancing:()=>R,MeshQuantization:()=>nt,MeshoptCompression:()=>B,PBRSpecularGlossiness:()=>we,Packet:()=>ft,Sheen:()=>Ce,Specular:()=>Le,TextureBasisu:()=>at,TextureTransform:()=>ht,TextureWebP:()=>V,Transform:()=>ut,Transmission:()=>ke,Unlit:()=>Ye,Variant:()=>Je,Volume:()=>et,XMP:()=>dt});var r=s(9928),n=s(8764).Buffer;new Uint8Array([0]);const i=[171,75,84,88,32,50,48,187,13,10,26,10];var o,a,u,c,h,l,f,p;!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(o||(o={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(a||(a={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(u||(u={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(c||(c={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(h||(h={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(l||(l={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(f||(f={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(p||(p={}));class g{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=o.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:a.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:u.UNSPECIFIED,colorPrimaries:c.SRGB,transferFunction:c.SRGB,flags:l.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class d{constructor(e,t,s,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const s=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,r)}}function m(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):n.from(e).toString("utf8")}function T(e){const t=new Uint8Array(e.buffer,e.byteOffset,i.length);if(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||t[4]!==i[4]||t[5]!==i[5]||t[6]!==i[6]||t[7]!==i[7]||t[8]!==i[8]||t[9]!==i[9]||t[10]!==i[10]||t[11]!==i[11])throw new Error("Missing KTX 2.0 identifier.");const s=new g,r=17*Uint32Array.BYTES_PER_ELEMENT,n=new d(e,i.length,r,!0);s.vkFormat=n._nextUint32(),s.typeSize=n._nextUint32(),s.pixelWidth=n._nextUint32(),s.pixelHeight=n._nextUint32(),s.pixelDepth=n._nextUint32(),s.layerCount=n._nextUint32(),s.faceCount=n._nextUint32();const o=n._nextUint32();s.supercompressionScheme=n._nextUint32();const a=n._nextUint32(),u=n._nextUint32(),c=n._nextUint32(),h=n._nextUint32(),l=n._nextUint64(),f=n._nextUint64(),p=new d(e,i.length+r,3*o*8,!0);for(let t=0;t<o;t++)s.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const T=new d(e,a,u,!0),x={vendorId:T._skip(4)._nextUint16(),descriptorType:T._nextUint16(),versionNumber:T._nextUint16(),descriptorBlockSize:T._nextUint16(),colorModel:T._nextUint8(),colorPrimaries:T._nextUint8(),transferFunction:T._nextUint8(),flags:T._nextUint8(),texelBlockDimension:{x:T._nextUint8()+1,y:T._nextUint8()+1,z:T._nextUint8()+1,w:T._nextUint8()+1},bytesPlane:[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],samples:[]},E=(x.descriptorBlockSize/4-6)/4;for(let e=0;e<E;e++)x.samples[e]={bitOffset:T._nextUint16(),bitLength:T._nextUint8(),channelID:T._nextUint8(),samplePosition:[T._nextUint8(),T._nextUint8(),T._nextUint8(),T._nextUint8()],sampleLower:T._nextUint32(),sampleUpper:T._nextUint32()};s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(x);const y=new d(e,c,h,!0);for(;y._offset<h;){const e=y._nextUint32(),t=y._scan(e),r=m(t),n=y._scan(e-t.byteLength);s.keyValue[r]=r.match(/^ktx/i)?m(n):n,y._offset%4&&y._skip(4-y._offset%4)}if(f<=0)return s;const R=new d(e,l,f,!0),A=R._nextUint16(),I=R._nextUint16(),w=R._nextUint32(),b=R._nextUint32(),S=R._nextUint32(),_=R._nextUint32(),N=[];for(let e=0;e<o;e++)N.push({imageFlags:R._nextUint32(),rgbSliceByteOffset:R._nextUint32(),rgbSliceByteLength:R._nextUint32(),alphaSliceByteOffset:R._nextUint32(),alphaSliceByteLength:R._nextUint32()});const M=l+R._offset,v=M+w,C=v+b,O=C+S,U=new Uint8Array(e.buffer,e.byteOffset+M,w),D=new Uint8Array(e.buffer,e.byteOffset+v,b),F=new Uint8Array(e.buffer,e.byteOffset+C,S),P=new Uint8Array(e.buffer,e.byteOffset+O,_);return s.globalData={endpointCount:A,selectorCount:I,imageDescs:N,endpointsData:U,selectorsData:D,tablesData:F,extendedData:P},s}const x="INSTANCE_ATTRIBUTE";class E extends r.ExtensionProperty{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[r.PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}E.EXTENSION_NAME="EXT_mesh_gpu_instancing";const y="EXT_mesh_gpu_instancing";class R extends r.Extension{constructor(...e){super(...e),this.extensionName=y,this.provideTypes=[r.PropertyType.NODE],this.prewriteTypes=[r.PropertyType.ACCESSOR]}createInstancedMesh(){return new E(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,s)=>{if(!t.extensions||!t.extensions[y])return;const r=t.extensions[y],n=this.createInstancedMesh();for(const t in r.attributes)n.setAttribute(t,e.accessors[r.attributes[t]]);e.nodes[s].setExtension(y,n)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const s of t.listAttributes())e.addAccessorToUsageGroup(s,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach((s=>{const r=s.getExtension(y);if(r){const n=e.nodeIndexMap.get(s),i=t.json.nodes[n],o={attributes:{}};r.listSemantics().forEach((t=>{const s=r.getAttribute(t);o.attributes[t]=e.accessorIndexMap.get(s)})),i.extensions=i.extensions||{},i.extensions[y]=o}})),this}}function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}var I,w,b;R.EXTENSION_NAME=y,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(I||(I={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(w||(w={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(b||(b={}));const{BYTE:S,SHORT:_,FLOAT:N}=r.Accessor.ComponentType,{normalize:M,denormalize:v}=r.MathUtils;function C(e,t,s,n){const{filter:i,bits:o}=n,a={array:e.getArray(),byteStride:e.getElementSize()*e.getComponentSize(),componentType:e.getComponentType(),normalized:e.getNormalized()};if(s!==w.ATTRIBUTES)return a;if(i!==b.NONE){let s=e.getNormalized()?function(e){const t=e.getComponentType(),s=e.getArray(),r=new Float32Array(s.length);for(let e=0;e<s.length;e++)r[e]=v(s[e],t);return r}(e):new Float32Array(a.array);switch(i){case b.EXPONENTIAL:a.byteStride=4*e.getElementSize(),a.componentType=N,a.normalized=!1,a.array=t.encodeFilterExp(s,e.getCount(),a.byteStride,o);break;case b.OCTAHEDRAL:a.byteStride=o>8?8:4,a.componentType=o>8?_:S,a.normalized=!0,s=3===e.getElementSize()?function(e){const t=new Float32Array(4*e.length/3);for(let s=0,r=e.length/3;s<r;s++)t[4*s]=e[3*s],t[4*s+1]=e[3*s+1],t[4*s+2]=e[3*s+2];return t}(s):s,a.array=t.encodeFilterOct(s,e.getCount(),a.byteStride,o);break;case b.QUATERNION:a.byteStride=8,a.componentType=_,a.normalized=!0,a.array=t.encodeFilterQuat(s,e.getCount(),a.byteStride,o);break;default:throw new Error("Invalid filter.")}a.min=e.getMin([]),a.max=e.getMax([]),e.getNormalized()&&(a.min=a.min.map((t=>v(t,e.getComponentType()))),a.max=a.max.map((t=>v(t,e.getComponentType())))),a.normalized&&(a.min=a.min.map((e=>M(e,a.componentType))),a.max=a.max.map((e=>M(e,a.componentType))))}else a.byteStride%4&&(a.array=function(e,t){const s=r.BufferUtils.padNumber(e.BYTES_PER_ELEMENT*t)/e.BYTES_PER_ELEMENT,n=new e.constructor(e.length/t*s);for(let r=0;r*t<e.length;r++)for(let i=0;i<t;i++)n[r*s+i]=e[r*t+i];return n}(a.array,e.getElementSize()),a.byteStride=a.array.byteLength/e.getCount());return a}function O(e,t){return t===r.WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER?e.listParents().some((e=>e instanceof r.Primitive&&e.getMode()===r.Primitive.Mode.TRIANGLES))?w.TRIANGLES:w.INDICES:w.ATTRIBUTES}function U(e,t){const s=t.getGraph().listParentEdges(e).filter((e=>!(e.getParent()instanceof r.Root)));for(const t of s){const s=t.getName(),r=t.getAttributes().key||"";if("indices"===s)return{filter:b.NONE};if("attributes"===s){if("POSITION"===r)return{filter:b.NONE};if("TEXCOORD_0"===r)return{filter:b.NONE};if("NORMAL"===r)return{filter:b.OCTAHEDRAL,bits:8};if("TANGENT"===r)return{filter:b.OCTAHEDRAL,bits:8};if(r.startsWith("JOINTS_"))return{filter:b.NONE};if(r.startsWith("WEIGHTS_"))return{filter:b.NONE}}if("output"===s){const t=D(e);return"rotation"===t?{filter:b.QUATERNION,bits:16}:"translation"===t||"scale"===t?{filter:b.EXPONENTIAL,bits:12}:{filter:b.NONE}}if("input"===s)return{filter:b.NONE};if("inverseBindMatrices"===s)return{filter:b.NONE}}return{filter:b.NONE}}function D(e){for(const t of e.listParents())if(t instanceof r.AnimationSampler)for(const e of t.listParents())if(e instanceof r.AnimationChannel)return e.getTargetPath();return null}const F="EXT_meshopt_compression",P={method:I.QUANTIZE};class B extends r.Extension{constructor(...e){super(...e),this.extensionName=F,this.prereadTypes=[r.PropertyType.BUFFER,r.PropertyType.PRIMITIVE],this.prewriteTypes=[r.PropertyType.BUFFER,r.PropertyType.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=P,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=A({},P,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${F}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${F}]: Missing WASM support.`)}return t===r.PropertyType.BUFFER?this._prereadBuffers(e):t===r.PropertyType.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((s,n)=>{if(!s.extensions||!s.extensions[F])return;const i=s.extensions[F],o=i.byteOffset||0,a=i.byteLength||0,u=i.count,c=i.byteStride,h=new Uint8Array(u*c),l=t.json.buffers[s.buffer],f=r.BufferUtils.toView(l.uri?t.resources[l.uri]:t.resources[r.GLB_BUFFER],o,a);this._decoder.decodeGltfBuffer(h,u,c,f,i.mode,i.filter),e.bufferViews[n]=h}))}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((s=>{var r;s.extensions&&s.extensions[F]&&(r=t.json.buffers[s.buffer]).extensions&&r.extensions.EXT_meshopt_compression&&r.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[F].buffer])}))}read(e){if(!this.isRequired())return this;for(const[e,t]of this._decoderFallbackBufferMap){for(const s of e.listParents())s instanceof r.Accessor&&s.swap(e,t);e.dispose()}return this}prewrite(e,t){return t===r.PropertyType.ACCESSOR?this._prewriteAccessors(e):t===r.PropertyType.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,s=this._encoder,n=this._encoderOptions,i=this.document.createBuffer(),o=this.document.getRoot().listBuffers().indexOf(i);this._encoderFallbackBuffer=i,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const i of this.document.getRoot().listAccessors()){if("weights"===D(i))continue;const a=e.getAccessorUsage(i),u=O(i,a),c=n.method===I.FILTER?U(i,this.document):{filter:b.NONE},h=C(i,s,u,c),{array:l,byteStride:f}=h,p=i.getBuffer();if(!p)throw new Error(`${F}: Missing buffer for accessor.`);const g=this.document.getRoot().listBuffers().indexOf(p),d=[a,u,c.filter,f,g].join(":");let m=this._encoderBufferViews[d],T=this._encoderBufferViewData[d],x=this._encoderBufferViewAccessors[d];m&&T||(x=this._encoderBufferViewAccessors[d]=[],T=this._encoderBufferViewData[d]=[],m=this._encoderBufferViews[d]={buffer:o,target:r.WriterContext.USAGE_TO_TARGET[a],byteOffset:0,byteLength:0,byteStride:a===r.WriterContext.BufferViewUsage.ARRAY_BUFFER?f:void 0,extensions:{[F]:{buffer:g,byteOffset:0,byteLength:0,mode:u,filter:c.filter!==b.NONE?c.filter:void 0,byteStride:f,count:0}}});const E=e.createAccessorDef(i);E.componentType=h.componentType,E.normalized=h.normalized,E.byteOffset=m.byteLength,E.min&&h.min&&(E.min=h.min),E.max&&h.max&&(E.max=h.max),e.accessorIndexMap.set(i,t.accessors.length),t.accessors.push(E),x.push(E),T.push(new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),m.byteLength+=l.byteLength,m.extensions.EXT_meshopt_compression.count+=i.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const s in this._encoderBufferViews){const n=this._encoderBufferViews[s],i=this._encoderBufferViewData[s],o=this.document.getRoot().listBuffers()[n.extensions[F].buffer],a=e.otherBufferViews.get(o)||[],{count:u,byteStride:c,mode:h}=n.extensions[F],l=r.BufferUtils.concat(i),f=t.encodeGltfBuffer(l,u,c,h),p=r.BufferUtils.pad(f);n.extensions[F].byteLength=f.byteLength,i.length=0,i.push(p),a.push(p),e.otherBufferViews.set(o,a)}}write(e){let t=0;for(const s in this._encoderBufferViews){const n=this._encoderBufferViews[s],i=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[s][0]),o=this._encoderBufferViewAccessors[s];for(const e of o)e.bufferView=i;const a=e.jsonDoc.json.bufferViews[i],u=a.byteOffset||0;Object.assign(a,n),a.byteOffset=t,a.extensions[F].byteOffset=u,t+=r.BufferUtils.padNumber(n.byteLength)}const s=this._encoderFallbackBuffer,n=e.bufferIndexMap.get(s),i=e.jsonDoc.json.buffers[n];return i.byteLength=t,i.extensions={[F]:{fallback:!0}},s.dispose(),this}}B.EXTENSION_NAME=F,B.EncoderMethod=I;const L="EXT_texture_webp";class j{match(e){return e.length>=12&&87===e[8]&&69===e[9]&&66===e[10]&&80===e[11]}getSize(e){const t=r.BufferUtils.decodeText(e.slice(0,4)),s=r.BufferUtils.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==s)return null;const n=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<n.byteLength;){const e=r.BufferUtils.decodeText(new Uint8Array([n.getUint8(i),n.getUint8(i+1),n.getUint8(i+2),n.getUint8(i+3)])),t=n.getUint32(i+4,!0);if("VP8 "===e)return[16383&n.getInt16(i+14,!0),16383&n.getInt16(i+16,!0)];if("VP8L"===e){const e=n.getUint8(i+9),t=n.getUint8(i+10),s=n.getUint8(i+11);return[1+((63&t)<<8|e),1+((15&n.getUint8(i+12))<<10|s<<2|(192&t)>>6)]}i+=8+t+t%2}return null}getChannels(e){return 4}}class V extends r.Extension{constructor(...e){super(...e),this.extensionName=L,this.prereadTypes=[r.PropertyType.TEXTURE]}static register(){r.ImageUtils.registerFormat("image/webp",new j)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[L]&&(e.source=e.extensions[L].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((s=>{if("image/webp"===s.getMimeType()){const r=e.imageIndexMap.get(s);(t.json.textures||[]).forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[L]={source:e.source},delete e.source)}))}})),this}}V.EXTENSION_NAME=L;const G="KHR_draco_mesh_compression";let k,H,z,Y;function X(e,t){const s=new k.DecoderBuffer;try{if(s.Init(t,t.length),e.GetEncodedGeometryType(s)!==k.TRIANGULAR_MESH)throw new Error(`[${G}] Unknown geometry type.`);const r=new k.Mesh;if(!e.DecodeBufferToMesh(s,r).ok()||0===r.ptr)throw new Error(`[${G}] Decoding failure.`);return r}finally{k.destroy(s)}}function q(e,t){const s=3*t.num_faces();let r,n;if(t.num_points()<=65534){const i=s*Uint16Array.BYTES_PER_ELEMENT;r=k._malloc(i),e.GetTrianglesUInt16Array(t,i,r),n=new Uint16Array(k.HEAPU16.buffer,r,s).slice()}else{const i=s*Uint32Array.BYTES_PER_ELEMENT;r=k._malloc(i),e.GetTrianglesUInt32Array(t,i,r),n=new Uint32Array(k.HEAPU32.buffer,r,s).slice()}return k._free(r),n}function K(e,t,s,r){const n=z[r.componentType],i=H[r.componentType],o=s.num_components(),a=t.num_points()*o,u=a*i.BYTES_PER_ELEMENT,c=k._malloc(u);e.GetAttributeDataArrayForAllPoints(t,s,n,u,c);const h=new i(k.HEAPF32.buffer,c,a).slice();return k._free(c),h}var W,J;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(W||(W={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(J||(J={}));const $={[J.POSITION]:14,[J.NORMAL]:10,[J.COLOR]:8,[J.TEX_COORD]:12,[J.GENERIC]:12},Z={decodeSpeed:5,encodeSpeed:5,method:W.EDGEBREAKER,quantizationBits:$,quantizationVolume:"mesh"};function Q(e,t=Z){const s=A({},Z,t);s.quantizationBits=A({},$,t.quantizationBits);const r=new Y.Encoder,n=new Y.MeshBuilder,i=new Y.Mesh,o={},a=new Y.DracoInt8Array;for(const t of e.listSemantics()){const a=e.getAttribute(t),u=ee(t),c=te(n,a.getComponentType(),i,Y[u],a.getCount(),a.getElementSize(),a.getArray());if(-1===c)throw new Error(`Error compressing "${t}" attribute.`);if(o[t]=c,"mesh"===s.quantizationVolume||"POSITION"!==t)r.SetAttributeQuantization(Y[u],s.quantizationBits[u]);else{if("object"!=typeof s.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=s,t=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);r.SetAttributeExplicitQuantization(Y[u],s.quantizationBits[u],a.getElementSize(),e.min,t)}}}const u=e.getIndices();if(!u)throw new Error("Primitive must have indices.");n.AddFacesToMesh(i,u.getCount()/3,u.getArray()),r.SetSpeedOptions(s.encodeSpeed,s.decodeSpeed),r.SetTrackEncodedProperties(!0),s.method===W.SEQUENTIAL||e.listTargets().length>0?r.SetEncodingMethod(Y.MESH_SEQUENTIAL_ENCODING):r.SetEncodingMethod(Y.MESH_EDGEBREAKER_ENCODING);const c=r.EncodeMeshToDracoBuffer(i,a);if(c<=0)throw new Error("Error applying Draco compression.");const h=new Uint8Array(c);for(let e=0;e<c;++e)h[e]=a.GetValue(e);const l=e.getAttribute("POSITION").getCount(),f=r.GetNumberOfEncodedPoints(),p=3*r.GetNumberOfEncodedFaces();if(e.listTargets().length>0&&f!==l)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return Y.destroy(a),Y.destroy(i),Y.destroy(n),Y.destroy(r),{numVertices:f,numIndices:p,data:h,attributeIDs:o}}function ee(e){return"POSITION"===e?J.POSITION:"NORMAL"===e?J.NORMAL:e.startsWith("COLOR_")?J.COLOR:e.startsWith("TEXCOORD_")?J.TEX_COORD:J.GENERIC}function te(e,t,s,n,i,o,a){switch(t){case r.Accessor.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(s,n,i,o,a);case r.Accessor.ComponentType.BYTE:return e.AddInt8Attribute(s,n,i,o,a);case r.Accessor.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(s,n,i,o,a);case r.Accessor.ComponentType.SHORT:return e.AddInt16Attribute(s,n,i,o,a);case r.Accessor.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(s,n,i,o,a);case r.Accessor.ComponentType.FLOAT:return e.AddFloatAttribute(s,n,i,o,a);default:throw new Error(`Unexpected component type, "${t}".`)}}const se="KHR_draco_mesh_compression";class re extends r.Extension{constructor(...e){super(...e),this.extensionName=se,this.prereadTypes=[r.PropertyType.PRIMITIVE],this.prewriteTypes=[r.PropertyType.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,k=this._decoderModule,H={[r.Accessor.ComponentType.FLOAT]:Float32Array,[r.Accessor.ComponentType.UNSIGNED_INT]:Uint32Array,[r.Accessor.ComponentType.UNSIGNED_SHORT]:Uint16Array,[r.Accessor.ComponentType.UNSIGNED_BYTE]:Uint8Array,[r.Accessor.ComponentType.SHORT]:Int16Array,[r.Accessor.ComponentType.BYTE]:Int8Array},z={[r.Accessor.ComponentType.FLOAT]:k.DT_FLOAT32,[r.Accessor.ComponentType.UNSIGNED_INT]:k.DT_UINT32,[r.Accessor.ComponentType.UNSIGNED_SHORT]:k.DT_UINT16,[r.Accessor.ComponentType.UNSIGNED_BYTE]:k.DT_UINT8,[r.Accessor.ComponentType.SHORT]:k.DT_INT16,[r.Accessor.ComponentType.BYTE]:k.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,Y=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${se}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),s=e.jsonDoc,n=new Map;try{const i=s.json.meshes||[];for(const o of i)for(const i of o.primitives){if(!i.extensions||!i.extensions[se])continue;const o=i.extensions[se];let[a,u]=n.get(o.bufferView)||[];if(!u||!a){const e=s.json.bufferViews[o.bufferView],i=s.json.buffers[e.buffer],c=r.BufferUtils.toView(i.uri?s.resources[i.uri]:s.resources[r.GLB_BUFFER],e.byteOffset||0,e.byteLength);a=new this._decoderModule.Decoder,u=X(a,c),n.set(o.bufferView,[a,u]),t.debug(`[${se}] Decompressed ${c.byteLength} bytes.`)}for(const t in i.attributes){const s=e.jsonDoc.json.accessors[i.attributes[t]],r=a.GetAttributeByUniqueId(u,o.attributes[t]),n=K(a,u,r,s);e.accessors[i.attributes[t]].setArray(n)}void 0!==i.indices&&e.accessors[i.indices].setArray(q(a,u))}}finally{for(const[e,t]of Array.from(n.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${se}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${se}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(e){const t=e.getLogger(),s=new Set,n=new Set;for(const i of e.getRoot().listMeshes())for(const e of i.listPrimitives())e.getIndices()?e.getMode()!==r.Primitive.Mode.TRIANGLES?(n.add(e),t.warn(`[${se}] Skipping Draco compression on non-TRIANGLES primitive.`)):s.add(e):(n.add(e),t.warn(`[${se}] Skipping Draco compression on non-indexed primitive.`));const i=e.getRoot().listAccessors(),o=new Map;for(let e=0;e<i.length;e++)o.set(i[e],e);const a=new Map,u=new Set,c=new Map;for(const t of Array.from(s)){let s=ne(t,o);if(u.has(s))c.set(t,s);else{if(a.has(t.getIndices())){const s=t.getIndices(),r=s.clone();o.set(r,e.getRoot().listAccessors().length-1),t.swap(s,r)}for(const s of t.listAttributes())if(a.has(s)){const r=s.clone();o.set(r,e.getRoot().listAccessors().length-1),t.swap(s,r)}s=ne(t,o),u.add(s),c.set(t,s),a.set(t.getIndices(),s);for(const e of t.listAttributes())a.set(e,s)}}for(const e of Array.from(a.keys())){const t=new Set(e.listParents().map((e=>e.propertyType)));if(2!==t.size||!t.has(r.PropertyType.PRIMITIVE)||!t.has(r.PropertyType.ROOT))throw new Error(`[${se}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const e of Array.from(s)){const t=c.get(e),s=e.getIndices();if(a.get(s)!==t||e.listAttributes().some((e=>a.get(e)!==t)))throw new Error(`[${se}] Draco primitives must share all, or no, accessors.`)}for(const e of Array.from(n)){const t=e.getIndices();if(a.has(t)||e.listAttributes().some((e=>a.has(e))))throw new Error(`[${se}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return c}(this.document),i=new Map;let o="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?s.warn(`[${se}]: quantizationVolume=scene requires exactly 1 scene.`):o=(0,r.bounds)(this.document.getRoot().listScenes().pop()));for(const t of Array.from(n.keys())){const s=n.get(t);if(!s)throw new Error("Unexpected primitive.");if(i.has(s)){i.set(s,i.get(s));continue}const r=t.getIndices(),a=e.jsonDoc.json.accessors,u=Q(t,A({},this._encoderOptions,{quantizationVolume:o}));i.set(s,u);const c=e.createAccessorDef(r);c.count=u.numIndices,e.accessorIndexMap.set(r,a.length),a.push(c);for(const s of t.listSemantics()){const r=t.getAttribute(s),n=e.createAccessorDef(r);n.count=u.numVertices,e.accessorIndexMap.set(r,a.length),a.push(n)}const h=t.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(h)||e.otherBufferViews.set(h,[]),e.otherBufferViews.get(h).push(u.data)}return s.debug(`[${se}] Compressed ${n.size} primitives.`),e.extensionData[se]={primitiveHashMap:n,primitiveEncodingMap:i},this}write(e){const t=e.extensionData[se];for(const s of this.document.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let n=0;n<s.listPrimitives().length;n++){const i=s.listPrimitives()[n],o=r.primitives[n],a=t.primitiveHashMap.get(i);if(!a)continue;const u=t.primitiveEncodingMap.get(a);o.extensions=o.extensions||{},o.extensions[se]={bufferView:e.otherBufferViewsIndexMap.get(u.data),attributes:u.attributeIDs}}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==se)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==se))}return this}}function ne(e,t){const s=[],r=e.getIndices();s.push(t.get(r));for(const r of e.listAttributes())s.push(t.get(r));return s.sort().join("|")}re.EXTENSION_NAME=se,re.EncoderMethod=W;class ie extends r.ExtensionProperty{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[r.PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ie.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return r.ColorUtils.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return r.ColorUtils.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ie.EXTENSION_NAME="KHR_lights_punctual",ie.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const oe="KHR_lights_punctual";class ae extends r.Extension{constructor(...e){super(...e),this.extensionName=oe}createLight(e=""){return new ie(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[oe])return this;const s=(t.json.extensions[oe].lights||[]).map((e=>{var t,s;const r=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&r.setColor(e.color),void 0!==e.intensity&&r.setIntensity(e.intensity),void 0!==e.range&&r.setRange(e.range),void 0!==(null==(t=e.spot)?void 0:t.innerConeAngle)&&r.setInnerConeAngle(e.spot.innerConeAngle),void 0!==(null==(s=e.spot)?void 0:s.outerConeAngle)&&r.setOuterConeAngle(e.spot.outerConeAngle),r}));return t.json.nodes.forEach(((t,r)=>{t.extensions&&t.extensions[oe]&&e.nodes[r].setExtension(oe,s[t.extensions[oe].light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const s=[],n=new Map;for(const e of this.properties){const t=e,i={type:t.getType()};r.MathUtils.eq(t.getColor(),[1,1,1])||(i.color=t.getColor()),1!==t.getIntensity()&&(i.intensity=t.getIntensity()),null!=t.getRange()&&(i.range=t.getRange()),t.getName()&&(i.name=t.getName()),t.getType()===ie.Type.SPOT&&(i.spot={innerConeAngle:t.getInnerConeAngle(),outerConeAngle:t.getOuterConeAngle()}),s.push(i),n.set(t,s.length-1)}return this.document.getRoot().listNodes().forEach((s=>{const r=s.getExtension(oe);if(r){const i=e.nodeIndexMap.get(s),o=t.json.nodes[i];o.extensions=o.extensions||{},o.extensions[oe]={light:n.get(r)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[oe]={lights:s},this}}ae.EXTENSION_NAME=oe;const{R:ue,G:ce,B:he}=r.TextureChannel;class le extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new r.TextureInfo(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new r.TextureInfo(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new r.TextureInfo(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:ue})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ce})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:ue|ce|he})}}le.EXTENSION_NAME="KHR_materials_clearcoat";const fe="KHR_materials_clearcoat";class pe extends r.Extension{constructor(...e){super(...e),this.extensionName=fe}createClearcoat(){return new le(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[fe]){const n=this.createClearcoat();e.materials[r].setExtension(fe,n);const i=t.extensions[fe];if(void 0!==i.clearcoatFactor&&n.setClearcoatFactor(i.clearcoatFactor),void 0!==i.clearcoatRoughnessFactor&&n.setClearcoatRoughnessFactor(i.clearcoatRoughnessFactor),void 0!==i.clearcoatTexture){const t=i.clearcoatTexture;n.setClearcoatTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getClearcoatTextureInfo(),t)}if(void 0!==i.clearcoatRoughnessTexture){const t=i.clearcoatRoughnessTexture;n.setClearcoatRoughnessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==i.clearcoatNormalTexture){const t=i.clearcoatNormalTexture;n.setClearcoatNormalTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&n.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(fe);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[fe]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const t=r.getClearcoatTexture(),s=r.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(t,s)}if(r.getClearcoatRoughnessTexture()){const t=r.getClearcoatRoughnessTexture(),s=r.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(t,s)}if(r.getClearcoatNormalTexture()){const t=r.getClearcoatNormalTexture(),s=r.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(t,s),1!==r.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}})),this}}pe.EXTENSION_NAME=fe;class ge extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ge.EXTENSION_NAME="KHR_materials_emissive_strength";const de="KHR_materials_emissive_strength";class me extends r.Extension{constructor(...e){super(...e),this.extensionName=de}createEmissiveStrength(){return new ge(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[de]){const r=this.createEmissiveStrength();e.materials[s].setExtension(de,r);const n=t.extensions[de];void 0!==n.emissiveStrength&&r.setEmissiveStrength(n.emissiveStrength)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(de);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{},i.extensions[de]={emissiveStrength:r.getEmissiveStrength()}}})),this}}me.EXTENSION_NAME=de;class Te extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}Te.EXTENSION_NAME="KHR_materials_ior";const xe="KHR_materials_ior";class Ee extends r.Extension{constructor(...e){super(...e),this.extensionName=xe}createIOR(){return new Te(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[xe]){const r=this.createIOR();e.materials[s].setExtension(xe,r);const n=t.extensions[xe];void 0!==n.ior&&r.setIOR(n.ior)}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(xe);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{},i.extensions[xe]={ior:r.getIOR()}}})),this}}Ee.EXTENSION_NAME=xe;const{R:ye,G:Re,B:Ae,A:Ie}=r.TextureChannel;class we extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new r.TextureInfo(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new r.TextureInfo(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return r.ColorUtils.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(r.ColorUtils.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:ye|Re|Ae|Ie})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:ye|Re|Ae|Ie})}}we.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const be="KHR_materials_pbrSpecularGlossiness";class Se extends r.Extension{constructor(...e){super(...e),this.extensionName=be}createPBRSpecularGlossiness(){return new we(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[be]){const n=this.createPBRSpecularGlossiness();e.materials[r].setExtension(be,n);const i=t.extensions[be];if(void 0!==i.diffuseFactor&&n.setDiffuseFactor(i.diffuseFactor),void 0!==i.specularFactor&&n.setSpecularFactor(i.specularFactor),void 0!==i.glossinessFactor&&n.setGlossinessFactor(i.glossinessFactor),void 0!==i.diffuseTexture){const t=i.diffuseTexture;n.setDiffuseTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getDiffuseTextureInfo(),t)}if(void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;n.setSpecularGlossinessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(be);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[be]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const t=r.getDiffuseTexture(),s=r.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(t,s)}if(r.getSpecularGlossinessTexture()){const t=r.getSpecularGlossinessTexture(),s=r.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(t,s)}}})),this}}Se.EXTENSION_NAME=be;const{R:_e,G:Ne,B:Me,A:ve}=r.TextureChannel;class Ce extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new r.TextureInfo(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new r.TextureInfo(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return r.ColorUtils.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",r.ColorUtils.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:_e|Ne|Me})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:ve})}}Ce.EXTENSION_NAME="KHR_materials_sheen";const Oe="KHR_materials_sheen";class Ue extends r.Extension{constructor(...e){super(...e),this.extensionName=Oe}createSheen(){return new Ce(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Oe]){const n=this.createSheen();e.materials[r].setExtension(Oe,n);const i=t.extensions[Oe];if(void 0!==i.sheenColorFactor&&n.setSheenColorFactor(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&n.setSheenRoughnessFactor(i.sheenRoughnessFactor),void 0!==i.sheenColorTexture){const t=i.sheenColorTexture;n.setSheenColorTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSheenColorTextureInfo(),t)}if(void 0!==i.sheenRoughnessTexture){const t=i.sheenRoughnessTexture;n.setSheenRoughnessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(Oe);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[Oe]={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const t=r.getSheenColorTexture(),s=r.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(t,s)}if(r.getSheenRoughnessTexture()){const t=r.getSheenRoughnessTexture(),s=r.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(t,s)}}})),this}}Ue.EXTENSION_NAME=Oe;const{R:De,G:Fe,B:Pe,A:Be}=r.TextureChannel;class Le extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new r.TextureInfo(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new r.TextureInfo(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return r.ColorUtils.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",r.ColorUtils.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Be})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:De|Fe|Pe})}}Le.EXTENSION_NAME="KHR_materials_specular";const je="KHR_materials_specular";class Ve extends r.Extension{constructor(...e){super(...e),this.extensionName=je}createSpecular(){return new Le(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[je]){const n=this.createSpecular();e.materials[r].setExtension(je,n);const i=t.extensions[je];if(void 0!==i.specularFactor&&n.setSpecularFactor(i.specularFactor),void 0!==i.specularColorFactor&&n.setSpecularColorFactor(i.specularColorFactor),void 0!==i.specularTexture){const t=i.specularTexture;n.setSpecularTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSpecularTextureInfo(),t)}if(void 0!==i.specularColorTexture){const t=i.specularColorTexture;n.setSpecularColorTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const n=s.getExtension(je);if(n){const i=e.materialIndexMap.get(s),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[je]={};if(1!==n.getSpecularFactor()&&(a.specularFactor=n.getSpecularFactor()),r.MathUtils.eq(n.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const t=n.getSpecularTexture(),s=n.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(t,s)}if(n.getSpecularColorTexture()){const t=n.getSpecularColorTexture(),s=n.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(t,s)}}})),this}}Ve.EXTENSION_NAME=je;const{R:Ge}=r.TextureChannel;class ke extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new r.TextureInfo(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Ge})}}ke.EXTENSION_NAME="KHR_materials_transmission";const He="KHR_materials_transmission";class ze extends r.Extension{constructor(...e){super(...e),this.extensionName=He}createTransmission(){return new ke(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[He]){const n=this.createTransmission();e.materials[r].setExtension(He,n);const i=t.extensions[He];if(void 0!==i.transmissionFactor&&n.setTransmissionFactor(i.transmissionFactor),void 0!==i.transmissionTexture){const t=i.transmissionTexture;n.setTransmissionTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(He);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[He]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const t=r.getTransmissionTexture(),s=r.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(t,s)}}})),this}}ze.EXTENSION_NAME=He;class Ye extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[r.PropertyType.MATERIAL]}}Ye.EXTENSION_NAME="KHR_materials_unlit";const Xe="KHR_materials_unlit";class qe extends r.Extension{constructor(...e){super(...e),this.extensionName=Xe}createUnlit(){return new Ye(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,s)=>{t.extensions&&t.extensions[Xe]&&e.materials[s].setExtension(Xe,this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{if(s.getExtension(Xe)){const r=e.materialIndexMap.get(s),n=t.json.materials[r];n.extensions=n.extensions||{},n.extensions[Xe]={}}})),this}}qe.EXTENSION_NAME=Xe;class Ke extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}Ke.EXTENSION_NAME="KHR_materials_variants";class We extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[r.PropertyType.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}We.EXTENSION_NAME="KHR_materials_variants";class Je extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Je.EXTENSION_NAME="KHR_materials_variants";const $e="KHR_materials_variants";class Ze extends r.Extension{constructor(...e){super(...e),this.extensionName=$e}createMappingList(){return new We(this.document.getGraph())}createVariant(e=""){return new Je(this.document.getGraph(),e)}createMapping(){return new Ke(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((e=>e instanceof Je))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[$e])return this;const s=(t.json.extensions[$e].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,r)=>{const n=e.meshes[r];(t.primitives||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[$e])return;const i=this.createMappingList(),o=t.extensions[$e];for(const t of o.mappings){const r=this.createMapping();void 0!==t.material&&r.setMaterial(e.materials[t.material]);for(const e of t.variants||[])r.addVariant(s[e]);i.addMapping(r)}n.listPrimitives()[r].setExtension($e,i)}))})),this}write(e){const t=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const r=[],n=new Map;for(const t of s)n.set(t,r.length),r.push(e.createPropertyDef(t));for(const t of this.document.getRoot().listMeshes()){const s=e.meshIndexMap.get(t);t.listPrimitives().forEach(((t,r)=>{const i=t.getExtension($e);if(!i)return;const o=e.jsonDoc.json.meshes[s].primitives[r],a=i.listMappings().map((t=>{const s=e.createPropertyDef(t),r=t.getMaterial();return r&&(s.material=e.materialIndexMap.get(r)),s.variants=t.listVariants().map((e=>n.get(e))),s}));o.extensions=o.extensions||{},o.extensions[$e]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[$e]={variants:r},this}}Ze.EXTENSION_NAME=$e;const{G:Qe}=r.TextureChannel;class et extends r.ExtensionProperty{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[r.PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new r.TextureInfo(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Qe})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return r.ColorUtils.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",r.ColorUtils.hexToFactor(e,t))}}et.EXTENSION_NAME="KHR_materials_volume";const tt="KHR_materials_volume";class st extends r.Extension{constructor(...e){super(...e),this.extensionName=tt}createVolume(){return new et(this.document.getGraph())}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[tt]){const n=this.createVolume();e.materials[r].setExtension(tt,n);const i=t.extensions[tt];if(void 0!==i.thicknessFactor&&n.setThicknessFactor(i.thicknessFactor),void 0!==i.attenuationDistance&&n.setAttenuationDistance(i.attenuationDistance),void 0!==i.attenuationColor&&n.setAttenuationColor(i.attenuationColor),void 0!==i.thicknessTexture){const t=i.thicknessTexture;n.setThicknessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach((s=>{const n=s.getExtension(tt);if(n){const i=e.materialIndexMap.get(s),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[tt]={};if(n.getThicknessFactor()>0&&(a.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(a.attenuationDistance=n.getAttenuationDistance()),r.MathUtils.eq(n.getAttenuationColor(),[1,1,1])||(a.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const t=n.getThicknessTexture(),s=n.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(t,s)}}})),this}}st.EXTENSION_NAME=tt;const rt="KHR_mesh_quantization";class nt extends r.Extension{constructor(...e){super(...e),this.extensionName=rt}read(e){return this}write(e){return this}}nt.EXTENSION_NAME=rt;const it="KHR_texture_basisu";class ot{match(e){return 171===e[0]&&75===e[1]&&84===e[2]&&88===e[3]&&32===e[4]&&50===e[5]&&48===e[6]&&187===e[7]&&13===e[8]&&10===e[9]&&26===e[10]&&10===e[11]}getSize(e){const t=T(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=T(e).dataFormatDescriptor[0];if(t.colorModel===u.ETC1S)return 2===t.samples.length&&15==(15&t.samples[1].channelID)?4:3;if(t.colorModel===u.UASTC)return 3==(15&t.samples[0].channelID)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=T(e),s=this.getChannels(e)>3;let r=0;for(let e=0;e<t.levels.length;e++){const n=t.levels[e];r+=n.uncompressedByteLength?n.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,e)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,e)))/4)*(s?16:8)}return r}}class at extends r.Extension{constructor(...e){super(...e),this.extensionName=it,this.prereadTypes=[r.PropertyType.TEXTURE]}static register(){r.ImageUtils.registerFormat("image/ktx2",new ot)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions[it]&&(e.source=e.extensions[it].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach((s=>{if("image/ktx2"===s.getMimeType()){const r=e.imageIndexMap.get(s);t.json.textures.forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[it]={source:e.source},delete e.source)}))}})),this}}at.EXTENSION_NAME=it;class ut extends r.ExtensionProperty{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[r.PropertyType.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}ut.EXTENSION_NAME="KHR_texture_transform";const ct="KHR_texture_transform";class ht extends r.Extension{constructor(...e){super(...e),this.extensionName=ct}createTransform(){return new ut(this.document.getGraph())}read(e){for(const[t,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions[ct])continue;const e=this.createTransform(),r=s.extensions[ct];void 0!==r.offset&&e.setOffset(r.offset),void 0!==r.rotation&&e.setRotation(r.rotation),void 0!==r.scale&&e.setScale(r.scale),void 0!==r.texCoord&&e.setTexCoord(r.texCoord),t.setExtension(ct,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,s]of t){const t=e.getExtension(ct);if(!t)continue;s.extensions=s.extensions||{};const n={},i=r.MathUtils.eq;i(t.getOffset(),[0,0])||(n.offset=t.getOffset()),0!==t.getRotation()&&(n.rotation=t.getRotation()),i(t.getScale(),[1,1])||(n.scale=t.getScale()),null!=t.getTexCoord()&&(n.texCoord=t.getTexCoord()),s.extensions[ct]=n}return this}}ht.EXTENSION_NAME=ct;const lt=[r.PropertyType.ROOT,r.PropertyType.SCENE,r.PropertyType.NODE,r.PropertyType.MESH,r.PropertyType.MATERIAL,r.PropertyType.TEXTURE,r.PropertyType.ANIMATION];class ft extends r.ExtensionProperty{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=lt}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",A({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const s=A({},this.get("properties"));return t?s[e]=t:delete s[e],this.set("properties",s)}toJSONLD(){return A({"@context":pt(this.get("context"))},pt(this.get("properties")))}fromJSONLD(e){const t=(e=pt(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function pt(e){return JSON.parse(JSON.stringify(e))}ft.EXTENSION_NAME="KHR_xmp_json_ld";const gt="KHR_xmp_json_ld";class dt extends r.Extension{constructor(...e){super(...e),this.extensionName=gt}createPacket(){return new ft(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const s=null==(t=e.jsonDoc.json.extensions)?void 0:t[gt];if(!s||!s.packets)return this;const r=e.jsonDoc.json,n=this.document.getRoot(),i=s.packets.map((e=>this.createPacket().fromJSONLD(e))),o=[[r.asset],r.scenes,r.nodes,r.meshes,r.materials,r.images,r.animations],a=[[n],n.listScenes(),n.listNodes(),n.listMeshes(),n.listMaterials(),n.listTextures(),n.listAnimations()];for(let e=0;e<o.length;e++){const t=o[e]||[];for(let s=0;s<t.length;s++){const r=t[s];r.extensions&&r.extensions[gt]&&a[e][s].setExtension(gt,i[r.extensions[gt].packet])}}return this}write(e){const{json:t}=e.jsonDoc,s=[];for(const n of this.properties){s.push(n.toJSONLD());for(const i of n.listParents()){let n;switch(i.propertyType){case r.PropertyType.ROOT:n=t.asset;break;case r.PropertyType.SCENE:n=t.scenes[e.sceneIndexMap.get(i)];break;case r.PropertyType.NODE:n=t.nodes[e.nodeIndexMap.get(i)];break;case r.PropertyType.MESH:n=t.meshes[e.meshIndexMap.get(i)];break;case r.PropertyType.MATERIAL:n=t.materials[e.materialIndexMap.get(i)];break;case r.PropertyType.TEXTURE:n=t.images[e.imageIndexMap.get(i)];break;case r.PropertyType.ANIMATION:n=t.animations[e.animationIndexMap.get(i)];break;default:n=null,this.document.getLogger().warn(`[${gt}]: Unsupported parent property, "${i.propertyType}"`)}n&&(n.extensions=n.extensions||{},n.extensions[gt]={packet:s.length-1})}}return s.length>0&&(t.extensions=t.extensions||{},t.extensions[gt]={packets:s}),this}}dt.EXTENSION_NAME=gt;const mt=[re,ae,pe,me,Ee,Se,Ve,Ue,ze,qe,Ze,st,nt,at,ht,dt],Tt=[R,B,V,...mt]},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),s=t[0],r=t[1];return 3*(s+r)/4-r},t.toByteArray=function(e){var t,s,i=u(e),o=i[0],a=i[1],c=new n(function(e,t,s){return 3*(t+s)/4-s}(0,o,a)),h=0,l=a>0?o-4:o;for(s=0;s<l;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;2===a&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,c[h++]=255&t);1===a&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i=[],o=16383,a=0,u=r-n;a<u;a+=o)i.push(c(e,a,a+o>u?u:a+o));1===n?(t=e[r-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return i.join("")};for(var s=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=i.length;o<a;++o)s[o]=i[o],r[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");return-1===s&&(s=t),[s,s===t?0:4-s%4]}function c(e,t,r){for(var n,i,o=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(s[(i=n)>>18&63]+s[i>>12&63]+s[i>>6&63]+s[63&i]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},8764:(e,t,s)=>{"use strict";var r=s(9742),n=s(645),i=s(5826);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,s){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,s);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return c(this,e,t,s)}function c(e,t,s,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,s,r){if(t.byteLength,s<0||t.byteLength<s)throw new RangeError("'offset' is out of bounds");if(t.byteLength<s+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===s&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,s):new Uint8Array(t,s,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,s,r):"string"==typeof t?function(e,t,s){"string"==typeof s&&""!==s||(s="utf8");if(!u.isEncoding(s))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(t,s),n=(e=a(e,r)).write(t,s);n!==r&&(e=e.slice(0,n));return e}(e,t,s):function(e,t){if(u.isBuffer(t)){var s=0|p(t.length);return 0===(e=a(e,s)).length||t.copy(e,0,0,s),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):f(e,t);if("Buffer"===t.type&&i(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(h(t),e=a(e,t<0?0:0|p(t)),!u.TYPED_ARRAY_SUPPORT)for(var s=0;s<t;++s)e[s]=0;return e}function f(e,t){var s=t.length<0?0:0|p(t.length);e=a(e,s);for(var r=0;r<s;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function g(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var s=e.length;if(0===s)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return k(e).length;default:if(r)return G(e).length;t=(""+t).toLowerCase(),r=!0}}function d(e,t,s){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if((s>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return v(this,t,s);case"utf8":case"utf-8":return S(this,t,s);case"ascii":return N(this,t,s);case"latin1":case"binary":return M(this,t,s);case"base64":return b(this,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,s);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,s){var r=e[t];e[t]=e[s],e[s]=r}function T(e,t,s,r,n){if(0===e.length)return-1;if("string"==typeof s?(r=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,isNaN(s)&&(s=n?0:e.length-1),s<0&&(s=e.length+s),s>=e.length){if(n)return-1;s=e.length-1}else if(s<0){if(!n)return-1;s=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:x(e,t,s,r,n);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,s):Uint8Array.prototype.lastIndexOf.call(e,t,s):x(e,[t],s,r,n);throw new TypeError("val must be string, number or Buffer")}function x(e,t,s,r,n){var i,o=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,u/=2,s/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){var h=-1;for(i=s;i<a;i++)if(c(e,i)===c(t,-1===h?0:i-h)){if(-1===h&&(h=i),i-h+1===u)return h*o}else-1!==h&&(i-=i-h),h=-1}else for(s+u>a&&(s=a-u),i=s;i>=0;i--){for(var l=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){l=!1;break}if(l)return i}return-1}function E(e,t,s,r){s=Number(s)||0;var n=e.length-s;r?(r=Number(r))>n&&(r=n):r=n;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[s+o]=a}return o}function y(e,t,s,r){return H(G(t,e.length-s),e,s,r)}function R(e,t,s,r){return H(function(e){for(var t=[],s=0;s<e.length;++s)t.push(255&e.charCodeAt(s));return t}(t),e,s,r)}function A(e,t,s,r){return R(e,t,s,r)}function I(e,t,s,r){return H(k(t),e,s,r)}function w(e,t,s,r){return H(function(e,t){for(var s,r,n,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(s=e.charCodeAt(o))>>8,n=s%256,i.push(n),i.push(r);return i}(t,e.length-s),e,s,r)}function b(e,t,s){return 0===t&&s===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,s))}function S(e,t,s){s=Math.min(e.length,s);for(var r=[],n=t;n<s;){var i,o,a,u,c=e[n],h=null,l=c>239?4:c>223?3:c>191?2:1;if(n+l<=s)switch(l){case 1:c<128&&(h=c);break;case 2:128==(192&(i=e[n+1]))&&(u=(31&c)<<6|63&i)>127&&(h=u);break;case 3:i=e[n+1],o=e[n+2],128==(192&i)&&128==(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:i=e[n+1],o=e[n+2],a=e[n+3],128==(192&i)&&128==(192&o)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(h=u)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),n+=l}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);var s="",r=0;for(;r<t;)s+=String.fromCharCode.apply(String,e.slice(r,r+=_));return s}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==s.g.TYPED_ARRAY_SUPPORT?s.g.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,s){return c(null,e,t,s)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,s){return function(e,t,s,r){return h(t),t<=0?a(e,t):void 0!==s?"string"==typeof r?a(e,t).fill(s,r):a(e,t).fill(s):a(e,t)}(null,e,t,s)},u.allocUnsafe=function(e){return l(null,e)},u.allocUnsafeSlow=function(e){return l(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var s=e.length,r=t.length,n=0,i=Math.min(s,r);n<i;++n)if(e[n]!==t[n]){s=e[n],r=t[n];break}return s<r?-1:r<s?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var s;if(void 0===t)for(t=0,s=0;s<e.length;++s)t+=e[s].length;var r=u.allocUnsafe(t),n=0;for(s=0;s<e.length;++s){var o=e[s];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},u.byteLength=g,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):d.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",s=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,s).match(/.{2}/g).join(" "),this.length>s&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,s,r,n){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===s&&(s=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||s>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&t>=s)return 0;if(r>=n)return-1;if(t>=s)return 1;if(this===e)return 0;for(var i=(n>>>=0)-(r>>>=0),o=(s>>>=0)-(t>>>=0),a=Math.min(i,o),c=this.slice(r,n),h=e.slice(t,s),l=0;l<a;++l)if(c[l]!==h[l]){i=c[l],o=h[l];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,s){return-1!==this.indexOf(e,t,s)},u.prototype.indexOf=function(e,t,s){return T(this,e,t,s,!0)},u.prototype.lastIndexOf=function(e,t,s){return T(this,e,t,s,!1)},u.prototype.write=function(e,t,s,r){if(void 0===t)r="utf8",s=this.length,t=0;else if(void 0===s&&"string"==typeof t)r=t,s=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(s)?(s|=0,void 0===r&&(r="utf8")):(r=s,s=void 0)}var n=this.length-t;if((void 0===s||s>n)&&(s=n),e.length>0&&(s<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return E(this,e,t,s);case"utf8":case"utf-8":return y(this,e,t,s);case"ascii":return R(this,e,t,s);case"latin1":case"binary":return A(this,e,t,s);case"base64":return I(this,e,t,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,s);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function N(e,t,s){var r="";s=Math.min(e.length,s);for(var n=t;n<s;++n)r+=String.fromCharCode(127&e[n]);return r}function M(e,t,s){var r="";s=Math.min(e.length,s);for(var n=t;n<s;++n)r+=String.fromCharCode(e[n]);return r}function v(e,t,s){var r=e.length;(!t||t<0)&&(t=0),(!s||s<0||s>r)&&(s=r);for(var n="",i=t;i<s;++i)n+=V(e[i]);return n}function C(e,t,s){for(var r=e.slice(t,s),n="",i=0;i<r.length;i+=2)n+=String.fromCharCode(r[i]+256*r[i+1]);return n}function O(e,t,s){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>s)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,s,r,n,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<i)throw new RangeError('"value" argument is out of bounds');if(s+r>e.length)throw new RangeError("Index out of range")}function D(e,t,s,r){t<0&&(t=65535+t+1);for(var n=0,i=Math.min(e.length-s,2);n<i;++n)e[s+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function F(e,t,s,r){t<0&&(t=4294967295+t+1);for(var n=0,i=Math.min(e.length-s,4);n<i;++n)e[s+n]=t>>>8*(r?n:3-n)&255}function P(e,t,s,r,n,i){if(s+r>e.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function B(e,t,s,r,i){return i||P(e,0,s,4),n.write(e,t,s,r,23,4),s+4}function L(e,t,s,r,i){return i||P(e,0,s,8),n.write(e,t,s,r,52,8),s+8}u.prototype.slice=function(e,t){var s,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(s=this.subarray(e,t)).__proto__=u.prototype;else{var n=t-e;s=new u(n,void 0);for(var i=0;i<n;++i)s[i]=this[i+e]}return s},u.prototype.readUIntLE=function(e,t,s){e|=0,t|=0,s||O(e,t,this.length);for(var r=this[e],n=1,i=0;++i<t&&(n*=256);)r+=this[e+i]*n;return r},u.prototype.readUIntBE=function(e,t,s){e|=0,t|=0,s||O(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},u.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,s){e|=0,t|=0,s||O(e,t,this.length);for(var r=this[e],n=1,i=0;++i<t&&(n*=256);)r+=this[e+i]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,s){e|=0,t|=0,s||O(e,t,this.length);for(var r=t,n=1,i=this[e+--r];r>0&&(n*=256);)i+=this[e+--r]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var s=this[e]|this[e+1]<<8;return 32768&s?4294901760|s:s},u.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var s=this[e+1]|this[e]<<8;return 32768&s?4294901760|s:s},u.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),n.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),n.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),n.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),n.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,s,r){(e=+e,t|=0,s|=0,r)||U(this,e,t,s,Math.pow(2,8*s)-1,0);var n=1,i=0;for(this[t]=255&e;++i<s&&(n*=256);)this[t+i]=e/n&255;return t+s},u.prototype.writeUIntBE=function(e,t,s,r){(e=+e,t|=0,s|=0,r)||U(this,e,t,s,Math.pow(2,8*s)-1,0);var n=s-1,i=1;for(this[t+n]=255&e;--n>=0&&(i*=256);)this[t+n]=e/i&255;return t+s},u.prototype.writeUInt8=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):F(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,s,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*s-1);U(this,e,t,s,n-1,-n)}var i=0,o=1,a=0;for(this[t]=255&e;++i<s&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+s},u.prototype.writeIntBE=function(e,t,s,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*s-1);U(this,e,t,s,n-1,-n)}var i=s-1,o=1,a=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+s},u.prototype.writeInt8=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):F(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,s){return e=+e,t|=0,s||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):F(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,s){return B(this,e,t,!0,s)},u.prototype.writeFloatBE=function(e,t,s){return B(this,e,t,!1,s)},u.prototype.writeDoubleLE=function(e,t,s){return L(this,e,t,!0,s)},u.prototype.writeDoubleBE=function(e,t,s){return L(this,e,t,!1,s)},u.prototype.copy=function(e,t,s,r){if(s||(s=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<s&&(r=s),r===s)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-s&&(r=e.length-t+s);var n,i=r-s;if(this===e&&s<t&&t<r)for(n=i-1;n>=0;--n)e[n+t]=this[n+s];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(n=0;n<i;++n)e[n+t]=this[n+s];else Uint8Array.prototype.set.call(e,this.subarray(s,s+i),t);return i},u.prototype.fill=function(e,t,s,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,s=this.length):"string"==typeof s&&(r=s,s=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<s)throw new RangeError("Out of range index");if(s<=t)return this;var i;if(t>>>=0,s=void 0===s?this.length:s>>>0,e||(e=0),"number"==typeof e)for(i=t;i<s;++i)this[i]=e;else{var o=u.isBuffer(e)?e:G(new u(e,r).toString()),a=o.length;for(i=0;i<s-t;++i)this[i+t]=o[i%a]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var s;t=t||1/0;for(var r=e.length,n=null,i=[],o=0;o<r;++o){if((s=e.charCodeAt(o))>55295&&s<57344){if(!n){if(s>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}n=s;continue}if(s<56320){(t-=3)>-1&&i.push(239,191,189),n=s;continue}s=65536+(n-55296<<10|s-56320)}else n&&(t-=3)>-1&&i.push(239,191,189);if(n=null,s<128){if((t-=1)<0)break;i.push(s)}else if(s<2048){if((t-=2)<0)break;i.push(s>>6|192,63&s|128)}else if(s<65536){if((t-=3)<0)break;i.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return i}function k(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,s,r){for(var n=0;n<r&&!(n+s>=t.length||n>=e.length);++n)t[n+s]=e[n];return n}},9685:(e,t,s)=>{"use strict";s.d(t,{WT:()=>r});var r="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},5975:(e,t,s)=>{"use strict";s.d(t,{U_:()=>n,GH:()=>i,Jp:()=>o,xJ:()=>a,j6:()=>u,Iw:()=>c});var r=s(9685);function n(e,t){var s=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],u=t[6],c=t[7],h=t[8],l=t[9],f=t[10],p=t[11],g=t[12],d=t[13],m=t[14],T=t[15],x=s*a-r*o,E=s*u-n*o,y=s*c-i*o,R=r*u-n*a,A=r*c-i*a,I=n*c-i*u,w=h*d-l*g,b=h*m-f*g,S=h*T-p*g,_=l*m-f*d,N=l*T-p*d,M=f*T-p*m,v=x*M-E*N+y*_+R*S-A*b+I*w;return v?(v=1/v,e[0]=(a*M-u*N+c*_)*v,e[1]=(n*N-r*M-i*_)*v,e[2]=(d*I-m*A+T*R)*v,e[3]=(f*A-l*I-p*R)*v,e[4]=(u*S-o*M-c*b)*v,e[5]=(s*M-n*S+i*b)*v,e[6]=(m*y-g*I-T*E)*v,e[7]=(h*I-f*y+p*E)*v,e[8]=(o*N-a*S+c*w)*v,e[9]=(r*S-s*N-i*w)*v,e[10]=(g*A-d*y+T*x)*v,e[11]=(l*y-h*A-p*x)*v,e[12]=(a*b-o*_-u*w)*v,e[13]=(s*_-r*b+n*w)*v,e[14]=(d*E-g*R-m*x)*v,e[15]=(h*R-l*E+f*x)*v,e):null}function i(e){var t=e[0],s=e[1],r=e[2],n=e[3],i=e[4],o=e[5],a=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11],p=e[12],g=e[13],d=e[14],m=e[15];return(t*o-s*i)*(l*m-f*d)-(t*a-r*i)*(h*m-f*g)+(t*u-n*i)*(h*d-l*g)+(s*a-r*o)*(c*m-f*p)-(s*u-n*o)*(c*d-l*p)+(r*u-n*a)*(c*g-h*p)}function o(e,t,s){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],h=t[7],l=t[8],f=t[9],p=t[10],g=t[11],d=t[12],m=t[13],T=t[14],x=t[15],E=s[0],y=s[1],R=s[2],A=s[3];return e[0]=E*r+y*a+R*l+A*d,e[1]=E*n+y*u+R*f+A*m,e[2]=E*i+y*c+R*p+A*T,e[3]=E*o+y*h+R*g+A*x,E=s[4],y=s[5],R=s[6],A=s[7],e[4]=E*r+y*a+R*l+A*d,e[5]=E*n+y*u+R*f+A*m,e[6]=E*i+y*c+R*p+A*T,e[7]=E*o+y*h+R*g+A*x,E=s[8],y=s[9],R=s[10],A=s[11],e[8]=E*r+y*a+R*l+A*d,e[9]=E*n+y*u+R*f+A*m,e[10]=E*i+y*c+R*p+A*T,e[11]=E*o+y*h+R*g+A*x,E=s[12],y=s[13],R=s[14],A=s[15],e[12]=E*r+y*a+R*l+A*d,e[13]=E*n+y*u+R*f+A*m,e[14]=E*i+y*c+R*p+A*T,e[15]=E*o+y*h+R*g+A*x,e}function a(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(e,t){var s=new r.WT(3);!function(e,t){var s=t[0],r=t[1],n=t[2],i=t[4],o=t[5],a=t[6],u=t[8],c=t[9],h=t[10];e[0]=Math.hypot(s,r,n),e[1]=Math.hypot(i,o,a),e[2]=Math.hypot(u,c,h)}(s,t);var n=1/s[0],i=1/s[1],o=1/s[2],a=t[0]*n,u=t[1]*i,c=t[2]*o,h=t[4]*n,l=t[5]*i,f=t[6]*o,p=t[8]*n,g=t[9]*i,d=t[10]*o,m=a+l+d,T=0;return m>0?(T=2*Math.sqrt(m+1),e[3]=.25*T,e[0]=(f-g)/T,e[1]=(p-c)/T,e[2]=(u-h)/T):a>l&&a>d?(T=2*Math.sqrt(1+a-l-d),e[3]=(f-g)/T,e[0]=.25*T,e[1]=(u+h)/T,e[2]=(p+c)/T):l>d?(T=2*Math.sqrt(1+l-a-d),e[3]=(p-c)/T,e[0]=(u+h)/T,e[1]=.25*T,e[2]=(f+g)/T):(T=2*Math.sqrt(1+d-a-l),e[3]=(u-h)/T,e[0]=(p+c)/T,e[1]=(f+g)/T,e[2]=.25*T),e}function c(e,t,s,r){var n=t[0],i=t[1],o=t[2],a=t[3],u=n+n,c=i+i,h=o+o,l=n*u,f=n*c,p=n*h,g=i*c,d=i*h,m=o*h,T=a*u,x=a*c,E=a*h,y=r[0],R=r[1],A=r[2];return e[0]=(1-(g+m))*y,e[1]=(f+E)*y,e[2]=(p-x)*y,e[3]=0,e[4]=(f-E)*R,e[5]=(1-(l+m))*R,e[6]=(d+T)*R,e[7]=0,e[8]=(p+x)*A,e[9]=(d-T)*A,e[10]=(1-(l+g))*A,e[11]=0,e[12]=s[0],e[13]=s[1],e[14]=s[2],e[15]=1,e}},7160:(e,t,s)=>{"use strict";s.d(t,{kE:()=>n,VV:()=>i,Fp:()=>o,bA:()=>a,Fv:()=>u,fF:()=>c});var r=s(9685);function n(e){var t=e[0],s=e[1],r=e[2];return Math.hypot(t,s,r)}function i(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e[2]=Math.min(t[2],s[2]),e}function o(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e[2]=Math.max(t[2],s[2]),e}function a(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function u(e,t){var s=t[0],r=t[1],n=t[2],i=s*s+r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function c(e,t,s){var r=t[0],n=t[1],i=t[2],o=s[3]*r+s[7]*n+s[11]*i+s[15];return o=o||1,e[0]=(s[0]*r+s[4]*n+s[8]*i+s[12])/o,e[1]=(s[1]*r+s[5]*n+s[9]*i+s[13])/o,e[2]=(s[2]*r+s[6]*n+s[10]*i+s[14])/o,e}var h,l;h=new r.WT(3),r.WT!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),l=h},645:(e,t)=>{t.read=function(e,t,s,r,n){var i,o,a=8*n-r-1,u=(1<<a)-1,c=u>>1,h=-7,l=s?n-1:0,f=s?-1:1,p=e[t+l];for(l+=f,i=p&(1<<-h)-1,p>>=-h,h+=a;h>0;i=256*i+e[t+l],l+=f,h-=8);for(o=i&(1<<-h)-1,i>>=-h,h+=r;h>0;o=256*o+e[t+l],l+=f,h-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),i-=c}return(p?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,s,r,n,i){var o,a,u,c=8*i-n-1,h=(1<<c)-1,l=h>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,g=r?1:-1,d=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+l>=1?f/u:f*Math.pow(2,1-l))*u>=2&&(o++,u/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(t*u-1)*Math.pow(2,n),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;e[s+p]=255&a,p+=g,a/=256,n-=8);for(o=o<<n|a,c+=n;c>0;e[s+p]=255&o,p+=g,o/=256,c-=8);e[s+p-g]|=128*d}},5826:e=>{var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},87:()=>{},7263:()=>{}}]);